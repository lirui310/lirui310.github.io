<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Orion K">
    
    <title>
        
            Linux服务器安全加固实战指南：从基础配置到高级防护的完整方案 |
        
        Orion K Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"Orion K Blog","author":"Orion K","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/                        || fa-solid fa-home","archives":"/archives            || fa-solid fa-box-archive","tags":"/tags                    || fa-solid fa-tags","categories":"/categories        || fa-solid fa-layer-group"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":"欢迎来到 Orion K 的博客，这是一个分享互联网技术的博客。联系：wxmm686800@gmail.com","category":true,"tag":true,"post_datetime":"created"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":null,"reaction":false,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2025,"word_count":false,"site_deploy":{"enable":true,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Orion K Blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                首页
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                归档
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                标签
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                
                                分类
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            首页
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            归档
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            标签
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                </span>
                            
                            分类
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        Linux服务器安全加固实战指南：从基础配置到高级防护的完整方案
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Orion K</span>
                                
                                    <span class="author-badge">Lv6</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2024-03-10 09:15:00</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/linux/">linux</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/">安全加固</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/">服务器安全</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE/">防火墙配置</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90/">用户权限</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1/">安全审计</a></li>
                        
                    
                </ul>
            </span>
        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h1 id="Linux服务器安全加固实战指南：从基础配置到高级防护的完整方案"><a href="#Linux服务器安全加固实战指南：从基础配置到高级防护的完整方案" class="headerlink" title="Linux服务器安全加固实战指南：从基础配置到高级防护的完整方案"></a>Linux服务器安全加固实战指南：从基础配置到高级防护的完整方案</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随着网络安全威胁的日益增加，Linux服务器的安全加固已成为运维工作的重中之重。一个安全的Linux服务器不仅能保护重要数据，还能确保业务的连续性和稳定性。本文基于实际生产环境经验，提供了一套完整的Linux安全加固方案，涵盖从基础配置到高级防护的各个方面。</p>
<h2 id="一、安全加固基础理论"><a href="#一、安全加固基础理论" class="headerlink" title="一、安全加固基础理论"></a>一、安全加固基础理论</h2><h3 id="1-1-安全加固的基本原则"><a href="#1-1-安全加固的基本原则" class="headerlink" title="1.1 安全加固的基本原则"></a>1.1 安全加固的基本原则</h3><ol>
<li><strong>最小权限原则</strong>：用户和进程只获得完成任务所需的最小权限</li>
<li><strong>纵深防御</strong>：建立多层安全防护体系</li>
<li><strong>定期更新</strong>：及时安装安全补丁和更新</li>
<li><strong>监控审计</strong>：建立完善的日志记录和监控机制</li>
<li><strong>备份恢复</strong>：制定完善的备份和灾难恢复计划</li>
<li><strong>安全意识</strong>：提高管理员和用户的安全意识</li>
</ol>
<h3 id="1-2-安全威胁分析"><a href="#1-2-安全威胁分析" class="headerlink" title="1.2 安全威胁分析"></a>1.2 安全威胁分析</h3><p><strong>常见安全威胁</strong>：</p>
<ul>
<li>暴力破解攻击</li>
<li>权限提升攻击</li>
<li>恶意软件感染</li>
<li>数据泄露</li>
<li>拒绝服务攻击</li>
<li>内部威胁</li>
<li>配置错误导致的安全漏洞</li>
</ul>
<h3 id="1-3-安全加固检查清单"><a href="#1-3-安全加固检查清单" class="headerlink" title="1.3 安全加固检查清单"></a>1.3 安全加固检查清单</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安全检查脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># security_check.sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Linux Security Check Report ===&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Date: <span class="subst">$(date)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hostname: <span class="subst">$(hostname)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;OS Version: <span class="subst">$(cat /etc/os-release | grep PRETTY_NAME)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 系统更新检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1. System Updates:&quot;</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v yum &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    yum check-update | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">command</span> -v apt &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    apt list --upgradable 2&gt;/dev/null | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 用户账户检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2. User Accounts:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Total users: <span class="subst">$(cat /etc/passwd | wc -l)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Users with UID 0: <span class="subst">$(awk -F: &#x27;$3 == 0 &#123;print $1&#125;&#x27; /etc/passwd)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Users with empty passwords: <span class="subst">$(awk -F: &#x27;$2 == <span class="string">&quot;&quot;</span> &#123;print $1&#125;&#x27; /etc/shadow)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. SSH配置检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;3. SSH Configuration:&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Root login: <span class="subst">$(grep &#x27;^PermitRootLogin&#x27; /etc/ssh/sshd_config || echo &#x27;Not configured&#x27;)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Password authentication: <span class="subst">$(grep &#x27;^PasswordAuthentication&#x27; /etc/ssh/sshd_config || echo &#x27;Not configured&#x27;)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;SSH port: <span class="subst">$(grep &#x27;^Port&#x27; /etc/ssh/sshd_config || echo &#x27;Default 22&#x27;)</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 防火墙状态</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;4. Firewall Status:&quot;</span></span><br><span class="line"><span class="keyword">if</span> systemctl is-active --quiet firewalld; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Firewalld: Active&quot;</span></span><br><span class="line"><span class="keyword">elif</span> systemctl is-active --quiet ufw; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;UFW: Active&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Firewall: Inactive or Unknown&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 服务检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;5. Running Services:&quot;</span></span><br><span class="line">systemctl list-units --<span class="built_in">type</span>=service --state=running | grep -E <span class="string">&#x27;(ssh|http|mysql|ftp)&#x27;</span> | <span class="built_in">wc</span> -l</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== End of Security Check ===&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="二、系统基础安全配置"><a href="#二、系统基础安全配置" class="headerlink" title="二、系统基础安全配置"></a>二、系统基础安全配置</h2><h3 id="2-1-系统更新和补丁管理"><a href="#2-1-系统更新和补丁管理" class="headerlink" title="2.1 系统更新和补丁管理"></a>2.1 系统更新和补丁管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 配置自动更新（CentOS/RHEL）</span></span><br><span class="line">yum install -y yum-cron</span><br><span class="line">systemctl <span class="built_in">enable</span> yum-cron</span><br><span class="line">systemctl start yum-cron</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑配置文件</span></span><br><span class="line">vi /etc/yum/yum-cron.conf</span><br><span class="line"><span class="comment"># 修改以下配置：</span></span><br><span class="line">apply_updates = <span class="built_in">yes</span></span><br><span class="line">update_cmd = security</span><br><span class="line">update_messages = <span class="built_in">yes</span></span><br><span class="line">download_updates = <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 配置自动更新（Ubuntu/Debian）</span></span><br><span class="line">apt install -y unattended-upgrades</span><br><span class="line">dpkg-reconfigure -plow unattended-upgrades</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑配置文件</span></span><br><span class="line">vi /etc/apt/apt.conf.d/50unattended-upgrades</span><br><span class="line"><span class="comment"># 启用安全更新：</span></span><br><span class="line">Unattended-Upgrade::Allowed-Origins &#123;</span><br><span class="line">    <span class="string">&quot;<span class="variable">$&#123;distro_id&#125;</span>:<span class="variable">$&#123;distro_codename&#125;</span>-security&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 手动更新系统</span></span><br><span class="line"><span class="comment"># CentOS/RHEL</span></span><br><span class="line">yum update -y</span><br><span class="line">yum install -y epel-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu/Debian</span></span><br><span class="line">apt update &amp;&amp; apt upgrade -y</span><br><span class="line">apt install -y software-properties-common</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 检查可用更新</span></span><br><span class="line">yum check-update</span><br><span class="line">apt list --upgradable</span><br></pre></td></tr></table></figure>

<h3 id="2-2-内核参数安全配置"><a href="#2-2-内核参数安全配置" class="headerlink" title="2.2 内核参数安全配置"></a>2.2 内核参数安全配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建内核安全配置文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/99-security.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 网络安全参数</span></span><br><span class="line"><span class="string"># 禁用IP转发</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.forwarding = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁用源路由</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_source_route = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.accept_source_route = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.accept_source_route = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.accept_source_route = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁用ICMP重定向</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.all.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv6.conf.default.accept_redirects = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁用发送ICMP重定向</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.send_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.send_redirects = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 启用反向路径过滤</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 忽略ICMP ping请求</span></span><br><span class="line"><span class="string">net.ipv4.icmp_echo_ignore_all = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 忽略广播ping</span></span><br><span class="line"><span class="string">net.ipv4.icmp_echo_ignore_broadcasts = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 启用SYN Cookies</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 记录欺骗、源路由和重定向包</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.log_martians = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.log_martians = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 系统安全参数</span></span><br><span class="line"><span class="string"># 禁用magic-sysrq键</span></span><br><span class="line"><span class="string">kernel.sysrq = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 限制core dump</span></span><br><span class="line"><span class="string">fs.suid_dumpable = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 限制dmesg访问</span></span><br><span class="line"><span class="string">kernel.dmesg_restrict = 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 限制内核指针访问</span></span><br><span class="line"><span class="string">kernel.kptr_restrict = 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 启用ASLR</span></span><br><span class="line"><span class="string">kernel.randomize_va_space = 2</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用配置</span></span><br><span class="line">sysctl -p /etc/sysctl.d/99-security.conf</span><br></pre></td></tr></table></figure>

<h3 id="2-3-文件系统安全配置"><a href="#2-3-文件系统安全配置" class="headerlink" title="2.3 文件系统安全配置"></a>2.3 文件系统安全配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 设置安全的挂载选项</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/fstab &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 安全挂载选项</span></span><br><span class="line"><span class="string">/tmp /tmp tmpfs defaults,nodev,nosuid,noexec 0 0</span></span><br><span class="line"><span class="string">/var/tmp /var/tmp tmpfs defaults,nodev,nosuid,noexec 0 0</span></span><br><span class="line"><span class="string">/dev/shm /dev/shm tmpfs defaults,nodev,nosuid,noexec 0 0</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 创建安全的临时目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /tmp_secure</span><br><span class="line"><span class="built_in">chmod</span> 1777 /tmp_secure</span><br><span class="line"><span class="built_in">chown</span> root:root /tmp_secure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 设置重要文件权限</span></span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/shadow</span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/gshadow</span><br><span class="line"><span class="built_in">chmod</span> 644 /etc/passwd</span><br><span class="line"><span class="built_in">chmod</span> 644 /etc/group</span><br><span class="line"><span class="built_in">chmod</span> 600 /boot/grub2/grub.cfg</span><br><span class="line"><span class="built_in">chmod</span> 700 /root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 查找并修复危险权限文件</span></span><br><span class="line"><span class="comment"># 查找world-writable文件</span></span><br><span class="line">find / -<span class="built_in">type</span> f -perm -002 -<span class="built_in">exec</span> <span class="built_in">ls</span> -la &#123;&#125; \; 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找SUID文件</span></span><br><span class="line">find / -<span class="built_in">type</span> f -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -la &#123;&#125; \; 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找SGID文件</span></span><br><span class="line">find / -<span class="built_in">type</span> f -perm -2000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -la &#123;&#125; \; 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 设置umask</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;umask 027&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;umask 027&quot;</span> &gt;&gt; /etc/bashrc</span><br></pre></td></tr></table></figure>

<h2 id="三、用户账户和权限管理"><a href="#三、用户账户和权限管理" class="headerlink" title="三、用户账户和权限管理"></a>三、用户账户和权限管理</h2><h3 id="3-1-用户账户安全配置"><a href="#3-1-用户账户安全配置" class="headerlink" title="3.1 用户账户安全配置"></a>3.1 用户账户安全配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 禁用不必要的系统账户</span></span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> games news uucp operator gopher ftp; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">id</span> <span class="string">&quot;<span class="variable">$user</span>&quot;</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        usermod -L -s /sbin/nologin <span class="string">&quot;<span class="variable">$user</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Disabled user: <span class="variable">$user</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 设置密码策略</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/security/pwquality.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 密码最小长度</span></span><br><span class="line"><span class="string">minlen = 12</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 至少包含一个小写字母</span></span><br><span class="line"><span class="string">lcredit = -1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 至少包含一个大写字母</span></span><br><span class="line"><span class="string">ucredit = -1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 至少包含一个数字</span></span><br><span class="line"><span class="string">dcredit = -1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 至少包含一个特殊字符</span></span><br><span class="line"><span class="string">ocredit = -1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 最多连续相同字符数</span></span><br><span class="line"><span class="string">maxrepeat = 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 与旧密码的最大相同字符数</span></span><br><span class="line"><span class="string">maxclasschg = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 密码不能包含用户名</span></span><br><span class="line"><span class="string">usercheck = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 配置密码有效期</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/login.defs &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 密码有效期配置</span></span><br><span class="line"><span class="string">PASS_MAX_DAYS 90</span></span><br><span class="line"><span class="string">PASS_MIN_DAYS 1</span></span><br><span class="line"><span class="string">PASS_WARN_AGE 7</span></span><br><span class="line"><span class="string">PASS_MIN_LEN 12</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 配置账户锁定策略</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/security/faillock.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 失败尝试次数</span></span><br><span class="line"><span class="string">deny = 5</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 锁定时间（秒）</span></span><br><span class="line"><span class="string">unlock_time = 900</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 失败计数重置时间</span></span><br><span class="line"><span class="string">fail_interval = 900</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 即使root也受限制</span></span><br><span class="line"><span class="string">even_deny_root</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 创建安全的管理员用户</span></span><br><span class="line">useradd -m -s /bin/bash -G wheel secadmin</span><br><span class="line">passwd secadmin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 配置sudo权限</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;secadmin ALL=(ALL) NOPASSWD: ALL&quot;</span> &gt; /etc/sudoers.d/secadmin</span><br><span class="line"><span class="built_in">chmod</span> 440 /etc/sudoers.d/secadmin</span><br></pre></td></tr></table></figure>

<h3 id="3-2-SSH安全配置"><a href="#3-2-SSH安全配置" class="headerlink" title="3.2 SSH安全配置"></a>3.2 SSH安全配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 备份原始配置</span></span><br><span class="line"><span class="built_in">cp</span> /etc/ssh/sshd_config /etc/ssh/sshd_config.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 创建安全的SSH配置</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/ssh/sshd_config &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># SSH安全配置</span></span><br><span class="line"><span class="string">Port 2222</span></span><br><span class="line"><span class="string">Protocol 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 认证配置</span></span><br><span class="line"><span class="string">PermitRootLogin no</span></span><br><span class="line"><span class="string">PasswordAuthentication no</span></span><br><span class="line"><span class="string">PubkeyAuthentication yes</span></span><br><span class="line"><span class="string">AuthorizedKeysFile .ssh/authorized_keys</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 连接限制</span></span><br><span class="line"><span class="string">MaxAuthTries 3</span></span><br><span class="line"><span class="string">MaxSessions 2</span></span><br><span class="line"><span class="string">MaxStartups 2</span></span><br><span class="line"><span class="string">LoginGraceTime 60</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 用户限制</span></span><br><span class="line"><span class="string">AllowUsers secadmin</span></span><br><span class="line"><span class="string">DenyUsers root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 网络配置</span></span><br><span class="line"><span class="string">ListenAddress 0.0.0.0</span></span><br><span class="line"><span class="string">AddressFamily inet</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 安全选项</span></span><br><span class="line"><span class="string">PermitEmptyPasswords no</span></span><br><span class="line"><span class="string">ChallengeResponseAuthentication no</span></span><br><span class="line"><span class="string">UsePAM yes</span></span><br><span class="line"><span class="string">X11Forwarding no</span></span><br><span class="line"><span class="string">AllowTcpForwarding no</span></span><br><span class="line"><span class="string">GatewayPorts no</span></span><br><span class="line"><span class="string">PermitTunnel no</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 日志配置</span></span><br><span class="line"><span class="string">SyslogFacility AUTHPRIV</span></span><br><span class="line"><span class="string">LogLevel VERBOSE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 加密算法</span></span><br><span class="line"><span class="string">Ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr</span></span><br><span class="line"><span class="string">MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha2-256,hmac-sha2-512</span></span><br><span class="line"><span class="string">KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 生成SSH密钥对</span></span><br><span class="line">ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N <span class="string">&quot;&quot;</span></span><br><span class="line">ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519 -N <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 配置SSH密钥认证</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /home/secadmin/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 700 /home/secadmin/.ssh</span><br><span class="line"><span class="built_in">touch</span> /home/secadmin/.ssh/authorized_keys</span><br><span class="line"><span class="built_in">chmod</span> 600 /home/secadmin/.ssh/authorized_keys</span><br><span class="line"><span class="built_in">chown</span> -R secadmin:secadmin /home/secadmin/.ssh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 重启SSH服务</span></span><br><span class="line">systemctl restart sshd</span><br><span class="line">systemctl <span class="built_in">enable</span> sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 配置SSH客户端安全选项</span></span><br><span class="line"><span class="built_in">cat</span> &gt; ~/.ssh/config &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">Host *</span></span><br><span class="line"><span class="string">    Protocol 2</span></span><br><span class="line"><span class="string">    Ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com</span></span><br><span class="line"><span class="string">    MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com</span></span><br><span class="line"><span class="string">    KexAlgorithms curve25519-sha256@libssh.org</span></span><br><span class="line"><span class="string">    ServerAliveInterval 300</span></span><br><span class="line"><span class="string">    ServerAliveCountMax 2</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">chmod</span> 600 ~/.ssh/config</span><br></pre></td></tr></table></figure>

<h3 id="3-3-sudo权限精细化配置"><a href="#3-3-sudo权限精细化配置" class="headerlink" title="3.3 sudo权限精细化配置"></a>3.3 sudo权限精细化配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建用户组</span></span><br><span class="line">groupadd webadmin</span><br><span class="line">groupadd dbadmin</span><br><span class="line">groupadd netadmin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 配置精细化sudo权限</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sudoers.d/custom-permissions &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># Web管理员权限</span></span><br><span class="line"><span class="string">%webadmin ALL=(ALL) /bin/systemctl restart nginx, /bin/systemctl reload nginx, /bin/systemctl status nginx</span></span><br><span class="line"><span class="string">%webadmin ALL=(ALL) /usr/sbin/nginx -t, /bin/tail /var/log/nginx/*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 数据库管理员权限</span></span><br><span class="line"><span class="string">%dbadmin ALL=(ALL) /bin/systemctl restart mysqld, /bin/systemctl status mysqld</span></span><br><span class="line"><span class="string">%dbadmin ALL=(ALL) /usr/bin/mysql, /usr/bin/mysqldump</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 网络管理员权限</span></span><br><span class="line"><span class="string">%netadmin ALL=(ALL) /sbin/iptables, /bin/systemctl restart firewalld</span></span><br><span class="line"><span class="string">%netadmin ALL=(ALL) /bin/ss, /bin/netstat, /sbin/tcpdump</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁用危险命令</span></span><br><span class="line"><span class="string">Cmnd_Alias DANGEROUS = /bin/su, /usr/bin/passwd root, /sbin/shutdown, /sbin/reboot</span></span><br><span class="line"><span class="string">ALL ALL = !DANGEROUS</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> 440 /etc/sudoers.d/custom-permissions</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 配置sudo日志</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Defaults logfile=/var/log/sudo.log&quot;</span> &gt;&gt; /etc/sudoers.d/logging</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Defaults log_input, log_output&quot;</span> &gt;&gt; /etc/sudoers.d/logging</span><br></pre></td></tr></table></figure>

<h2 id="四、防火墙和网络安全"><a href="#四、防火墙和网络安全" class="headerlink" title="四、防火墙和网络安全"></a>四、防火墙和网络安全</h2><h3 id="4-1-Firewalld防火墙配置"><a href="#4-1-Firewalld防火墙配置" class="headerlink" title="4.1 Firewalld防火墙配置"></a>4.1 Firewalld防火墙配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装和启用firewalld</span></span><br><span class="line">yum install -y firewalld</span><br><span class="line">systemctl <span class="built_in">enable</span> firewalld</span><br><span class="line">systemctl start firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 基本防火墙配置</span></span><br><span class="line"><span class="comment"># 设置默认区域</span></span><br><span class="line">firewall-cmd --set-default-zone=public</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除不必要的服务</span></span><br><span class="line">firewall-cmd --permanent --remove-service=dhcpv6-client</span><br><span class="line">firewall-cmd --permanent --remove-service=cockpit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加必要的服务</span></span><br><span class="line">firewall-cmd --permanent --add-service=ssh</span><br><span class="line">firewall-cmd --permanent --add-service=http</span><br><span class="line">firewall-cmd --permanent --add-service=https</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改SSH端口</span></span><br><span class="line">firewall-cmd --permanent --remove-service=ssh</span><br><span class="line">firewall-cmd --permanent --add-port=2222/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 创建自定义区域</span></span><br><span class="line">firewall-cmd --permanent --new-zone=dmz-web</span><br><span class="line">firewall-cmd --permanent --zone=dmz-web --add-service=http</span><br><span class="line">firewall-cmd --permanent --zone=dmz-web --add-service=https</span><br><span class="line">firewall-cmd --permanent --zone=dmz-web --add-port=2222/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 配置富规则</span></span><br><span class="line"><span class="comment"># 限制SSH连接频率</span></span><br><span class="line">firewall-cmd --permanent --add-rich-rule=<span class="string">&#x27;rule service name=ssh limit value=3/m accept&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许特定IP访问管理端口</span></span><br><span class="line">firewall-cmd --permanent --add-rich-rule=<span class="string">&#x27;rule family=ipv4 source address=192.168.1.100 port port=3306 protocol=tcp accept&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 阻止特定国家IP（需要安装geoip）</span></span><br><span class="line">firewall-cmd --permanent --add-rich-rule=<span class="string">&#x27;rule family=ipv4 source ipset=country-cn drop&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 应用配置</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 查看配置</span></span><br><span class="line">firewall-cmd --list-all</span><br><span class="line">firewall-cmd --list-all-zones</span><br></pre></td></tr></table></figure>

<h3 id="4-2-iptables防火墙配置"><a href="#4-2-iptables防火墙配置" class="headerlink" title="4.2 iptables防火墙配置"></a>4.2 iptables防火墙配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建iptables安全规则脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/firewall-rules.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># iptables安全配置脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空现有规则</span></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -t nat -F</span><br><span class="line">iptables -t nat -X</span><br><span class="line">iptables -t mangle -F</span><br><span class="line">iptables -t mangle -X</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认策略</span></span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -P FORWARD DROP</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许本地回环</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许已建立的连接</span></span><br><span class="line">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许SSH（自定义端口）</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 2222 -m state --state NEW -m recent --<span class="built_in">set</span> --name SSH</span><br><span class="line">iptables -A INPUT -p tcp --dport 2222 -m state --state NEW -m recent --update --seconds 60 --hitcount 3 --name SSH -j DROP</span><br><span class="line">iptables -A INPUT -p tcp --dport 2222 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许HTTP和HTTPS</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许特定IP访问数据库</span></span><br><span class="line">iptables -A INPUT -s 192.168.1.0/24 -p tcp --dport 3306 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 防止SYN洪水攻击</span></span><br><span class="line">iptables -A INPUT -p tcp --syn -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 1/s --limit-burst 3 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --syn -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># 防止端口扫描</span></span><br><span class="line">iptables -A INPUT -m recent --name portscan --rcheck --seconds 86400 -j DROP</span><br><span class="line">iptables -A INPUT -m recent --name portscan --remove</span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 139 -m recent --name portscan --<span class="built_in">set</span> -j LOG --log-prefix <span class="string">&quot;portscan:&quot;</span></span><br><span class="line">iptables -A INPUT -p tcp -m tcp --dport 139 -m recent --name portscan --<span class="built_in">set</span> -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录被丢弃的包</span></span><br><span class="line">iptables -A INPUT -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 5/min -j LOG --log-prefix <span class="string">&quot;iptables denied: &quot;</span> --log-level 7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存规则</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v iptables-save &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    iptables-save &gt; /etc/iptables/rules.v4</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Firewall rules applied successfully&quot;</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /etc/firewall-rules.sh</span><br><span class="line">/etc/firewall-rules.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 创建启动脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/iptables-restore.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Restore iptables rules</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=oneshot</span></span><br><span class="line"><span class="string">ExecStart=/etc/firewall-rules.sh</span></span><br><span class="line"><span class="string">RemainAfterExit=yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> iptables-restore</span><br></pre></td></tr></table></figure>

<h3 id="4-3-网络入侵检测"><a href="#4-3-网络入侵检测" class="headerlink" title="4.3 网络入侵检测"></a>4.3 网络入侵检测</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装fail2ban</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 配置fail2ban</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/fail2ban/jail.local &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[DEFAULT]</span></span><br><span class="line"><span class="string"># 默认配置</span></span><br><span class="line"><span class="string">bantime = 3600</span></span><br><span class="line"><span class="string">findtime = 600</span></span><br><span class="line"><span class="string">maxretry = 3</span></span><br><span class="line"><span class="string">backend = systemd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># SSH保护</span></span><br><span class="line"><span class="string">[sshd]</span></span><br><span class="line"><span class="string">enabled = true</span></span><br><span class="line"><span class="string">port = 2222</span></span><br><span class="line"><span class="string">logpath = /var/log/secure</span></span><br><span class="line"><span class="string">maxretry = 3</span></span><br><span class="line"><span class="string">bantime = 3600</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># HTTP保护</span></span><br><span class="line"><span class="string">[nginx-http-auth]</span></span><br><span class="line"><span class="string">enabled = true</span></span><br><span class="line"><span class="string">filter = nginx-http-auth</span></span><br><span class="line"><span class="string">logpath = /var/log/nginx/error.log</span></span><br><span class="line"><span class="string">maxretry = 3</span></span><br><span class="line"><span class="string">bantime = 3600</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 防止暴力破解</span></span><br><span class="line"><span class="string">[nginx-noscript]</span></span><br><span class="line"><span class="string">enabled = true</span></span><br><span class="line"><span class="string">filter = nginx-noscript</span></span><br><span class="line"><span class="string">logpath = /var/log/nginx/access.log</span></span><br><span class="line"><span class="string">maxretry = 6</span></span><br><span class="line"><span class="string">bantime = 86400</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 防止恶意爬虫</span></span><br><span class="line"><span class="string">[nginx-badbots]</span></span><br><span class="line"><span class="string">enabled = true</span></span><br><span class="line"><span class="string">filter = nginx-badbots</span></span><br><span class="line"><span class="string">logpath = /var/log/nginx/access.log</span></span><br><span class="line"><span class="string">maxretry = 2</span></span><br><span class="line"><span class="string">bantime = 86400</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 启动fail2ban</span></span><br><span class="line">systemctl <span class="built_in">enable</span> fail2ban</span><br><span class="line">systemctl start fail2ban</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 查看fail2ban状态</span></span><br><span class="line">fail2ban-client status</span><br><span class="line">fail2ban-client status sshd</span><br></pre></td></tr></table></figure>

<h2 id="五、服务安全配置"><a href="#五、服务安全配置" class="headerlink" title="五、服务安全配置"></a>五、服务安全配置</h2><h3 id="5-1-Web服务器安全配置"><a href="#5-1-Web服务器安全配置" class="headerlink" title="5.1 Web服务器安全配置"></a>5.1 Web服务器安全配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. Nginx安全配置</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/nginx/conf.d/security.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 隐藏版本信息</span></span><br><span class="line"><span class="string">server_tokens off;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 安全头配置</span></span><br><span class="line"><span class="string">add_header X-Frame-Options DENY;</span></span><br><span class="line"><span class="string">add_header X-Content-Type-Options nosniff;</span></span><br><span class="line"><span class="string">add_header X-XSS-Protection &quot;1; mode=block&quot;;</span></span><br><span class="line"><span class="string">add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot; always;</span></span><br><span class="line"><span class="string">add_header Content-Security-Policy &quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 限制请求方法</span></span><br><span class="line"><span class="string">if (\$request_method !~ ^(GET|HEAD|POST)\$ ) &#123;</span></span><br><span class="line"><span class="string">    return 405;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 限制文件上传大小</span></span><br><span class="line"><span class="string">client_max_body_size 10M;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 限制请求频率</span></span><br><span class="line"><span class="string">limit_req_zone \$binary_remote_addr zone=login:10m rate=1r/s;</span></span><br><span class="line"><span class="string">limit_req_zone \$binary_remote_addr zone=api:10m rate=10r/s;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁止访问敏感文件</span></span><br><span class="line"><span class="string">location ~ /\. &#123;</span></span><br><span class="line"><span class="string">    deny all;</span></span><br><span class="line"><span class="string">    access_log off;</span></span><br><span class="line"><span class="string">    log_not_found off;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">location ~ ~\$ &#123;</span></span><br><span class="line"><span class="string">    deny all;</span></span><br><span class="line"><span class="string">    access_log off;</span></span><br><span class="line"><span class="string">    log_not_found off;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁止执行PHP文件的目录</span></span><br><span class="line"><span class="string">location /uploads &#123;</span></span><br><span class="line"><span class="string">    location ~ \.php\$ &#123;</span></span><br><span class="line"><span class="string">        deny all;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Apache安全配置</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/httpd/conf.d/security.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 隐藏版本信息</span></span><br><span class="line"><span class="string">ServerTokens Prod</span></span><br><span class="line"><span class="string">ServerSignature Off</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 安全头配置</span></span><br><span class="line"><span class="string">Header always set X-Frame-Options DENY</span></span><br><span class="line"><span class="string">Header always set X-Content-Type-Options nosniff</span></span><br><span class="line"><span class="string">Header always set X-XSS-Protection &quot;1; mode=block&quot;</span></span><br><span class="line"><span class="string">Header always set Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁用不安全的HTTP方法</span></span><br><span class="line"><span class="string">&lt;LimitExcept GET POST HEAD&gt;</span></span><br><span class="line"><span class="string">    Require all denied</span></span><br><span class="line"><span class="string">&lt;/LimitExcept&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁止访问敏感文件</span></span><br><span class="line"><span class="string">&lt;FilesMatch &quot;^\.(htaccess|htpasswd|ini|log|sh|inc|bak)\$&quot;&gt;</span></span><br><span class="line"><span class="string">    Require all denied</span></span><br><span class="line"><span class="string">&lt;/FilesMatch&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁止目录浏览</span></span><br><span class="line"><span class="string">Options -Indexes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 限制请求大小</span></span><br><span class="line"><span class="string">LimitRequestBody 10485760</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-数据库安全配置"><a href="#5-2-数据库安全配置" class="headerlink" title="5.2 数据库安全配置"></a>5.2 数据库安全配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. MySQL安全配置</span></span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 创建MySQL安全配置文件</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/my.cnf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string"># 网络安全</span></span><br><span class="line"><span class="string">bind-address = 127.0.0.1</span></span><br><span class="line"><span class="string">skip-networking = 0</span></span><br><span class="line"><span class="string">port = 3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 禁用危险功能</span></span><br><span class="line"><span class="string">local-infile = 0</span></span><br><span class="line"><span class="string">show-database = 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 日志配置</span></span><br><span class="line"><span class="string">log-error = /var/log/mysqld.log</span></span><br><span class="line"><span class="string">general-log = 1</span></span><br><span class="line"><span class="string">general-log-file = /var/log/mysql-general.log</span></span><br><span class="line"><span class="string">slow-query-log = 1</span></span><br><span class="line"><span class="string">slow-query-log-file = /var/log/mysql-slow.log</span></span><br><span class="line"><span class="string">long-query-time = 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 安全配置</span></span><br><span class="line"><span class="string">sql-mode = STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_AUTO_VALUE_ON_ZERO</span></span><br><span class="line"><span class="string">validate-password = ON</span></span><br><span class="line"><span class="string">validate-password-policy = MEDIUM</span></span><br><span class="line"><span class="string">validate-password-length = 12</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 创建数据库用户权限管理脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /root/mysql_security.sql &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">-- 删除匿名用户</span></span><br><span class="line"><span class="string">DELETE FROM mysql.user WHERE User=&#x27;&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 删除test数据库</span></span><br><span class="line"><span class="string">DROP DATABASE IF EXISTS test;</span></span><br><span class="line"><span class="string">DELETE FROM mysql.db WHERE Db=&#x27;test&#x27; OR Db=&#x27;test\_%&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 禁用root远程登录</span></span><br><span class="line"><span class="string">DELETE FROM mysql.user WHERE User=&#x27;root&#x27; AND Host NOT IN (&#x27;localhost&#x27;, &#x27;127.0.0.1&#x27;, &#x27;::1&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 创建应用用户</span></span><br><span class="line"><span class="string">CREATE USER &#x27;appuser&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;StrongPassword123!&#x27;;</span></span><br><span class="line"><span class="string">GRANT SELECT, INSERT, UPDATE, DELETE ON appdb.* TO &#x27;appuser&#x27;@&#x27;localhost&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 创建备份用户</span></span><br><span class="line"><span class="string">CREATE USER &#x27;backupuser&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;BackupPassword123!&#x27;;</span></span><br><span class="line"><span class="string">GRANT SELECT, LOCK TABLES, SHOW VIEW, EVENT, TRIGGER ON *.* TO &#x27;backupuser&#x27;@&#x27;localhost&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 刷新权限</span></span><br><span class="line"><span class="string">FLUSH PRIVILEGES;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">mysql -u root -p &lt; /root/mysql_security.sql</span><br></pre></td></tr></table></figure>

<h3 id="5-3-邮件服务安全配置"><a href="#5-3-邮件服务安全配置" class="headerlink" title="5.3 邮件服务安全配置"></a>5.3 邮件服务安全配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. Postfix安全配置</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/postfix/main.cf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 安全配置</span></span><br><span class="line"><span class="string">smtpd_banner = \$myhostname ESMTP</span></span><br><span class="line"><span class="string">disable_vrfy_command = yes</span></span><br><span class="line"><span class="string">smtpd_helo_required = yes</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 限制连接</span></span><br><span class="line"><span class="string">smtpd_client_connection_count_limit = 10</span></span><br><span class="line"><span class="string">smtpd_client_connection_rate_limit = 30</span></span><br><span class="line"><span class="string">smtpd_client_message_rate_limit = 100</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># SASL认证</span></span><br><span class="line"><span class="string">smtpd_sasl_auth_enable = yes</span></span><br><span class="line"><span class="string">smtpd_sasl_security_options = noanonymous</span></span><br><span class="line"><span class="string">smtpd_sasl_local_domain = \$myhostname</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># TLS配置</span></span><br><span class="line"><span class="string">smtpd_use_tls = yes</span></span><br><span class="line"><span class="string">smtpd_tls_cert_file = /etc/ssl/certs/postfix.pem</span></span><br><span class="line"><span class="string">smtpd_tls_key_file = /etc/ssl/private/postfix.key</span></span><br><span class="line"><span class="string">smtpd_tls_security_level = may</span></span><br><span class="line"><span class="string">smtpd_tls_protocols = !SSLv2, !SSLv3</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl restart postfix</span><br></pre></td></tr></table></figure>

<h2 id="六、日志监控和审计"><a href="#六、日志监控和审计" class="headerlink" title="六、日志监控和审计"></a>六、日志监控和审计</h2><h3 id="6-1-系统日志配置"><a href="#6-1-系统日志配置" class="headerlink" title="6.1 系统日志配置"></a>6.1 系统日志配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 配置rsyslog安全日志</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/rsyslog.d/50-security.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 安全日志配置</span></span><br><span class="line"><span class="string"># SSH登录日志</span></span><br><span class="line"><span class="string">auth,authpriv.*                 /var/log/auth.log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># sudo命令日志</span></span><br><span class="line"><span class="string">local0.*                        /var/log/sudo.log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 防火墙日志</span></span><br><span class="line"><span class="string">kern.*                          /var/log/firewall.log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 系统安全事件</span></span><br><span class="line"><span class="string">*.emerg                         /var/log/emergency.log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 远程日志服务器（可选）</span></span><br><span class="line"><span class="string">*.* @@logserver.example.com:514</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl restart rsyslog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 配置日志轮转</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/logrotate.d/security &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">/var/log/auth.log</span></span><br><span class="line"><span class="string">/var/log/sudo.log</span></span><br><span class="line"><span class="string">/var/log/firewall.log</span></span><br><span class="line"><span class="string">/var/log/emergency.log &#123;</span></span><br><span class="line"><span class="string">    daily</span></span><br><span class="line"><span class="string">    rotate 30</span></span><br><span class="line"><span class="string">    compress</span></span><br><span class="line"><span class="string">    delaycompress</span></span><br><span class="line"><span class="string">    missingok</span></span><br><span class="line"><span class="string">    notifempty</span></span><br><span class="line"><span class="string">    create 640 root root</span></span><br><span class="line"><span class="string">    postrotate</span></span><br><span class="line"><span class="string">        systemctl reload rsyslog</span></span><br><span class="line"><span class="string">    endscript</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-审计系统配置"><a href="#6-2-审计系统配置" class="headerlink" title="6.2 审计系统配置"></a>6.2 审计系统配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装和配置auditd</span></span><br><span class="line">yum install -y audit</span><br><span class="line">systemctl <span class="built_in">enable</span> auditd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 配置审计规则</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/audit/rules.d/audit.rules &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 删除所有现有规则</span></span><br><span class="line"><span class="string">-D</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 设置缓冲区大小</span></span><br><span class="line"><span class="string">-b 8192</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 设置失败模式</span></span><br><span class="line"><span class="string">-f 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 监控系统调用</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b64 -S clock_settime -k time-change</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b32 -S clock_settime -k time-change</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 监控用户和组管理</span></span><br><span class="line"><span class="string">-w /etc/group -p wa -k identity</span></span><br><span class="line"><span class="string">-w /etc/passwd -p wa -k identity</span></span><br><span class="line"><span class="string">-w /etc/gshadow -p wa -k identity</span></span><br><span class="line"><span class="string">-w /etc/shadow -p wa -k identity</span></span><br><span class="line"><span class="string">-w /etc/security/opasswd -p wa -k identity</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 监控网络配置</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b32 -S sethostname -S setdomainname -k system-locale</span></span><br><span class="line"><span class="string">-w /etc/issue -p wa -k system-locale</span></span><br><span class="line"><span class="string">-w /etc/issue.net -p wa -k system-locale</span></span><br><span class="line"><span class="string">-w /etc/hosts -p wa -k system-locale</span></span><br><span class="line"><span class="string">-w /etc/sysconfig/network -p wa -k system-locale</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 监控权限变更</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b32 -S chmod -S fchmod -S fchmodat -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b64 -S chown -S fchown -S fchownat -S lchown -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b32 -S chown -S fchown -S fchownat -S lchown -F auid&gt;=1000 -F auid!=4294967295 -k perm_mod</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 监控文件访问</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES -F auid&gt;=1000 -F auid!=4294967295 -k access</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b32 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES -F auid&gt;=1000 -F auid!=4294967295 -k access</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EPERM -F auid&gt;=1000 -F auid!=4294967295 -k access</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b32 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EPERM -F auid&gt;=1000 -F auid!=4294967295 -k access</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 监控特权命令</span></span><br><span class="line"><span class="string">-w /usr/bin/passwd -p x -k privileged-passwd</span></span><br><span class="line"><span class="string">-w /usr/sbin/groupadd -p x -k privileged-groupadd</span></span><br><span class="line"><span class="string">-w /usr/sbin/groupmod -p x -k privileged-groupmod</span></span><br><span class="line"><span class="string">-w /usr/sbin/addgroup -p x -k privileged-addgroup</span></span><br><span class="line"><span class="string">-w /usr/sbin/useradd -p x -k privileged-useradd</span></span><br><span class="line"><span class="string">-w /usr/sbin/usermod -p x -k privileged-usermod</span></span><br><span class="line"><span class="string">-w /usr/sbin/adduser -p x -k privileged-adduser</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 监控sudo使用</span></span><br><span class="line"><span class="string">-w /etc/sudoers -p wa -k scope</span></span><br><span class="line"><span class="string">-w /etc/sudoers.d/ -p wa -k scope</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 监控内核模块</span></span><br><span class="line"><span class="string">-w /sbin/insmod -p x -k modules</span></span><br><span class="line"><span class="string">-w /sbin/rmmod -p x -k modules</span></span><br><span class="line"><span class="string">-w /sbin/modprobe -p x -k modules</span></span><br><span class="line"><span class="string">-a always,exit -F arch=b64 -S init_module -S delete_module -k modules</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 使规则不可变</span></span><br><span class="line"><span class="string">-e 2</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 重启auditd服务</span></span><br><span class="line">systemctl restart auditd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 查看审计日志</span></span><br><span class="line">auditctl -l</span><br><span class="line">ausearch -k identity</span><br><span class="line">ausearch -k privileged-passwd</span><br></pre></td></tr></table></figure>

<h3 id="6-3-安全监控脚本"><a href="#6-3-安全监控脚本" class="headerlink" title="6.3 安全监控脚本"></a>6.3 安全监控脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建安全监控脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/bin/security_monitor.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 安全监控脚本</span></span><br><span class="line"></span><br><span class="line">LOGFILE=<span class="string">&quot;/var/log/security_monitor.log&quot;</span></span><br><span class="line">ALERT_EMAIL=<span class="string">&quot;admin@example.com&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> <span class="string">&#x27;+%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查失败的SSH登录</span></span><br><span class="line"><span class="function"><span class="title">check_ssh_failures</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> failures=$(grep <span class="string">&quot;Failed password&quot;</span> /var/log/secure | grep <span class="string">&quot;<span class="subst">$(date &#x27;+%b %d&#x27;)</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$failures</span> -gt 10 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: WARNING - <span class="variable">$failures</span> SSH login failures detected&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;High number of SSH failures: <span class="variable">$failures</span>&quot;</span> | mail -s <span class="string">&quot;SSH Security Alert&quot;</span> <span class="variable">$ALERT_EMAIL</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查新用户创建</span></span><br><span class="line"><span class="function"><span class="title">check_new_users</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> new_users=$(grep <span class="string">&quot;new user&quot;</span> /var/log/secure | grep <span class="string">&quot;<span class="subst">$(date &#x27;+%b %d&#x27;)</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$new_users</span> -gt 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: INFO - <span class="variable">$new_users</span> new users created&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">        grep <span class="string">&quot;new user&quot;</span> /var/log/secure | grep <span class="string">&quot;<span class="subst">$(date &#x27;+%b %d&#x27;)</span>&quot;</span> | mail -s <span class="string">&quot;New User Alert&quot;</span> <span class="variable">$ALERT_EMAIL</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查sudo使用</span></span><br><span class="line"><span class="function"><span class="title">check_sudo_usage</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> sudo_commands=$(grep <span class="string">&quot;COMMAND&quot;</span> /var/log/sudo.log | grep <span class="string">&quot;<span class="subst">$(date &#x27;+%b %d&#x27;)</span>&quot;</span> | <span class="built_in">wc</span> -l)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$sudo_commands</span> -gt 50 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: WARNING - High sudo usage: <span class="variable">$sudo_commands</span> commands&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查磁盘使用率</span></span><br><span class="line"><span class="function"><span class="title">check_disk_usage</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> disk_usage=$(<span class="built_in">df</span> / | awk <span class="string">&#x27;NR==2 &#123;print $5&#125;&#x27;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;%&#x27;</span> -f1)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$disk_usage</span> -gt 90 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: CRITICAL - Disk usage at <span class="variable">$&#123;disk_usage&#125;</span>%&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Disk usage critical: <span class="variable">$&#123;disk_usage&#125;</span>%&quot;</span> | mail -s <span class="string">&quot;Disk Space Alert&quot;</span> <span class="variable">$ALERT_EMAIL</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查异常进程</span></span><br><span class="line"><span class="function"><span class="title">check_suspicious_processes</span></span>() &#123;</span><br><span class="line">    <span class="comment"># 检查高CPU使用率进程</span></span><br><span class="line">    <span class="built_in">local</span> high_cpu=$(ps aux --<span class="built_in">sort</span>=-%cpu | <span class="built_in">head</span> -2 | <span class="built_in">tail</span> -1 | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (( $(echo &quot;<span class="variable">$high_cpu</span> &gt; <span class="number">80</span>&quot; | bc -l) )); <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: WARNING - High CPU usage process detected: <span class="variable">$high_cpu</span>%&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查可疑进程名</span></span><br><span class="line">    <span class="built_in">local</span> suspicious=$(ps aux | grep -E <span class="string">&#x27;(nc|netcat|ncat|socat|telnet)&#x27;</span> | grep -v grep)</span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$suspicious</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: ALERT - Suspicious process detected: <span class="variable">$suspicious</span>&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Suspicious process: <span class="variable">$suspicious</span>&quot;</span> | mail -s <span class="string">&quot;Process Security Alert&quot;</span> <span class="variable">$ALERT_EMAIL</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行检查</span></span><br><span class="line">check_ssh_failures</span><br><span class="line">check_new_users</span><br><span class="line">check_sudo_usage</span><br><span class="line">check_disk_usage</span><br><span class="line">check_suspicious_processes</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Security monitoring completed&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/security_monitor.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 添加到crontab</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;*/15 * * * * /usr/local/bin/security_monitor.sh&quot;</span> | crontab -</span><br></pre></td></tr></table></figure>

<h2 id="七、高级安全防护"><a href="#七、高级安全防护" class="headerlink" title="七、高级安全防护"></a>七、高级安全防护</h2><h3 id="7-1-入侵检测系统（IDS）"><a href="#7-1-入侵检测系统（IDS）" class="headerlink" title="7.1 入侵检测系统（IDS）"></a>7.1 入侵检测系统（IDS）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装AIDE（文件完整性检查）</span></span><br><span class="line">yum install -y aide</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 初始化AIDE数据库</span></span><br><span class="line">aide --init</span><br><span class="line"><span class="built_in">mv</span> /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 配置AIDE</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/aide.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># 自定义监控规则</span></span><br><span class="line"><span class="string">/etc/passwd f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">/etc/shadow f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">/etc/group f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">/etc/sudoers f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">/etc/ssh/sshd_config f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">/boot f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">/bin f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">/sbin f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">/usr/bin f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">/usr/sbin f+p+u+g+s+m+c+md5+sha1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 创建AIDE检查脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/bin/aide_check.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># AIDE文件完整性检查脚本</span></span><br><span class="line"></span><br><span class="line">LOGFILE=<span class="string">&quot;/var/log/aide_check.log&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> <span class="string">&#x27;+%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Starting AIDE check&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行AIDE检查</span></span><br><span class="line">aide --check &gt; /tmp/aide_report.txt 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: AIDE check completed - No changes detected&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: AIDE check completed - Changes detected&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    <span class="built_in">cat</span> /tmp/aide_report.txt &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    <span class="comment"># 发送告警邮件</span></span><br><span class="line">    mail -s <span class="string">&quot;AIDE File Integrity Alert&quot;</span> admin@example.com &lt; /tmp/aide_report.txt</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /tmp/aide_report.txt</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/aide_check.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 添加定时任务</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0 2 * * * /usr/local/bin/aide_check.sh&quot;</span> &gt;&gt; /var/spool/cron/root</span><br></pre></td></tr></table></figure>

<h3 id="7-2-恶意软件检测"><a href="#7-2-恶意软件检测" class="headerlink" title="7.2 恶意软件检测"></a>7.2 恶意软件检测</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装ClamAV</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y clamav clamav-update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 更新病毒库</span></span><br><span class="line">freshclam</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 创建扫描脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/bin/malware_scan.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 恶意软件扫描脚本</span></span><br><span class="line"></span><br><span class="line">LOGFILE=<span class="string">&quot;/var/log/malware_scan.log&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> <span class="string">&#x27;+%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">SCAN_DIRS=<span class="string">&quot;/home /var/www /tmp /var/tmp&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Starting malware scan&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新病毒库</span></span><br><span class="line">freshclam &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扫描指定目录</span></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> <span class="variable">$SCAN_DIRS</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$dir</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Scanning <span class="variable">$dir</span>&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">        clamscan -r --infected --remove=<span class="built_in">yes</span> <span class="string">&quot;<span class="variable">$dir</span>&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 扫描系统关键目录</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Scanning system directories&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">clamscan -r --infected /bin /sbin /usr/bin /usr/sbin &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Malware scan completed&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否发现威胁</span></span><br><span class="line"><span class="keyword">if</span> grep -q <span class="string">&quot;FOUND&quot;</span> <span class="variable">$LOGFILE</span>; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Malware detected on <span class="subst">$(hostname)</span>&quot;</span> | mail -s <span class="string">&quot;Malware Alert&quot;</span> admin@example.com</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/malware_scan.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 添加定时任务</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0 3 * * 0 /usr/local/bin/malware_scan.sh&quot;</span> &gt;&gt; /var/spool/cron/root</span><br></pre></td></tr></table></figure>

<h3 id="7-3-网络流量监控"><a href="#7-3-网络流量监控" class="headerlink" title="7.3 网络流量监控"></a>7.3 网络流量监控</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 安装ntopng</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y ntopng</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 配置ntopng</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/ntopng/ntopng.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># ntopng配置</span></span><br><span class="line"><span class="string">-i=eth0</span></span><br><span class="line"><span class="string">-P=/var/lib/ntopng/ntopng.pid</span></span><br><span class="line"><span class="string">-d=/var/lib/ntopng</span></span><br><span class="line"><span class="string">-w=3000</span></span><br><span class="line"><span class="string">-U=ntopng</span></span><br><span class="line"><span class="string">-u=nobody</span></span><br><span class="line"><span class="string">--local-networks=&quot;192.168.1.0/24,10.0.0.0/8,172.16.0.0/12&quot;</span></span><br><span class="line"><span class="string">--interface-name=eth0@Internal</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 启动ntopng</span></span><br><span class="line">systemctl <span class="built_in">enable</span> ntopng</span><br><span class="line">systemctl start ntopng</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 创建流量异常检测脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/bin/traffic_monitor.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 网络流量异常检测脚本</span></span><br><span class="line"></span><br><span class="line">LOGFILE=<span class="string">&quot;/var/log/traffic_monitor.log&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> <span class="string">&#x27;+%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">INTERFACE=<span class="string">&quot;eth0&quot;</span></span><br><span class="line">THRESHOLD_MBPS=100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前流量</span></span><br><span class="line">RX_BYTES=$(<span class="built_in">cat</span> /sys/class/net/<span class="variable">$INTERFACE</span>/statistics/rx_bytes)</span><br><span class="line">TX_BYTES=$(<span class="built_in">cat</span> /sys/class/net/<span class="variable">$INTERFACE</span>/statistics/tx_bytes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待1秒</span></span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次获取流量</span></span><br><span class="line">RX_BYTES_NEW=$(<span class="built_in">cat</span> /sys/class/net/<span class="variable">$INTERFACE</span>/statistics/rx_bytes)</span><br><span class="line">TX_BYTES_NEW=$(<span class="built_in">cat</span> /sys/class/net/<span class="variable">$INTERFACE</span>/statistics/tx_bytes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算速率（Mbps）</span></span><br><span class="line">RX_RATE=$(( (RX_BYTES_NEW - RX_BYTES) * <span class="number">8</span> / <span class="number">1000000</span> ))</span><br><span class="line">TX_RATE=$(( (TX_BYTES_NEW - TX_BYTES) * <span class="number">8</span> / <span class="number">1000000</span> ))</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: RX: <span class="variable">$&#123;RX_RATE&#125;</span>Mbps, TX: <span class="variable">$&#123;TX_RATE&#125;</span>Mbps&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否超过阈值</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$RX_RATE</span> -gt <span class="variable">$THRESHOLD_MBPS</span> ] || [ <span class="variable">$TX_RATE</span> -gt <span class="variable">$THRESHOLD_MBPS</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: WARNING - High traffic detected: RX=<span class="variable">$&#123;RX_RATE&#125;</span>Mbps, TX=<span class="variable">$&#123;TX_RATE&#125;</span>Mbps&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;High network traffic detected on <span class="subst">$(hostname)</span>: RX=<span class="variable">$&#123;RX_RATE&#125;</span>Mbps, TX=<span class="variable">$&#123;TX_RATE&#125;</span>Mbps&quot;</span> | mail -s <span class="string">&quot;Traffic Alert&quot;</span> admin@example.com</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/traffic_monitor.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 添加定时任务</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;*/5 * * * * /usr/local/bin/traffic_monitor.sh&quot;</span> &gt;&gt; /var/spool/cron/root</span><br></pre></td></tr></table></figure>

<h2 id="八、备份和恢复"><a href="#八、备份和恢复" class="headerlink" title="八、备份和恢复"></a>八、备份和恢复</h2><h3 id="8-1-系统备份策略"><a href="#8-1-系统备份策略" class="headerlink" title="8.1 系统备份策略"></a>8.1 系统备份策略</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建系统备份脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/bin/system_backup.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 系统备份脚本</span></span><br><span class="line"></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> <span class="string">&#x27;+%Y%m%d_%H%M%S&#x27;</span>)</span><br><span class="line">LOGFILE=<span class="string">&quot;/var/log/backup.log&quot;</span></span><br><span class="line">RETENTION_DAYS=30</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建备份目录</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$BACKUP_DIR</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Starting system backup&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份系统配置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Backing up system configuration&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">tar -czf <span class="variable">$BACKUP_DIR</span>/system_config_<span class="variable">$DATE</span>.tar.gz \</span><br><span class="line">    /etc \</span><br><span class="line">    /boot/grub2 \</span><br><span class="line">    /var/spool/cron \</span><br><span class="line">    /root/.ssh \</span><br><span class="line">    --exclude=/etc/shadow- \</span><br><span class="line">    --exclude=/etc/passwd- \</span><br><span class="line">    --exclude=/etc/group- 2&gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份用户数据</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Backing up user data&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">tar -czf <span class="variable">$BACKUP_DIR</span>/user_data_<span class="variable">$DATE</span>.tar.gz \</span><br><span class="line">    /home \</span><br><span class="line">    --exclude=/home/*/.cache \</span><br><span class="line">    --exclude=/home/*/.tmp 2&gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份日志文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Backing up log files&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">tar -czf <span class="variable">$BACKUP_DIR</span>/logs_<span class="variable">$DATE</span>.tar.gz \</span><br><span class="line">    /var/log 2&gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份数据库（如果存在）</span></span><br><span class="line"><span class="keyword">if</span> systemctl is-active --quiet mysqld; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Backing up MySQL databases&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    mysqldump --all-databases --single-transaction --routines --triggers &gt; <span class="variable">$BACKUP_DIR</span>/mysql_<span class="variable">$DATE</span>.sql</span><br><span class="line">    gzip <span class="variable">$BACKUP_DIR</span>/mysql_<span class="variable">$DATE</span>.sql</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理旧备份</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Cleaning old backups&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">find <span class="variable">$BACKUP_DIR</span> -name <span class="string">&quot;*.tar.gz&quot;</span> -mtime +<span class="variable">$RETENTION_DAYS</span> -delete</span><br><span class="line">find <span class="variable">$BACKUP_DIR</span> -name <span class="string">&quot;*.sql.gz&quot;</span> -mtime +<span class="variable">$RETENTION_DAYS</span> -delete</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成备份报告</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Backup completed&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Backup files:&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">ls</span> -lh <span class="variable">$BACKUP_DIR</span>/*<span class="variable">$DATE</span>* &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送备份报告</span></span><br><span class="line"><span class="built_in">tail</span> -20 <span class="variable">$LOGFILE</span> | mail -s <span class="string">&quot;Backup Report - <span class="subst">$(hostname)</span>&quot;</span> admin@example.com</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/system_backup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 添加定时任务</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;0 1 * * * /usr/local/bin/system_backup.sh&quot;</span> &gt;&gt; /var/spool/cron/root</span><br></pre></td></tr></table></figure>

<h3 id="8-2-灾难恢复计划"><a href="#8-2-灾难恢复计划" class="headerlink" title="8.2 灾难恢复计划"></a>8.2 灾难恢复计划</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建恢复脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/bin/system_restore.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 系统恢复脚本</span></span><br><span class="line"></span><br><span class="line">BACKUP_DIR=<span class="string">&quot;/backup&quot;</span></span><br><span class="line">LOGFILE=<span class="string">&quot;/var/log/restore.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -ne 1 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> &lt;backup_date&gt;&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Example: <span class="variable">$0</span> 20240310_120000&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">BACKUP_DATE=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Starting system restore from backup <span class="variable">$BACKUP_DATE</span>&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查备份文件是否存在</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/system_config_<span class="variable">$BACKUP_DATE</span>.tar.gz&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Error: Backup file not found&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份当前配置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Backing up current configuration&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">cp</span> -r /etc /etc.backup.$(<span class="built_in">date</span> +%Y%m%d_%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复系统配置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Restoring system configuration&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">tar -xzf <span class="variable">$BACKUP_DIR</span>/system_config_<span class="variable">$BACKUP_DATE</span>.tar.gz -C / 2&gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复用户数据</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/user_data_<span class="variable">$BACKUP_DATE</span>.tar.gz&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Restoring user data&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    tar -xzf <span class="variable">$BACKUP_DIR</span>/user_data_<span class="variable">$BACKUP_DATE</span>.tar.gz -C / 2&gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复数据库</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$BACKUP_DIR</span>/mysql_<span class="variable">$BACKUP_DATE</span>.sql.gz&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Restoring MySQL databases&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    zcat <span class="variable">$BACKUP_DIR</span>/mysql_<span class="variable">$BACKUP_DATE</span>.sql.gz | mysql 2&gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启相关服务</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: Restarting services&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">systemctl restart sshd</span><br><span class="line">systemctl restart firewalld</span><br><span class="line">systemctl restart rsyslog</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>: System restore completed&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Please reboot the system to ensure all changes take effect&quot;</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/system_restore.sh</span><br></pre></td></tr></table></figure>

<h2 id="九、安全合规和最佳实践"><a href="#九、安全合规和最佳实践" class="headerlink" title="九、安全合规和最佳实践"></a>九、安全合规和最佳实践</h2><h3 id="9-1-安全基线检查"><a href="#9-1-安全基线检查" class="headerlink" title="9.1 安全基线检查"></a>9.1 安全基线检查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建安全基线检查脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/bin/security_baseline.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 安全基线检查脚本</span></span><br><span class="line"></span><br><span class="line">REPORT_FILE=<span class="string">&quot;/tmp/security_baseline_report.txt&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> <span class="string">&#x27;+%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Security Baseline Check Report ===&quot;</span> &gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Date: <span class="variable">$DATE</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Hostname: <span class="subst">$(hostname)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 账户安全检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1. Account Security:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Users with UID 0: <span class="subst">$(awk -F: &#x27;$3 == 0 &#123;print $1&#125;&#x27; /etc/passwd | tr &#x27;\n&#x27; &#x27; &#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Users with empty passwords: <span class="subst">$(awk -F: &#x27;$2 == <span class="string">&quot;&quot;</span> &#123;print $1&#125;&#x27; /etc/shadow | tr &#x27;\n&#x27; &#x27; &#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Password aging enabled: <span class="subst">$(grep PASS_MAX_DAYS /etc/login.defs | grep -v &#x27;#&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. SSH安全检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2. SSH Security:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Root login disabled: <span class="subst">$(grep &#x27;^PermitRootLogin no&#x27; /etc/ssh/sshd_config &amp;&amp; echo &#x27;YES&#x27; || echo &#x27;NO&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Password auth disabled: <span class="subst">$(grep &#x27;^PasswordAuthentication no&#x27; /etc/ssh/sshd_config &amp;&amp; echo &#x27;YES&#x27; || echo &#x27;NO&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Default port changed: <span class="subst">$(grep &#x27;^Port&#x27; /etc/ssh/sshd_config | grep -v &#x27;22&#x27; &amp;&amp; echo &#x27;YES&#x27; || echo &#x27;NO&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 防火墙检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;3. Firewall Status:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">if</span> systemctl is-active --quiet firewalld; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   Firewalld: Active&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   Active zones: <span class="subst">$(firewall-cmd --get-active-zones | grep -v interfaces)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">elif</span> systemctl is-active --quiet ufw; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   UFW: Active&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   Firewall: Inactive&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 系统更新检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;4. System Updates:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v yum &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   Available updates: <span class="subst">$(yum check-update 2&gt;/dev/null | grep -c &#x27;^[a-zA-Z]&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">command</span> -v apt &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;   Available updates: <span class="subst">$(apt list --upgradable 2&gt;/dev/null | grep -c upgradable)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 服务检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;5. Running Services:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   Critical services status:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">for</span> service <span class="keyword">in</span> sshd firewalld rsyslog auditd; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> systemctl is-active --quiet <span class="variable">$service</span>; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;     <span class="variable">$service</span>: Running&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;     <span class="variable">$service</span>: Stopped&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 文件权限检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;6. File Permissions:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   /etc/shadow permissions: <span class="subst">$(ls -l /etc/shadow | awk &#x27;&#123;print $1&#125;&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   /etc/passwd permissions: <span class="subst">$(ls -l /etc/passwd | awk &#x27;&#123;print $1&#125;&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   World-writable files: <span class="subst">$(find / -type f -perm -002 2&gt;/dev/null | wc -l)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   SUID files: <span class="subst">$(find / -type f -perm -4000 2&gt;/dev/null | wc -l)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 网络安全检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;7. Network Security:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   IP forwarding disabled: <span class="subst">$(sysctl net.ipv4.ip_forward | grep -q &#x27;= 0&#x27; &amp;&amp; echo &#x27;YES&#x27; || echo &#x27;NO&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   SYN cookies enabled: <span class="subst">$(sysctl net.ipv4.tcp_syncookies | grep -q &#x27;= 1&#x27; &amp;&amp; echo &#x27;YES&#x27; || echo &#x27;NO&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;   ICMP redirects disabled: <span class="subst">$(sysctl net.ipv4.conf.all.accept_redirects | grep -q &#x27;= 0&#x27; &amp;&amp; echo &#x27;YES&#x27; || echo &#x27;NO&#x27;)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== End of Report ===&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示报告</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送报告</span></span><br><span class="line">mail -s <span class="string">&quot;Security Baseline Report - <span class="subst">$(hostname)</span>&quot;</span> admin@example.com &lt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/security_baseline.sh</span><br></pre></td></tr></table></figure>

<h3 id="9-2-合规性检查"><a href="#9-2-合规性检查" class="headerlink" title="9.2 合规性检查"></a>9.2 合规性检查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建CIS基准检查脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/bin/cis_benchmark.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># CIS基准检查脚本</span></span><br><span class="line"></span><br><span class="line">REPORT_FILE=<span class="string">&quot;/tmp/cis_benchmark_report.txt&quot;</span></span><br><span class="line">SCORE=0</span><br><span class="line">TOTAL=0</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== CIS Benchmark Check Report ===&quot;</span> &gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Date: <span class="subst">$(date)</span>&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查函数</span></span><br><span class="line"><span class="function"><span class="title">check_item</span></span>() &#123;</span><br><span class="line">    <span class="built_in">local</span> description=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">    <span class="built_in">local</span> <span class="built_in">command</span>=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">    <span class="built_in">local</span> expected=<span class="string">&quot;<span class="variable">$3</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">echo</span> -n <span class="string">&quot;Checking: <span class="variable">$description</span>... &quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">eval</span> <span class="string">&quot;<span class="variable">$command</span>&quot;</span> | grep -q <span class="string">&quot;<span class="variable">$expected</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;PASS&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">        ((SCORE++))</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;FAIL&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ((TOTAL++))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 文件系统配置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1. Filesystem Configuration:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">check_item <span class="string">&quot;Separate /tmp partition&quot;</span> <span class="string">&quot;mount | grep &#x27;/tmp&#x27;&quot;</span> <span class="string">&quot;/tmp&quot;</span></span><br><span class="line">check_item <span class="string">&quot;nodev option on /tmp&quot;</span> <span class="string">&quot;mount | grep &#x27;/tmp&#x27;&quot;</span> <span class="string">&quot;nodev&quot;</span></span><br><span class="line">check_item <span class="string">&quot;nosuid option on /tmp&quot;</span> <span class="string">&quot;mount | grep &#x27;/tmp&#x27;&quot;</span> <span class="string">&quot;nosuid&quot;</span></span><br><span class="line">check_item <span class="string">&quot;noexec option on /tmp&quot;</span> <span class="string">&quot;mount | grep &#x27;/tmp&#x27;&quot;</span> <span class="string">&quot;noexec&quot;</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 软件更新</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;2. Software Updates:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">check_item <span class="string">&quot;GPG keys configured&quot;</span> <span class="string">&quot;rpm -q gpg-pubkey&quot;</span> <span class="string">&quot;gpg-pubkey&quot;</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 服务配置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;3. Service Configuration:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">check_item <span class="string">&quot;Telnet server disabled&quot;</span> <span class="string">&quot;systemctl is-enabled telnet.socket 2&gt;/dev/null&quot;</span> <span class="string">&quot;disabled&quot;</span></span><br><span class="line">check_item <span class="string">&quot;RSH server disabled&quot;</span> <span class="string">&quot;systemctl is-enabled rsh.socket 2&gt;/dev/null&quot;</span> <span class="string">&quot;disabled&quot;</span></span><br><span class="line">check_item <span class="string">&quot;NIS server disabled&quot;</span> <span class="string">&quot;systemctl is-enabled ypserv 2&gt;/dev/null&quot;</span> <span class="string">&quot;disabled&quot;</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 网络配置</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;4. Network Configuration:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">check_item <span class="string">&quot;IP forwarding disabled&quot;</span> <span class="string">&quot;sysctl net.ipv4.ip_forward&quot;</span> <span class="string">&quot;= 0&quot;</span></span><br><span class="line">check_item <span class="string">&quot;Send redirects disabled&quot;</span> <span class="string">&quot;sysctl net.ipv4.conf.all.send_redirects&quot;</span> <span class="string">&quot;= 0&quot;</span></span><br><span class="line">check_item <span class="string">&quot;Source routed packets disabled&quot;</span> <span class="string">&quot;sysctl net.ipv4.conf.all.accept_source_route&quot;</span> <span class="string">&quot;= 0&quot;</span></span><br><span class="line">check_item <span class="string">&quot;ICMP redirects disabled&quot;</span> <span class="string">&quot;sysctl net.ipv4.conf.all.accept_redirects&quot;</span> <span class="string">&quot;= 0&quot;</span></span><br><span class="line">check_item <span class="string">&quot;Log martians enabled&quot;</span> <span class="string">&quot;sysctl net.ipv4.conf.all.log_martians&quot;</span> <span class="string">&quot;= 1&quot;</span></span><br><span class="line">check_item <span class="string">&quot;SYN cookies enabled&quot;</span> <span class="string">&quot;sysctl net.ipv4.tcp_syncookies&quot;</span> <span class="string">&quot;= 1&quot;</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 日志和审计</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;5. Logging and Auditing:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">check_item <span class="string">&quot;rsyslog installed&quot;</span> <span class="string">&quot;rpm -q rsyslog&quot;</span> <span class="string">&quot;rsyslog&quot;</span></span><br><span class="line">check_item <span class="string">&quot;auditd enabled&quot;</span> <span class="string">&quot;systemctl is-enabled auditd&quot;</span> <span class="string">&quot;enabled&quot;</span></span><br><span class="line">check_item <span class="string">&quot;audit log file permissions&quot;</span> <span class="string">&quot;ls -l /var/log/audit/audit.log&quot;</span> <span class="string">&quot;^-rw-------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 系统访问认证和授权</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;6. System Access, Authentication and Authorization:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">check_item <span class="string">&quot;cron daemon enabled&quot;</span> <span class="string">&quot;systemctl is-enabled crond&quot;</span> <span class="string">&quot;enabled&quot;</span></span><br><span class="line">check_item <span class="string">&quot;SSH Protocol 2&quot;</span> <span class="string">&quot;grep &#x27;^Protocol 2&#x27; /etc/ssh/sshd_config&quot;</span> <span class="string">&quot;Protocol 2&quot;</span></span><br><span class="line">check_item <span class="string">&quot;SSH root login disabled&quot;</span> <span class="string">&quot;grep &#x27;^PermitRootLogin no&#x27; /etc/ssh/sshd_config&quot;</span> <span class="string">&quot;PermitRootLogin no&quot;</span></span><br><span class="line">check_item <span class="string">&quot;SSH empty passwords disabled&quot;</span> <span class="string">&quot;grep &#x27;^PermitEmptyPasswords no&#x27; /etc/ssh/sshd_config&quot;</span> <span class="string">&quot;PermitEmptyPasswords no&quot;</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 用户账户和环境</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;7. User Accounts and Environment:&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line">check_item <span class="string">&quot;Password expiration&quot;</span> <span class="string">&quot;grep &#x27;^PASS_MAX_DAYS&#x27; /etc/login.defs&quot;</span> <span class="string">&quot;PASS_MAX_DAYS&quot;</span></span><br><span class="line">check_item <span class="string">&quot;Password minimum days&quot;</span> <span class="string">&quot;grep &#x27;^PASS_MIN_DAYS&#x27; /etc/login.defs&quot;</span> <span class="string">&quot;PASS_MIN_DAYS&quot;</span></span><br><span class="line">check_item <span class="string">&quot;Default umask&quot;</span> <span class="string">&quot;grep &#x27;umask 027&#x27; /etc/bashrc&quot;</span> <span class="string">&quot;umask 027&quot;</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算得分</span></span><br><span class="line">PERCENTAGE=$((SCORE * <span class="number">100</span> / TOTAL))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== Summary ===&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Score: <span class="variable">$SCORE</span>/<span class="variable">$TOTAL</span> (<span class="variable">$PERCENTAGE</span>%)&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$PERCENTAGE</span> -ge 80 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Status: GOOD&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$PERCENTAGE</span> -ge 60 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Status: FAIR&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Status: POOR&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=== End of Report ===&quot;</span> &gt;&gt; <span class="variable">$REPORT_FILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示报告</span></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$REPORT_FILE</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/cis_benchmark.sh</span><br></pre></td></tr></table></figure>

<h3 id="9-3-安全加固自动化脚本"><a href="#9-3-安全加固自动化脚本" class="headerlink" title="9.3 安全加固自动化脚本"></a>9.3 安全加固自动化脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建一键安全加固脚本</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/bin/security_hardening.sh &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 一键安全加固脚本</span></span><br><span class="line"></span><br><span class="line">LOGFILE=<span class="string">&quot;/var/log/security_hardening.log&quot;</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> <span class="string">&#x27;+%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Starting security hardening&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 系统更新</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Updating system packages&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v yum &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    yum update -y &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">command</span> -v apt &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    apt update &amp;&amp; apt upgrade -y &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 禁用不必要的服务</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Disabling unnecessary services&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="keyword">for</span> service <span class="keyword">in</span> telnet rsh ypbind tftp; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> systemctl is-enabled <span class="variable">$service</span> &amp;&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        systemctl <span class="built_in">disable</span> <span class="variable">$service</span> &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line">        systemctl stop <span class="variable">$service</span> &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Disabled service: <span class="variable">$service</span>&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 配置防火墙</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Configuring firewall&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v firewall-cmd &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    systemctl <span class="built_in">enable</span> firewalld &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line">    systemctl start firewalld &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line">    firewall-cmd --set-default-zone=public &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line">    firewall-cmd --permanent --remove-service=dhcpv6-client &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line">    firewall-cmd --reload &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 配置SSH安全</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Configuring SSH security&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">cp</span> /etc/ssh/sshd_config /etc/ssh/sshd_config.backup</span><br><span class="line">sed -i <span class="string">&#x27;s/#PermitRootLogin yes/PermitRootLogin no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">sed -i <span class="string">&#x27;s/#PasswordAuthentication yes/PasswordAuthentication no/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line">sed -i <span class="string">&#x27;s/#MaxAuthTries 6/MaxAuthTries 3/&#x27;</span> /etc/ssh/sshd_config</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Protocol 2&quot;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">systemctl restart sshd &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 设置文件权限</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Setting file permissions&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/shadow</span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/gshadow</span><br><span class="line"><span class="built_in">chmod</span> 644 /etc/passwd</span><br><span class="line"><span class="built_in">chmod</span> 644 /etc/group</span><br><span class="line"><span class="built_in">chmod</span> 700 /root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 配置内核参数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Configuring kernel parameters&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/99-security.conf &lt;&lt; <span class="string">EOSYSCTL</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.send_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.send_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_source_route = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.accept_source_route = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.accept_redirects = 0</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.log_martians = 1</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.log_martians = 1</span></span><br><span class="line"><span class="string">net.ipv4.tcp_syncookies = 1</span></span><br><span class="line"><span class="string">kernel.sysrq = 0</span></span><br><span class="line"><span class="string">fs.suid_dumpable = 0</span></span><br><span class="line"><span class="string">EOSYSCTL</span></span><br><span class="line">sysctl -p /etc/sysctl.d/99-security.conf &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 配置密码策略</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Configuring password policy&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/security/pwquality.conf ]; <span class="keyword">then</span></span><br><span class="line">    sed -i <span class="string">&#x27;s/# minlen = 8/minlen = 12/&#x27;</span> /etc/security/pwquality.conf</span><br><span class="line">    sed -i <span class="string">&#x27;s/# lcredit = 1/lcredit = -1/&#x27;</span> /etc/security/pwquality.conf</span><br><span class="line">    sed -i <span class="string">&#x27;s/# ucredit = 1/ucredit = -1/&#x27;</span> /etc/security/pwquality.conf</span><br><span class="line">    sed -i <span class="string">&#x27;s/# dcredit = 1/dcredit = -1/&#x27;</span> /etc/security/pwquality.conf</span><br><span class="line">    sed -i <span class="string">&#x27;s/# ocredit = 1/ocredit = -1/&#x27;</span> /etc/security/pwquality.conf</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. 启用审计</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Enabling audit&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v auditd &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    systemctl <span class="built_in">enable</span> auditd &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line">    systemctl start auditd &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9. 安装安全工具</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Installing security tools&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v yum &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    yum install -y fail2ban aide rkhunter &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">command</span> -v apt &amp;&gt; /dev/null; <span class="keyword">then</span></span><br><span class="line">    apt install -y fail2ban aide rkhunter &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$DATE</span>: Security hardening completed&quot;</span> &gt;&gt; <span class="variable">$LOGFILE</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Security hardening completed. Please review the log file: <span class="variable">$LOGFILE</span>&quot;</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/security_hardening.sh</span><br></pre></td></tr></table></figure>

<h2 id="十、总结和建议"><a href="#十、总结和建议" class="headerlink" title="十、总结和建议"></a>十、总结和建议</h2><h3 id="10-1-安全加固检查清单"><a href="#10-1-安全加固检查清单" class="headerlink" title="10.1 安全加固检查清单"></a>10.1 安全加固检查清单</h3><p><strong>基础安全配置</strong>：</p>
<ul>
<li><input disabled="" type="checkbox"> 系统及时更新和补丁管理</li>
<li><input disabled="" type="checkbox"> 禁用不必要的服务和端口</li>
<li><input disabled="" type="checkbox"> 配置安全的内核参数</li>
<li><input disabled="" type="checkbox"> 设置正确的文件和目录权限</li>
<li><input disabled="" type="checkbox"> 配置安全的挂载选项</li>
</ul>
<p><strong>用户和权限管理</strong>：</p>
<ul>
<li><input disabled="" type="checkbox"> 禁用或删除不必要的用户账户</li>
<li><input disabled="" type="checkbox"> 配置强密码策略</li>
<li><input disabled="" type="checkbox"> 实施账户锁定策略</li>
<li><input disabled="" type="checkbox"> 配置sudo权限最小化</li>
<li><input disabled="" type="checkbox"> 定期审查用户权限</li>
</ul>
<p><strong>网络安全</strong>：</p>
<ul>
<li><input disabled="" type="checkbox"> 配置防火墙规则</li>
<li><input disabled="" type="checkbox"> 修改默认服务端口</li>
<li><input disabled="" type="checkbox"> 禁用不安全的网络协议</li>
<li><input disabled="" type="checkbox"> 配置入侵检测系统</li>
<li><input disabled="" type="checkbox"> 实施网络流量监控</li>
</ul>
<p><strong>SSH安全</strong>：</p>
<ul>
<li><input disabled="" type="checkbox"> 禁用root远程登录</li>
<li><input disabled="" type="checkbox"> 使用密钥认证替代密码认证</li>
<li><input disabled="" type="checkbox"> 修改默认SSH端口</li>
<li><input disabled="" type="checkbox"> 配置SSH访问限制</li>
<li><input disabled="" type="checkbox"> 启用SSH日志记录</li>
</ul>
<p><strong>日志和监控</strong>：</p>
<ul>
<li><input disabled="" type="checkbox"> 配置集中日志管理</li>
<li><input disabled="" type="checkbox"> 启用系统审计</li>
<li><input disabled="" type="checkbox"> 配置安全事件告警</li>
<li><input disabled="" type="checkbox"> 定期分析日志文件</li>
<li><input disabled="" type="checkbox"> 建立安全监控体系</li>
</ul>
<p><strong>备份和恢复</strong>：</p>
<ul>
<li><input disabled="" type="checkbox"> 制定备份策略</li>
<li><input disabled="" type="checkbox"> 定期测试恢复流程</li>
<li><input disabled="" type="checkbox"> 配置异地备份</li>
<li><input disabled="" type="checkbox"> 建立灾难恢复计划</li>
<li><input disabled="" type="checkbox"> 文档化恢复程序</li>
</ul>
<h3 id="10-2-持续安全改进"><a href="#10-2-持续安全改进" class="headerlink" title="10.2 持续安全改进"></a>10.2 持续安全改进</h3><ol>
<li><strong>定期安全评估</strong>：每季度进行一次全面的安全评估</li>
<li><strong>漏洞扫描</strong>：定期使用自动化工具进行漏洞扫描</li>
<li><strong>安全培训</strong>：定期对管理员进行安全培训</li>
<li><strong>事件响应</strong>：建立完善的安全事件响应流程</li>
<li><strong>合规检查</strong>：定期进行合规性检查和审计</li>
</ol>
<h3 id="10-3-最佳实践建议"><a href="#10-3-最佳实践建议" class="headerlink" title="10.3 最佳实践建议"></a>10.3 最佳实践建议</h3><ol>
<li><strong>分层防御</strong>：不要依赖单一的安全措施，建立多层防护体系</li>
<li><strong>最小权限</strong>：严格遵循最小权限原则，只给予必要的权限</li>
<li><strong>定期更新</strong>：及时安装安全补丁和更新</li>
<li><strong>监控告警</strong>：建立实时监控和告警机制</li>
<li><strong>文档管理</strong>：详细记录所有安全配置和变更</li>
<li><strong>测试验证</strong>：在生产环境应用前充分测试</li>
<li><strong>备份恢复</strong>：建立可靠的备份和恢复机制</li>
<li><strong>安全意识</strong>：提高所有相关人员的安全意识</li>
</ol>
<h3 id="10-4-常见安全误区"><a href="#10-4-常见安全误区" class="headerlink" title="10.4 常见安全误区"></a>10.4 常见安全误区</h3><ol>
<li><strong>过度依赖防火墙</strong>：防火墙只是安全防护的一部分</li>
<li><strong>忽视内部威胁</strong>：内部威胁往往比外部威胁更危险</li>
<li><strong>配置后不维护</strong>：安全配置需要持续维护和更新</li>
<li><strong>缺乏监控</strong>：没有监控就无法及时发现安全问题</li>
<li><strong>备份不测试</strong>：不测试的备份可能在关键时刻无法使用</li>
</ol>
<p>通过系统性的安全加固措施，可以大大提升Linux服务器的安全性。记住，安全是一个持续的过程，需要不断地评估、改进和维护。建议根据实际环境和业务需求，制定适合的安全策略，并严格执行。</p>
<hr>
<p><em>本文提供了一套完整的Linux服务器安全加固方案，涵盖了从基础配置到高级防护的各个方面。建议运维人员根据实际情况选择合适的安全措施，并建立持续的安全改进机制。安全无小事，预防胜于治疗。</em></p>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/">安全加固</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/">服务器安全</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE/">防火墙配置</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90/">用户权限</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E5%AE%89%E5%85%A8%E5%AE%A1%E8%AE%A1/">安全审计</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2024/mysql/mysql-cluster-configuration/"
                                   title="MySQL集群配置与高可用架构实战"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">MySQL集群配置与高可用架构实战</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2024/thinkphp/thinkphp6-validator-batch-bug-fix/"
                                   title="ThinkPHP6/8 验证器批量验证BUG修复：数组错误信息处理方案"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">ThinkPHP6/8 验证器批量验证BUG修复：数组错误信息处理方案</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97%EF%BC%9A%E4%BB%8E%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E5%88%B0%E9%AB%98%E7%BA%A7%E9%98%B2%E6%8A%A4%E7%9A%84%E5%AE%8C%E6%95%B4%E6%96%B9%E6%A1%88"><span class="nav-text">Linux服务器安全加固实战指南：从基础配置到高级防护的完整方案</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA"><span class="nav-text">一、安全加固基础理论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%88%99"><span class="nav-text">1.1 安全加固的基本原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%E5%88%86%E6%9E%90"><span class="nav-text">1.2 安全威胁分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-text">1.3 安全加固检查清单</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">二、系统基础安全配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E7%B3%BB%E7%BB%9F%E6%9B%B4%E6%96%B0%E5%92%8C%E8%A1%A5%E4%B8%81%E7%AE%A1%E7%90%86"><span class="nav-text">2.1 系统更新和补丁管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">2.2 内核参数安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">2.3 文件系统安全配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-text">三、用户账户和权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">3.1 用户账户安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-SSH%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">3.2 SSH安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-sudo%E6%9D%83%E9%99%90%E7%B2%BE%E7%BB%86%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="nav-text">3.3 sudo权限精细化配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8C%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8"><span class="nav-text">四、防火墙和网络安全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Firewalld%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE"><span class="nav-text">4.1 Firewalld防火墙配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-iptables%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE"><span class="nav-text">4.2 iptables防火墙配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E7%BD%91%E7%BB%9C%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B"><span class="nav-text">4.3 网络入侵检测</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">五、服务安全配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-Web%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">5.1 Web服务器安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">5.2 数据库安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">5.3 邮件服务安全配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%E5%92%8C%E5%AE%A1%E8%AE%A1"><span class="nav-text">六、日志监控和审计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="nav-text">6.1 系统日志配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E5%AE%A1%E8%AE%A1%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE"><span class="nav-text">6.2 审计系统配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-%E5%AE%89%E5%85%A8%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC"><span class="nav-text">6.3 安全监控脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E9%AB%98%E7%BA%A7%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4"><span class="nav-text">七、高级安全防护</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F%EF%BC%88IDS%EF%BC%89"><span class="nav-text">7.1 入侵检测系统（IDS）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E6%A3%80%E6%B5%8B"><span class="nav-text">7.2 恶意软件检测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7"><span class="nav-text">7.3 网络流量监控</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="nav-text">八、备份和恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5"><span class="nav-text">8.1 系统备份策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-%E7%81%BE%E9%9A%BE%E6%81%A2%E5%A4%8D%E8%AE%A1%E5%88%92"><span class="nav-text">8.2 灾难恢复计划</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E5%AE%89%E5%85%A8%E5%90%88%E8%A7%84%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">九、安全合规和最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-%E5%AE%89%E5%85%A8%E5%9F%BA%E7%BA%BF%E6%A3%80%E6%9F%A5"><span class="nav-text">9.1 安全基线检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-%E5%90%88%E8%A7%84%E6%80%A7%E6%A3%80%E6%9F%A5"><span class="nav-text">9.2 合规性检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC"><span class="nav-text">9.3 安全加固自动化脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E6%80%BB%E7%BB%93%E5%92%8C%E5%BB%BA%E8%AE%AE"><span class="nav-text">十、总结和建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-text">10.1 安全加固检查清单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-%E6%8C%81%E7%BB%AD%E5%AE%89%E5%85%A8%E6%94%B9%E8%BF%9B"><span class="nav-text">10.2 持续安全改进</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE"><span class="nav-text">10.3 最佳实践建议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-4-%E5%B8%B8%E8%A7%81%E5%AE%89%E5%85%A8%E8%AF%AF%E5%8C%BA"><span class="nav-text">10.4 常见安全误区</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;2025
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Orion K</a>
        
    </div>


    
        
        <div class="deploy-info info-item">
            
            本站由 <span class="tooltip" data-tooltip-content="GitHub Pages"><img src="/images/brands/github.png"></span> 提供部署服务
            
        </div>
    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97%EF%BC%9A%E4%BB%8E%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E5%88%B0%E9%AB%98%E7%BA%A7%E9%98%B2%E6%8A%A4%E7%9A%84%E5%AE%8C%E6%95%B4%E6%96%B9%E6%A1%88"><span class="nav-text">Linux服务器安全加固实战指南：从基础配置到高级防护的完整方案</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA"><span class="nav-text">一、安全加固基础理论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%88%99"><span class="nav-text">1.1 安全加固的基本原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81%E5%88%86%E6%9E%90"><span class="nav-text">1.2 安全威胁分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-text">1.3 安全加固检查清单</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">二、系统基础安全配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E7%B3%BB%E7%BB%9F%E6%9B%B4%E6%96%B0%E5%92%8C%E8%A1%A5%E4%B8%81%E7%AE%A1%E7%90%86"><span class="nav-text">2.1 系统更新和补丁管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">2.2 内核参数安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">2.3 文件系统安全配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E5%92%8C%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-text">三、用户账户和权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">3.1 用户账户安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-SSH%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">3.2 SSH安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-sudo%E6%9D%83%E9%99%90%E7%B2%BE%E7%BB%86%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="nav-text">3.3 sudo权限精细化配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8C%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8"><span class="nav-text">四、防火墙和网络安全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Firewalld%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE"><span class="nav-text">4.1 Firewalld防火墙配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-iptables%E9%98%B2%E7%81%AB%E5%A2%99%E9%85%8D%E7%BD%AE"><span class="nav-text">4.2 iptables防火墙配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E7%BD%91%E7%BB%9C%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B"><span class="nav-text">4.3 网络入侵检测</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">五、服务安全配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-Web%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">5.1 Web服务器安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">5.2 数据库安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">5.3 邮件服务安全配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E6%97%A5%E5%BF%97%E7%9B%91%E6%8E%A7%E5%92%8C%E5%AE%A1%E8%AE%A1"><span class="nav-text">六、日志监控和审计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="nav-text">6.1 系统日志配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E5%AE%A1%E8%AE%A1%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE"><span class="nav-text">6.2 审计系统配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-%E5%AE%89%E5%85%A8%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC"><span class="nav-text">6.3 安全监控脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E9%AB%98%E7%BA%A7%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4"><span class="nav-text">七、高级安全防护</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E7%B3%BB%E7%BB%9F%EF%BC%88IDS%EF%BC%89"><span class="nav-text">7.1 入侵检测系统（IDS）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E6%A3%80%E6%B5%8B"><span class="nav-text">7.2 恶意软件检测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7"><span class="nav-text">7.3 网络流量监控</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="nav-text">八、备份和恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5"><span class="nav-text">8.1 系统备份策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-%E7%81%BE%E9%9A%BE%E6%81%A2%E5%A4%8D%E8%AE%A1%E5%88%92"><span class="nav-text">8.2 灾难恢复计划</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E5%AE%89%E5%85%A8%E5%90%88%E8%A7%84%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">九、安全合规和最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-%E5%AE%89%E5%85%A8%E5%9F%BA%E7%BA%BF%E6%A3%80%E6%9F%A5"><span class="nav-text">9.1 安全基线检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-%E5%90%88%E8%A7%84%E6%80%A7%E6%A3%80%E6%9F%A5"><span class="nav-text">9.2 合规性检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC"><span class="nav-text">9.3 安全加固自动化脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E6%80%BB%E7%BB%93%E5%92%8C%E5%BB%BA%E8%AE%AE"><span class="nav-text">十、总结和建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-text">10.1 安全加固检查清单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-%E6%8C%81%E7%BB%AD%E5%AE%89%E5%85%A8%E6%94%B9%E8%BF%9B"><span class="nav-text">10.2 持续安全改进</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E5%BB%BA%E8%AE%AE"><span class="nav-text">10.3 最佳实践建议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-4-%E5%B8%B8%E8%A7%81%E5%AE%89%E5%85%A8%E8%AF%AF%E5%8C%BA"><span class="nav-text">10.4 常见安全误区</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
