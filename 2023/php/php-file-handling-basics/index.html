<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Orion K">
    
    <title>
        
            PHP文件操作入门：读写文件的实用技巧 |
        
        Orion K Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"Orion K Blog","author":"Orion K","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/                        || fa-solid fa-home","archives":"/archives            || fa-solid fa-box-archive","tags":"/tags                    || fa-solid fa-tags","categories":"/categories        || fa-solid fa-layer-group"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":"欢迎来到 Orion K 的博客，这是一个分享互联网技术的博客。联系：wxmm686800@gmail.com","category":true,"tag":true,"post_datetime":"created"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":null,"reaction":false,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2025,"word_count":false,"site_deploy":{"enable":true,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Orion K Blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                首页
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                归档
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                标签
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                
                                分类
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            首页
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            归档
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            标签
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                </span>
                            
                            分类
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        PHP文件操作入门：读写文件的实用技巧
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Orion K</span>
                                
                                    <span class="author-badge">Lv6</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2023-05-25 16:10:00</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/php/">php</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/PHP%E5%9F%BA%E7%A1%80/">PHP基础</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">文件操作</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/">文件读写</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C/">目录操作</a></li>
                        
                    
                </ul>
            </span>
        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h1 id="PHP文件操作入门：读写文件的实用技巧"><a href="#PHP文件操作入门：读写文件的实用技巧" class="headerlink" title="PHP文件操作入门：读写文件的实用技巧"></a>PHP文件操作入门：读写文件的实用技巧</h1><p>文件操作是Web开发中的常见需求，无论是日志记录、配置文件读取，还是文件上传下载，都离不开文件操作。作为一名PHP开发者，我想分享一些关于PHP文件操作的实用知识和经验。</p>
<h2 id="文件基本操作"><a href="#文件基本操作" class="headerlink" title="文件基本操作"></a>文件基本操作</h2><h3 id="1-检查文件和目录"><a href="#1-检查文件和目录" class="headerlink" title="1. 检查文件和目录"></a>1. 检查文件和目录</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;test.txt&quot;</span>;</span><br><span class="line"><span class="variable">$dirname</span> = <span class="string">&quot;uploads&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查文件是否存在</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件 <span class="subst">$filename</span> 存在\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件 <span class="subst">$filename</span> 不存在\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查是否为文件</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$filename</span> 是一个文件\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查是否为目录</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dirname</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$dirname</span> 是一个目录\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$dirname</span> 不是目录\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查文件权限</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_readable</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$filename</span> 可读\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_writable</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$filename</span> 可写\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_executable</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$filename</span> 可执行\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取文件信息</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="variable">$filesize</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="variable">$filetime</span> = <span class="title function_ invoke__">filemtime</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="variable">$filetype</span> = <span class="title function_ invoke__">filetype</span>(<span class="variable">$filename</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件大小：<span class="subst">$filesize</span> 字节\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;修改时间：&quot;</span> . <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>, <span class="variable">$filetime</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件类型：<span class="subst">$filetype</span>\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-文件路径操作"><a href="#2-文件路径操作" class="headerlink" title="2. 文件路径操作"></a>2. 文件路径操作</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filepath</span> = <span class="string">&quot;/var/www/html/uploads/image.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取路径信息</span></span><br><span class="line"><span class="variable">$pathinfo</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filepath</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$pathinfo</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 分别获取各部分</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;目录：&quot;</span> . <span class="title function_ invoke__">dirname</span>(<span class="variable">$filepath</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;文件名：&quot;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$filepath</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;扩展名：&quot;</span> . <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filepath</span>, PATHINFO_EXTENSION) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;不含扩展名的文件名：&quot;</span> . <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filepath</span>, PATHINFO_FILENAME) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建路径</span></span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&quot;/var/www/html&quot;</span>;</span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"><span class="variable">$fullpath</span> = <span class="variable">$dir</span> . DIRECTORY_SEPARATOR . <span class="variable">$filename</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;完整路径：<span class="subst">$fullpath</span>\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取绝对路径</span></span><br><span class="line"><span class="variable">$relativePath</span> = <span class="string">&quot;../config/database.php&quot;</span>;</span><br><span class="line"><span class="variable">$absolutePath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$relativePath</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$absolutePath</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;绝对路径：<span class="subst">$absolutePath</span>\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;路径不存在\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 规范化路径</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">normalizePath</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$path</span> = <span class="title function_ invoke__">str_replace</span>([<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>], DIRECTORY_SEPARATOR, <span class="variable">$path</span>);</span><br><span class="line">    <span class="variable">$parts</span> = <span class="title function_ invoke__">array_filter</span>(<span class="title function_ invoke__">explode</span>(DIRECTORY_SEPARATOR, <span class="variable">$path</span>), <span class="string">&#x27;strlen&#x27;</span>);</span><br><span class="line">    <span class="variable">$absolutes</span> = [];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$parts</span> <span class="keyword">as</span> <span class="variable">$part</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&#x27;.&#x27;</span> == <span class="variable">$part</span>) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&#x27;..&#x27;</span> == <span class="variable">$part</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">array_pop</span>(<span class="variable">$absolutes</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$absolutes</span>[] = <span class="variable">$part</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">implode</span>(DIRECTORY_SEPARATOR, <span class="variable">$absolutes</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;规范化路径：&quot;</span> . <span class="title function_ invoke__">normalizePath</span>(<span class="string">&quot;/var/www/../html/./uploads&quot;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="文件读取操作"><a href="#文件读取操作" class="headerlink" title="文件读取操作"></a>文件读取操作</h2><h3 id="1-一次性读取文件"><a href="#1-一次性读取文件" class="headerlink" title="1. 一次性读取文件"></a>1. 一次性读取文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;sample.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建示例文件</span></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="string">&quot;第一行内容\n第二行内容\n第三行内容\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法1：file_get_contents（推荐用于小文件）</span></span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$content</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件内容：\n<span class="subst">$content</span>\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;读取文件失败\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：file（读取为数组，每行一个元素）</span></span><br><span class="line"><span class="variable">$lines</span> = <span class="title function_ invoke__">file</span>(<span class="variable">$filename</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$lines</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;按行读取：\n&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$lines</span> <span class="keyword">as</span> <span class="variable">$lineNumber</span> =&gt; <span class="variable">$line</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;第&quot;</span> . (<span class="variable">$lineNumber</span> + <span class="number">1</span>) . <span class="string">&quot;行：&quot;</span> . <span class="title function_ invoke__">trim</span>(<span class="variable">$line</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法3：file（去除换行符）</span></span><br><span class="line"><span class="variable">$lines</span> = <span class="title function_ invoke__">file</span>(<span class="variable">$filename</span>, FILE_IGNORE_NEW_LINES);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$lines</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取远程文件</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;https://httpbin.org/json&quot;</span>;</span><br><span class="line"><span class="variable">$context</span> = <span class="title function_ invoke__">stream_context_create</span>([</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;timeout&#x27;</span> =&gt; <span class="number">10</span>,</span><br><span class="line">        <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&#x27;PHP Script&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$remoteContent</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>, <span class="literal">false</span>, <span class="variable">$context</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$remoteContent</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;远程内容：\n<span class="subst">$remoteContent</span>\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-逐行读取大文件"><a href="#2-逐行读取大文件" class="headerlink" title="2. 逐行读取大文件"></a>2. 逐行读取大文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 创建大文件示例</span></span><br><span class="line"><span class="variable">$largeFile</span> = <span class="string">&quot;large_file.txt&quot;</span>;</span><br><span class="line"><span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$largeFile</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt;= <span class="number">10000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$handle</span>, <span class="string">&quot;这是第 <span class="subst">$i</span> 行内容\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 逐行读取大文件（内存友好）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readLargeFile</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$handle</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;无法打开文件\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$lineNumber</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> ((<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$handle</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="comment">// 处理每一行</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$lineNumber</span> &lt;= <span class="number">5</span> || <span class="variable">$lineNumber</span> &gt; <span class="number">9995</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;行 <span class="subst">$lineNumber</span>: &quot;</span> . <span class="title function_ invoke__">trim</span>(<span class="variable">$line</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable">$lineNumber</span> == <span class="number">6</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;... (省略中间行) ...\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$lineNumber</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;总共读取了 &quot;</span> . (<span class="variable">$lineNumber</span> - <span class="number">1</span>) . <span class="string">&quot; 行\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">readLargeFile</span>(<span class="variable">$largeFile</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用SplFileObject读取文件（面向对象方式）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readWithSplFileObject</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">setFlags</span>(<span class="title class_">SplFileObject</span>::<span class="variable constant_">READ_AHEAD</span> | <span class="title class_">SplFileObject</span>::<span class="variable constant_">SKIP_EMPTY</span> | <span class="title class_">SplFileObject</span>::<span class="variable constant_">DROP_NEW_LINE</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$lineNumber</span> = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$file</span> <span class="keyword">as</span> <span class="variable">$line</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$lineNumber</span> &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;SplFileObject 行 <span class="subst">$lineNumber</span>: <span class="subst">$line</span>\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$lineNumber</span>++;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$lineNumber</span> &gt; <span class="number">3</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;读取文件出错：&quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">readWithSplFileObject</span>(<span class="variable">$largeFile</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清理示例文件</span></span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="variable">$largeFile</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-二进制文件读取"><a href="#3-二进制文件读取" class="headerlink" title="3. 二进制文件读取"></a>3. 二进制文件读取</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 创建二进制文件示例</span></span><br><span class="line"><span class="variable">$binaryFile</span> = <span class="string">&quot;binary_data.bin&quot;</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">pack</span>(<span class="string">&quot;N*&quot;</span>, <span class="number">1234567890</span>, <span class="number">987654321</span>, <span class="number">555666777</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$binaryFile</span>, <span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取二进制文件</span></span><br><span class="line"><span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$binaryFile</span>, <span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$handle</span>) &#123;</span><br><span class="line">    <span class="comment">// 读取固定字节数</span></span><br><span class="line">    <span class="variable">$chunk</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$handle</span>, <span class="number">4</span>);  <span class="comment">// 读取4字节</span></span><br><span class="line">    <span class="variable">$number</span> = <span class="title function_ invoke__">unpack</span>(<span class="string">&quot;N&quot;</span>, <span class="variable">$chunk</span>)[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;读取的数字：<span class="subst">$number</span>\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 读取剩余内容</span></span><br><span class="line">    <span class="variable">$remaining</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$handle</span>, <span class="title function_ invoke__">filesize</span>(<span class="variable">$binaryFile</span>) - <span class="number">4</span>);</span><br><span class="line">    <span class="variable">$numbers</span> = <span class="title function_ invoke__">unpack</span>(<span class="string">&quot;N*&quot;</span>, <span class="variable">$remaining</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;剩余数字：&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$numbers</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文件的十六进制表示</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hexDump</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$length</span> = <span class="number">16</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$handle</span>) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$offset</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ((<span class="variable">$data</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$handle</span>, <span class="variable">$length</span>)) !== <span class="literal">false</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$hex</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="variable">$hex</span> = <span class="title function_ invoke__">chunk_split</span>(<span class="variable">$hex</span>, <span class="number">2</span>, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        <span class="variable">$ascii</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\x20-\x7E]/&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="title function_ invoke__">printf</span>(<span class="string">&quot;%08X: %-48s %s\n&quot;</span>, <span class="variable">$offset</span>, <span class="variable">$hex</span>, <span class="variable">$ascii</span>);</span><br><span class="line">        <span class="variable">$offset</span> += <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;二进制文件十六进制表示：\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">hexDump</span>(<span class="variable">$binaryFile</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="variable">$binaryFile</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="文件写入操作"><a href="#文件写入操作" class="headerlink" title="文件写入操作"></a>文件写入操作</h2><h3 id="1-简单文件写入"><a href="#1-简单文件写入" class="headerlink" title="1. 简单文件写入"></a>1. 简单文件写入</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;output.txt&quot;</span>;</span><br><span class="line"><span class="variable">$content</span> = <span class="string">&quot;这是要写入的内容\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法1：file_put_contents（推荐）</span></span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;写入成功，写入了 <span class="subst">$result</span> 字节\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;写入失败\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 追加内容</span></span><br><span class="line"><span class="variable">$additionalContent</span> = <span class="string">&quot;这是追加的内容\n&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$additionalContent</span>, FILE_APPEND);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;追加成功，追加了 <span class="subst">$result</span> 字节\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加锁写入（防止并发问题）</span></span><br><span class="line"><span class="variable">$lockedContent</span> = <span class="string">&quot;这是加锁写入的内容\n&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$lockedContent</span>, FILE_APPEND | LOCK_EX);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;加锁写入成功\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取并显示文件内容</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;文件内容：\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-使用文件句柄写入"><a href="#2-使用文件句柄写入" class="headerlink" title="2. 使用文件句柄写入"></a>2. 使用文件句柄写入</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;detailed_output.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开文件进行写入</span></span><br><span class="line"><span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$handle</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;无法打开文件进行写入\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入不同类型的数据</span></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$handle</span>, <span class="string">&quot;标题：文件操作示例\n&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$handle</span>, <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;=&quot;</span>, <span class="number">30</span>) . <span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = [</span><br><span class="line">    <span class="string">&quot;姓名&quot;</span> =&gt; <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    <span class="string">&quot;年龄&quot;</span> =&gt; <span class="number">25</span>,</span><br><span class="line">    <span class="string">&quot;城市&quot;</span> =&gt; <span class="string">&quot;北京&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$handle</span>, <span class="string">&quot;<span class="subst">$key</span>: <span class="subst">$value</span>\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入当前时间</span></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$handle</span>, <span class="string">&quot;创建时间：&quot;</span> . <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>) . <span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭文件</span></span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;文件写入完成\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用不同模式打开文件</span></span><br><span class="line"><span class="variable">$modes</span> = [</span><br><span class="line">    <span class="string">&#x27;r&#x27;</span> =&gt; <span class="string">&#x27;只读模式&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;w&#x27;</span> =&gt; <span class="string">&#x27;写入模式（清空文件）&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span> =&gt; <span class="string">&#x27;追加模式&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;r+&#x27;</span> =&gt; <span class="string">&#x27;读写模式&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;w+&#x27;</span> =&gt; <span class="string">&#x27;读写模式（清空文件）&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a+&#x27;</span> =&gt; <span class="string">&#x27;读写追加模式&#x27;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n文件打开模式说明：\n&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$modes</span> <span class="keyword">as</span> <span class="variable">$mode</span> =&gt; <span class="variable">$description</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$mode</span>: <span class="subst">$description</span>\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-CSV文件操作"><a href="#3-CSV文件操作" class="headerlink" title="3. CSV文件操作"></a>3. CSV文件操作</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$csvFile</span> = <span class="string">&quot;users.csv&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入CSV文件</span></span><br><span class="line"><span class="variable">$users</span> = [</span><br><span class="line">    [<span class="string">&#x27;姓名&#x27;</span>, <span class="string">&#x27;年龄&#x27;</span>, <span class="string">&#x27;城市&#x27;</span>, <span class="string">&#x27;邮箱&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;张三&#x27;</span>, <span class="number">25</span>, <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;zhangsan@example.com&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;李四&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;lisi@example.com&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;王五&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;wangwu@example.com&#x27;</span>]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$csvFile</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$handle</span>) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">fputcsv</span>(<span class="variable">$handle</span>, <span class="variable">$user</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;CSV文件写入完成\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取CSV文件</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n读取CSV文件：\n&quot;</span>;</span><br><span class="line"><span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$csvFile</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$handle</span>) &#123;</span><br><span class="line">    <span class="variable">$isHeader</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span> ((<span class="variable">$data</span> = <span class="title function_ invoke__">fgetcsv</span>(<span class="variable">$handle</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$isHeader</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;表头：&quot;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27; | &#x27;</span>, <span class="variable">$data</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">str_repeat</span>(<span class="string">&#x27;-&#x27;</span>, <span class="number">50</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            <span class="variable">$isHeader</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">implode</span>(<span class="string">&#x27; | &#x27;</span>, <span class="variable">$data</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用SplFileObject处理CSV</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n使用SplFileObject读取CSV：\n&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="variable">$csvFile</span>);</span><br><span class="line">    <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">setFlags</span>(<span class="title class_">SplFileObject</span>::<span class="variable constant_">READ_CSV</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$file</span> <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="number">0</span>] !== <span class="literal">null</span>) &#123;  <span class="comment">// 跳过空行</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;用户：&quot;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;, &#x27;</span>, <span class="variable">$row</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;读取CSV出错：&quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h2><h3 id="1-创建和删除目录"><a href="#1-创建和删除目录" class="headerlink" title="1. 创建和删除目录"></a>1. 创建和删除目录</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dirName</span> = <span class="string">&quot;test_directory&quot;</span>;</span><br><span class="line"><span class="variable">$subDir</span> = <span class="variable">$dirName</span> . <span class="string">&quot;/subdirectory&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建目录</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dirName</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">mkdir</span>(<span class="variable">$dirName</span>, <span class="number">0755</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;目录 <span class="subst">$dirName</span> 创建成功\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;目录 <span class="subst">$dirName</span> 创建失败\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归创建目录</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$subDir</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">mkdir</span>(<span class="variable">$subDir</span>, <span class="number">0755</span>, <span class="literal">true</span>)) &#123;  <span class="comment">// true表示递归创建</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;子目录 <span class="subst">$subDir</span> 创建成功\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在目录中创建文件</span></span><br><span class="line"><span class="variable">$testFile</span> = <span class="variable">$subDir</span> . <span class="string">&quot;/test.txt&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$testFile</span>, <span class="string">&quot;测试文件内容&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除文件</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$testFile</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">unlink</span>(<span class="variable">$testFile</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;文件 <span class="subst">$testFile</span> 删除成功\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除目录（必须为空）</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_dir</span>(<span class="variable">$subDir</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">rmdir</span>(<span class="variable">$subDir</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;子目录 <span class="subst">$subDir</span> 删除成功\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dirName</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">rmdir</span>(<span class="variable">$dirName</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;目录 <span class="subst">$dirName</span> 删除成功\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归删除目录的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeDirectory</span>(<span class="params"><span class="variable">$dir</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$dir</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">array_diff</span>(<span class="title function_ invoke__">scandir</span>(<span class="variable">$dir</span>), [<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;..&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$dir</span> . DIRECTORY_SEPARATOR . <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_dir</span>(<span class="variable">$path</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">removeDirectory</span>(<span class="variable">$path</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$path</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">rmdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例使用</span></span><br><span class="line"><span class="variable">$testDir</span> = <span class="string">&quot;recursive_test&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="variable">$testDir</span>);</span><br><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="variable">$testDir</span> . <span class="string">&quot;/sub1&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="variable">$testDir</span> . <span class="string">&quot;/sub2&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$testDir</span> . <span class="string">&quot;/file1.txt&quot;</span>, <span class="string">&quot;内容1&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$testDir</span> . <span class="string">&quot;/sub1/file2.txt&quot;</span>, <span class="string">&quot;内容2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;递归删除目录：&quot;</span> . (<span class="title function_ invoke__">removeDirectory</span>(<span class="variable">$testDir</span>) ? <span class="string">&quot;成功&quot;</span> : <span class="string">&quot;失败&quot;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-遍历目录"><a href="#2-遍历目录" class="headerlink" title="2. 遍历目录"></a>2. 遍历目录</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 创建测试目录结构</span></span><br><span class="line"><span class="variable">$baseDir</span> = <span class="string">&quot;directory_test&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="variable">$baseDir</span>);</span><br><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="variable">$baseDir</span> . <span class="string">&quot;/images&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="variable">$baseDir</span> . <span class="string">&quot;/documents&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">mkdir</span>(<span class="variable">$baseDir</span> . <span class="string">&quot;/images/thumbnails&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建测试文件</span></span><br><span class="line"><span class="variable">$testFiles</span> = [</span><br><span class="line">    <span class="variable">$baseDir</span> . <span class="string">&quot;/readme.txt&quot;</span> =&gt; <span class="string">&quot;说明文件&quot;</span>,</span><br><span class="line">    <span class="variable">$baseDir</span> . <span class="string">&quot;/config.php&quot;</span> =&gt; <span class="string">&quot;&lt;?php // 配置文件&quot;</span>,</span><br><span class="line">    <span class="variable">$baseDir</span> . <span class="string">&quot;/images/photo1.jpg&quot;</span> =&gt; <span class="string">&quot;假装是图片内容&quot;</span>,</span><br><span class="line">    <span class="variable">$baseDir</span> . <span class="string">&quot;/images/photo2.png&quot;</span> =&gt; <span class="string">&quot;假装是图片内容&quot;</span>,</span><br><span class="line">    <span class="variable">$baseDir</span> . <span class="string">&quot;/images/thumbnails/thumb1.jpg&quot;</span> =&gt; <span class="string">&quot;缩略图&quot;</span>,</span><br><span class="line">    <span class="variable">$baseDir</span> . <span class="string">&quot;/documents/report.pdf&quot;</span> =&gt; <span class="string">&quot;报告文件&quot;</span>,</span><br><span class="line">    <span class="variable">$baseDir</span> . <span class="string">&quot;/documents/manual.doc&quot;</span> =&gt; <span class="string">&quot;手册文件&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$testFiles</span> <span class="keyword">as</span> <span class="variable">$file</span> =&gt; <span class="variable">$content</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$content</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法1：使用scandir</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;使用scandir遍历目录：\n&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listDirectory</span>(<span class="params"><span class="variable">$dir</span>, <span class="variable">$level</span> = <span class="number">0</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$indent</span> = <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;  &quot;</span>, <span class="variable">$level</span>);</span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$dir</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$file</span> === <span class="string">&#x27;.&#x27;</span> || <span class="variable">$file</span> === <span class="string">&#x27;..&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$dir</span> . DIRECTORY_SEPARATOR . <span class="variable">$file</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_dir</span>(<span class="variable">$path</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$indent</span> . <span class="string">&quot;[目录] <span class="subst">$file</span>/\n&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">listDirectory</span>(<span class="variable">$path</span>, <span class="variable">$level</span> + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$size</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$path</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$indent</span> . <span class="string">&quot;[文件] <span class="subst">$file</span> (<span class="subst">$size</span> 字节)\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">listDirectory</span>(<span class="variable">$baseDir</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法2：使用DirectoryIterator</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n使用DirectoryIterator遍历：\n&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listWithDirectoryIterator</span>(<span class="params"><span class="variable">$dir</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$iterator</span> = <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="variable">$dir</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$iterator</span> <span class="keyword">as</span> <span class="variable">$fileInfo</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">isDot</span>()) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$type</span> = <span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">isDir</span>() ? <span class="string">&quot;目录&quot;</span> : <span class="string">&quot;文件&quot;</span>;</span><br><span class="line">            <span class="variable">$size</span> = <span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">isFile</span>() ? <span class="string">&quot; (&quot;</span> . <span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">getSize</span>() . <span class="string">&quot; 字节)&quot;</span> : <span class="string">&quot;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$type</span>: &quot;</span> . <span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">getFilename</span>() . <span class="variable">$size</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;遍历出错：&quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">listWithDirectoryIterator</span>(<span class="variable">$baseDir</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法3：使用RecursiveDirectoryIterator（递归遍历）</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n递归遍历所有文件：\n&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">recursiveList</span>(<span class="params"><span class="variable">$dir</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$iterator</span> = <span class="keyword">new</span> <span class="built_in">RecursiveIteratorIterator</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="built_in">RecursiveDirectoryIterator</span>(<span class="variable">$dir</span>),</span><br><span class="line">            <span class="title class_">RecursiveIteratorIterator</span>::<span class="variable constant_">SELF_FIRST</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$iterator</span> <span class="keyword">as</span> <span class="variable">$fileInfo</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">isDot</span>()) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$level</span> = <span class="variable">$iterator</span>-&gt;<span class="title function_ invoke__">getDepth</span>();</span><br><span class="line">            <span class="variable">$indent</span> = <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;  &quot;</span>, <span class="variable">$level</span>);</span><br><span class="line">            <span class="variable">$type</span> = <span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">isDir</span>() ? <span class="string">&quot;目录&quot;</span> : <span class="string">&quot;文件&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$indent</span> . <span class="string">&quot;<span class="subst">$type</span>: &quot;</span> . <span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">getFilename</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;递归遍历出错：&quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">recursiveList</span>(<span class="variable">$baseDir</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找特定类型的文件</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n查找图片文件：\n&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findImageFiles</span>(<span class="params"><span class="variable">$dir</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$imageExtensions</span> = [<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;bmp&#x27;</span>];</span><br><span class="line">    <span class="variable">$iterator</span> = <span class="keyword">new</span> <span class="built_in">RecursiveIteratorIterator</span>(</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">RecursiveDirectoryIterator</span>(<span class="variable">$dir</span>)</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$iterator</span> <span class="keyword">as</span> <span class="variable">$fileInfo</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">isFile</span>()) &#123;</span><br><span class="line">            <span class="variable">$extension</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">getExtension</span>());</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>, <span class="variable">$imageExtensions</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;找到图片：&quot;</span> . <span class="variable">$fileInfo</span>-&gt;<span class="title function_ invoke__">getPathname</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">findImageFiles</span>(<span class="variable">$baseDir</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清理测试目录</span></span><br><span class="line"><span class="title function_ invoke__">removeDirectory</span>(<span class="variable">$baseDir</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="文件上传处理"><a href="#文件上传处理" class="headerlink" title="文件上传处理"></a>文件上传处理</h2><h3 id="1-基本文件上传"><a href="#1-基本文件上传" class="headerlink" title="1. 基本文件上传"></a>1. 基本文件上传</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 注意：这部分代码需要在Web环境中运行，并且需要HTML表单</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HTML表单示例（需要保存为单独的HTML文件）</span></span><br><span class="line"><span class="variable">$htmlForm</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;文件上传示例&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;form action=&quot;upload.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;label for=&quot;file&quot;&gt;选择文件：&lt;/label&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;file&quot; name=&quot;uploaded_file&quot; id=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;submit&quot; value=&quot;上传文件&quot; name=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件上传处理代码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleFileUpload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查是否有文件上传</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>]) || <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>][<span class="string">&#x27;error&#x27;</span>] !== UPLOAD_ERR_OK) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;文件上传失败\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded_file&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取文件信息</span></span><br><span class="line">    <span class="variable">$fileName</span> = <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$fileSize</span> = <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>];</span><br><span class="line">    <span class="variable">$fileTmpName</span> = <span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$fileType</span> = <span class="variable">$file</span>[<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    <span class="variable">$fileError</span> = <span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件信息：\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件名：<span class="subst">$fileName</span>\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件大小：<span class="subst">$fileSize</span> 字节\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件类型：<span class="subst">$fileType</span>\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证文件</span></span><br><span class="line">    <span class="variable">$maxSize</span> = <span class="number">5</span> * <span class="number">1024</span> * <span class="number">1024</span>;  <span class="comment">// 5MB</span></span><br><span class="line">    <span class="variable">$allowedTypes</span> = [<span class="string">&#x27;image/jpeg&#x27;</span>, <span class="string">&#x27;image/png&#x27;</span>, <span class="string">&#x27;image/gif&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$fileSize</span> &gt; <span class="variable">$maxSize</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;文件太大，最大允许 5MB\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$fileType</span>, <span class="variable">$allowedTypes</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;不允许的文件类型\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 生成安全的文件名</span></span><br><span class="line">    <span class="variable">$fileExtension</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$fileName</span>, PATHINFO_EXTENSION);</span><br><span class="line">    <span class="variable">$safeFileName</span> = <span class="title function_ invoke__">uniqid</span>() . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$fileExtension</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置上传目录</span></span><br><span class="line">    <span class="variable">$uploadDir</span> = <span class="string">&#x27;uploads/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$uploadDir</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$uploadDir</span>, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$uploadPath</span> = <span class="variable">$uploadDir</span> . <span class="variable">$safeFileName</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 移动上传的文件</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$fileTmpName</span>, <span class="variable">$uploadPath</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;文件上传成功：<span class="subst">$uploadPath</span>\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;文件移动失败\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件上传错误处理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUploadErrorMessage</span>(<span class="params"><span class="variable">$errorCode</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$errors</span> = [</span><br><span class="line">        UPLOAD_ERR_OK =&gt; <span class="string">&#x27;上传成功&#x27;</span>,</span><br><span class="line">        UPLOAD_ERR_INI_SIZE =&gt; <span class="string">&#x27;文件大小超过php.ini中upload_max_filesize的值&#x27;</span>,</span><br><span class="line">        UPLOAD_ERR_FORM_SIZE =&gt; <span class="string">&#x27;文件大小超过表单中MAX_FILE_SIZE的值&#x27;</span>,</span><br><span class="line">        UPLOAD_ERR_PARTIAL =&gt; <span class="string">&#x27;文件只有部分被上传&#x27;</span>,</span><br><span class="line">        UPLOAD_ERR_NO_FILE =&gt; <span class="string">&#x27;没有文件被上传&#x27;</span>,</span><br><span class="line">        UPLOAD_ERR_NO_TMP_DIR =&gt; <span class="string">&#x27;找不到临时文件夹&#x27;</span>,</span><br><span class="line">        UPLOAD_ERR_CANT_WRITE =&gt; <span class="string">&#x27;文件写入失败&#x27;</span>,</span><br><span class="line">        UPLOAD_ERR_EXTENSION =&gt; <span class="string">&#x27;文件上传被扩展程序阻止&#x27;</span></span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$errors</span>[<span class="variable">$errorCode</span>] ?? <span class="string">&#x27;未知错误&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多文件上传处理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleMultipleFileUpload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;multiple_files&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$files</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;multiple_files&#x27;</span>];</span><br><span class="line">    <span class="variable">$fileCount</span> = <span class="title function_ invoke__">count</span>(<span class="variable">$files</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$fileCount</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$files</span>[<span class="string">&#x27;error&#x27;</span>][<span class="variable">$i</span>] === UPLOAD_ERR_OK) &#123;</span><br><span class="line">            <span class="variable">$fileName</span> = <span class="variable">$files</span>[<span class="string">&#x27;name&#x27;</span>][<span class="variable">$i</span>];</span><br><span class="line">            <span class="variable">$fileTmpName</span> = <span class="variable">$files</span>[<span class="string">&#x27;tmp_name&#x27;</span>][<span class="variable">$i</span>];</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 处理每个文件...</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;处理文件：<span class="subst">$fileName</span>\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="日志文件操作"><a href="#日志文件操作" class="headerlink" title="日志文件操作"></a>日志文件操作</h2><h3 id="1-简单日志记录"><a href="#1-简单日志记录" class="headerlink" title="1. 简单日志记录"></a>1. 简单日志记录</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleLogger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logFile</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$dateFormat</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$logFile</span> = <span class="string">&#x27;app.log&#x27;</span>, <span class="variable">$dateFormat</span> = <span class="string">&#x27;Y-m-d H:i:s&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;logFile = <span class="variable">$logFile</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dateFormat = <span class="variable">$dateFormat</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"><span class="variable">$level</span>, <span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$timestamp</span> = <span class="title function_ invoke__">date</span>(<span class="variable">$this</span>-&gt;dateFormat);</span><br><span class="line">        <span class="variable">$logEntry</span> = <span class="string">&quot;[<span class="subst">$timestamp</span>] [<span class="subst">$level</span>] <span class="subst">$message</span>&quot;</span> . PHP_EOL;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用文件锁防止并发写入问题</span></span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;logFile, <span class="variable">$logEntry</span>, FILE_APPEND | LOCK_EX);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">info</span>(<span class="params"><span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&#x27;INFO&#x27;</span>, <span class="variable">$message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">warning</span>(<span class="params"><span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&#x27;WARNING&#x27;</span>, <span class="variable">$message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params"><span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&#x27;ERROR&#x27;</span>, <span class="variable">$message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">debug</span>(<span class="params"><span class="variable">$message</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">log</span>(<span class="string">&#x27;DEBUG&#x27;</span>, <span class="variable">$message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readLogs</span>(<span class="params"><span class="variable">$lines</span> = <span class="number">50</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;logFile)) &#123;</span><br><span class="line">            <span class="keyword">return</span> [];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$file</span> = <span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="variable language_">$this</span>-&gt;logFile);</span><br><span class="line">        <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">seek</span>(PHP_INT_MAX);</span><br><span class="line">        <span class="variable">$totalLines</span> = <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">key</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$startLine</span> = <span class="title function_ invoke__">max</span>(<span class="number">0</span>, <span class="variable">$totalLines</span> - <span class="variable">$lines</span>);</span><br><span class="line">        <span class="variable">$logs</span> = [];</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">seek</span>(<span class="variable">$startLine</span>);</span><br><span class="line">        <span class="keyword">while</span> (!<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">eof</span>()) &#123;</span><br><span class="line">            <span class="variable">$line</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">current</span>());</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$line</span>)) &#123;</span><br><span class="line">                <span class="variable">$logs</span>[] = <span class="variable">$line</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">next</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$logs</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">clearLogs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;logFile)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;logFile, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rotateLogs</span>(<span class="params"><span class="variable">$maxSize</span> = <span class="number">10485760</span></span>) </span>&#123;  <span class="comment">// 10MB</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;logFile)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">filesize</span>(<span class="variable">$this</span>-&gt;logFile) &gt; <span class="variable">$maxSize</span>) &#123;</span><br><span class="line">            <span class="variable">$backupFile</span> = <span class="variable language_">$this</span>-&gt;logFile . <span class="string">&#x27;.&#x27;</span> . <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d-H-i-s&#x27;</span>);</span><br><span class="line">            <span class="title function_ invoke__">rename</span>(<span class="variable">$this</span>-&gt;logFile, <span class="variable">$backupFile</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 压缩旧日志文件（如果支持gzip）</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;gzencode&#x27;</span>)) &#123;</span><br><span class="line">                <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$backupFile</span>);</span><br><span class="line">                <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$backupFile</span> . <span class="string">&#x27;.gz&#x27;</span>, <span class="title function_ invoke__">gzencode</span>(<span class="variable">$content</span>));</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$backupFile</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="variable">$logger</span> = <span class="keyword">new</span> <span class="title class_">SimpleLogger</span>(<span class="string">&#x27;application.log&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$logger</span>-&gt;<span class="title function_ invoke__">info</span>(<span class="string">&#x27;应用程序启动&#x27;</span>);</span><br><span class="line"><span class="variable">$logger</span>-&gt;<span class="title function_ invoke__">debug</span>(<span class="string">&#x27;调试信息：用户ID = 123&#x27;</span>);</span><br><span class="line"><span class="variable">$logger</span>-&gt;<span class="title function_ invoke__">warning</span>(<span class="string">&#x27;警告：内存使用率较高&#x27;</span>);</span><br><span class="line"><span class="variable">$logger</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;错误：数据库连接失败&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取最近的日志</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;最近的日志记录：\n&quot;</span>;</span><br><span class="line"><span class="variable">$recentLogs</span> = <span class="variable">$logger</span>-&gt;<span class="title function_ invoke__">readLogs</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$recentLogs</span> <span class="keyword">as</span> <span class="variable">$log</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$log</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日志轮转</span></span><br><span class="line"><span class="variable">$logger</span>-&gt;<span class="title function_ invoke__">rotateLogs</span>(<span class="number">1024</span>);  <span class="comment">// 1KB用于测试</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置文件操作"><a href="#配置文件操作" class="headerlink" title="配置文件操作"></a>配置文件操作</h2><h3 id="1-INI配置文件"><a href="#1-INI配置文件" class="headerlink" title="1. INI配置文件"></a>1. INI配置文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 创建INI配置文件</span></span><br><span class="line"><span class="variable">$iniContent</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">; 数据库配置</span></span><br><span class="line"><span class="string">[database]</span></span><br><span class="line"><span class="string">host = localhost</span></span><br><span class="line"><span class="string">port = 3306</span></span><br><span class="line"><span class="string">username = root</span></span><br><span class="line"><span class="string">password = secret</span></span><br><span class="line"><span class="string">database = myapp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">; 应用配置</span></span><br><span class="line"><span class="string">[app]</span></span><br><span class="line"><span class="string">name = &quot;My Application&quot;</span></span><br><span class="line"><span class="string">version = &quot;1.0.0&quot;</span></span><br><span class="line"><span class="string">debug = true</span></span><br><span class="line"><span class="string">timezone = &quot;Asia/Shanghai&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">; 缓存配置</span></span><br><span class="line"><span class="string">[cache]</span></span><br><span class="line"><span class="string">driver = redis</span></span><br><span class="line"><span class="string">host = 127.0.0.1</span></span><br><span class="line"><span class="string">port = 6379</span></span><br><span class="line"><span class="string">ttl = 3600</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$configFile</span> = <span class="string">&#x27;config.ini&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$configFile</span>, <span class="variable">$iniContent</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取INI配置文件</span></span><br><span class="line"><span class="variable">$config</span> = <span class="title function_ invoke__">parse_ini_file</span>(<span class="variable">$configFile</span>, <span class="literal">true</span>);  <span class="comment">// true表示处理节</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$config</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问配置值</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;数据库主机：&quot;</span> . <span class="variable">$config</span>[<span class="string">&#x27;database&#x27;</span>][<span class="string">&#x27;host&#x27;</span>] . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;应用名称：&quot;</span> . <span class="variable">$config</span>[<span class="string">&#x27;app&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;调试模式：&quot;</span> . (<span class="variable">$config</span>[<span class="string">&#x27;app&#x27;</span>][<span class="string">&#x27;debug&#x27;</span>] ? <span class="string">&#x27;开启&#x27;</span> : <span class="string">&#x27;关闭&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置文件管理类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$configFile</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$config</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$configFile</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;configFile = <span class="variable">$configFile</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadConfig</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">loadConfig</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;configFile)) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;config = <span class="title function_ invoke__">parse_ini_file</span>(<span class="variable">$this</span>-&gt;configFile, <span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;config = [];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$section</span>, <span class="variable">$key</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$key</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;config[<span class="variable">$section</span>] ?? <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;config[<span class="variable">$section</span>][<span class="variable">$key</span>] ?? <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"><span class="variable">$section</span>, <span class="variable">$key</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;config[<span class="variable">$section</span>][<span class="variable">$key</span>] = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;config <span class="keyword">as</span> <span class="variable">$section</span> =&gt; <span class="variable">$values</span>) &#123;</span><br><span class="line">            <span class="variable">$content</span> .= <span class="string">&quot;[<span class="subst">$section</span>]\n&quot;</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$values</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">is_bool</span>(<span class="variable">$value</span>)) &#123;</span><br><span class="line">                    <span class="variable">$value</span> = <span class="variable">$value</span> ? <span class="string">&#x27;true&#x27;</span> : <span class="string">&#x27;false&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$value</span>) &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$value</span>, <span class="string">&#x27; &#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">                    <span class="variable">$value</span> = <span class="string">&#x27;&quot;&#x27;</span> . <span class="variable">$value</span> . <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$content</span> .= <span class="string">&quot;<span class="subst">$key</span> = <span class="subst">$value</span>\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$content</span> .= <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;configFile, <span class="variable">$content</span>) !== <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用配置管理器</span></span><br><span class="line"><span class="variable">$configManager</span> = <span class="keyword">new</span> <span class="title class_">ConfigManager</span>(<span class="variable">$configFile</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;应用版本：&quot;</span> . <span class="variable">$configManager</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;version&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$configManager</span>-&gt;<span class="title function_ invoke__">set</span>(<span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;version&#x27;</span>, <span class="string">&#x27;1.0.1&#x27;</span>);</span><br><span class="line"><span class="variable">$configManager</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="variable">$configFile</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-JSON配置文件"><a href="#2-JSON配置文件" class="headerlink" title="2. JSON配置文件"></a>2. JSON配置文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// JSON配置文件操作</span></span><br><span class="line"><span class="variable">$jsonConfig</span> = [</span><br><span class="line">    <span class="string">&#x27;database&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;port&#x27;</span> =&gt; <span class="number">3306</span>,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;secret&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;app&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;My App&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;debug&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&#x27;features&#x27;</span> =&gt; [<span class="string">&#x27;auth&#x27;</span>, <span class="string">&#x27;cache&#x27;</span>, <span class="string">&#x27;logging&#x27;</span>]</span><br><span class="line">    ]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$jsonFile</span> = <span class="string">&#x27;config.json&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入JSON配置</span></span><br><span class="line"><span class="variable">$jsonContent</span> = <span class="title function_ invoke__">json_encode</span>(<span class="variable">$jsonConfig</span>, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$jsonFile</span>, <span class="variable">$jsonContent</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取JSON配置</span></span><br><span class="line"><span class="variable">$loadedConfig</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$jsonFile</span>), <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">json_last_error</span>() === JSON_ERROR_NONE) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;JSON配置加载成功\n&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$loadedConfig</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;JSON解析错误：&quot;</span> . <span class="title function_ invoke__">json_last_error_msg</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="variable">$jsonFile</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="文件安全和最佳实践"><a href="#文件安全和最佳实践" class="headerlink" title="文件安全和最佳实践"></a>文件安全和最佳实践</h2><h3 id="1-文件权限和安全"><a href="#1-文件权限和安全" class="headerlink" title="1. 文件权限和安全"></a>1. 文件权限和安全</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 安全的文件操作函数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecureFileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$allowedExtensions</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$maxFileSize</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$uploadDir</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$uploadDir</span> = <span class="string">&#x27;uploads/&#x27;</span>, <span class="variable">$maxFileSize</span> = <span class="number">5242880</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;uploadDir = <span class="title function_ invoke__">rtrim</span>(<span class="variable">$uploadDir</span>, <span class="string">&#x27;/&#x27;</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;maxFileSize = <span class="variable">$maxFileSize</span>;  <span class="comment">// 5MB</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;allowedExtensions = [<span class="string">&#x27;txt&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;pdf&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 确保上传目录存在</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$this</span>-&gt;uploadDir)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">mkdir</span>(<span class="variable">$this</span>-&gt;uploadDir, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">validateFile</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$filesize</span> = <span class="literal">null</span>, <span class="variable">$content</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 检查文件名</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$filename</span>) || <span class="title function_ invoke__">strpos</span>(<span class="variable">$filename</span>, <span class="string">&#x27;..&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">InvalidArgumentException</span>(<span class="string">&#x27;无效的文件名&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查扩展名</span></span><br><span class="line">        <span class="variable">$extension</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>, PATHINFO_EXTENSION));</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>, <span class="variable">$this</span>-&gt;allowedExtensions)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">InvalidArgumentException</span>(<span class="string">&#x27;不允许的文件类型&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查文件大小</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$filesize</span> !== <span class="literal">null</span> &amp;&amp; <span class="variable">$filesize</span> &gt; <span class="variable language_">$this</span>-&gt;maxFileSize) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">InvalidArgumentException</span>(<span class="string">&#x27;文件太大&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查文件内容（简单的恶意代码检测）</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$content</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="variable">$dangerousPatterns</span> = [</span><br><span class="line">                <span class="string">&#x27;/&lt;\?php/i&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;/&lt;script/i&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;/eval\s*\(/i&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;/exec\s*\(/i&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;/system\s*\(/i&#x27;</span></span><br><span class="line">            ];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$dangerousPatterns</span> <span class="keyword">as</span> <span class="variable">$pattern</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">InvalidArgumentException</span>(<span class="string">&#x27;文件包含危险内容&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">secureWrite</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$content</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">validateFile</span>(<span class="variable">$filename</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>), <span class="variable">$content</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 生成安全的文件名</span></span><br><span class="line">            <span class="variable">$safeFilename</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">generateSafeFilename</span>(<span class="variable">$filename</span>);</span><br><span class="line">            <span class="variable">$fullPath</span> = <span class="variable language_">$this</span>-&gt;uploadDir . <span class="variable">$safeFilename</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 写入文件</span></span><br><span class="line">            <span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$fullPath</span>, <span class="variable">$content</span>, LOCK_EX);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="comment">// 设置适当的文件权限</span></span><br><span class="line">                <span class="title function_ invoke__">chmod</span>(<span class="variable">$fullPath</span>, <span class="number">0644</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$safeFilename</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;文件写入失败&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;安全写入失败：&#x27;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">secureRead</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$fullPath</span> = <span class="variable language_">$this</span>-&gt;uploadDir . <span class="variable">$filename</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查文件是否在允许的目录内</span></span><br><span class="line">        <span class="variable">$realPath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$fullPath</span>);</span><br><span class="line">        <span class="variable">$realUploadDir</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$this</span>-&gt;uploadDir);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$realPath</span> || <span class="title function_ invoke__">strpos</span>(<span class="variable">$realPath</span>, <span class="variable">$realUploadDir</span>) !== <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">InvalidArgumentException</span>(<span class="string">&#x27;不允许访问该文件&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$fullPath</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">InvalidArgumentException</span>(<span class="string">&#x27;文件不存在&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$fullPath</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">generateSafeFilename</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$extension</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>, PATHINFO_EXTENSION);</span><br><span class="line">        <span class="variable">$basename</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>, PATHINFO_FILENAME);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清理文件名</span></span><br><span class="line">        <span class="variable">$basename</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^a-zA-Z0-9_-]/&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$basename</span>);</span><br><span class="line">        <span class="variable">$basename</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$basename</span>, <span class="number">0</span>, <span class="number">50</span>);  <span class="comment">// 限制长度</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加时间戳避免冲突</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$basename</span> . <span class="string">&#x27;_&#x27;</span> . <span class="title function_ invoke__">time</span>() . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$extension</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$fileHandler</span> = <span class="keyword">new</span> <span class="title class_">SecureFileHandler</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$testContent</span> = <span class="string">&quot;这是安全的文件内容\n测试数据&quot;</span>;</span><br><span class="line">    <span class="variable">$savedFile</span> = <span class="variable">$fileHandler</span>-&gt;<span class="title function_ invoke__">secureWrite</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="variable">$testContent</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件安全保存为：<span class="subst">$savedFile</span>\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$readContent</span> = <span class="variable">$fileHandler</span>-&gt;<span class="title function_ invoke__">secureRead</span>(<span class="variable">$savedFile</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;读取的内容：\n<span class="subst">$readContent</span>\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清理测试文件</span></span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;uploads/&#x27;</span> . <span class="variable">$savedFile</span>);</span><br><span class="line">    <span class="title function_ invoke__">rmdir</span>(<span class="string">&#x27;uploads&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;错误：&quot;</span> . <span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-文件锁定和并发处理"><a href="#2-文件锁定和并发处理" class="headerlink" title="2. 文件锁定和并发处理"></a>2. 文件锁定和并发处理</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 文件锁定示例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileLocker</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$lockFile</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$handle</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lockFile = <span class="variable">$filename</span> . <span class="string">&#x27;.lock&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">lock</span>(<span class="params"><span class="variable">$timeout</span> = <span class="number">10</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;handle = <span class="title function_ invoke__">fopen</span>(<span class="variable">$this</span>-&gt;lockFile, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;handle) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;无法创建锁文件&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$startTime</span> = <span class="title function_ invoke__">time</span>();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">flock</span>(<span class="variable">$this</span>-&gt;handle, LOCK_EX | LOCK_NB)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">time</span>() - <span class="variable">$startTime</span> &gt; <span class="variable">$timeout</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">fclose</span>(<span class="variable">$this</span>-&gt;handle);</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&#x27;获取文件锁超时&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">usleep</span>(<span class="number">100000</span>);  <span class="comment">// 等待100ms</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unlock</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;handle) &#123;</span><br><span class="line">            <span class="title function_ invoke__">flock</span>(<span class="variable">$this</span>-&gt;handle, LOCK_UN);</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$this</span>-&gt;handle);</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;lockFile);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;handle = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">unlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 安全的计数器示例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SafeCounter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$counterFile</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$locker</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$counterFile</span> = <span class="string">&#x27;counter.txt&#x27;</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;counterFile = <span class="variable">$counterFile</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;locker = <span class="keyword">new</span> <span class="title class_">FileLocker</span>(<span class="variable">$counterFile</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$counterFile</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$counterFile</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;locker-&gt;<span class="title function_ invoke__">lock</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$current</span> = (<span class="keyword">int</span>)<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;counterFile);</span><br><span class="line">            <span class="variable">$new</span> = <span class="variable">$current</span> + <span class="number">1</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;counterFile, <span class="variable">$new</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;locker-&gt;<span class="title function_ invoke__">unlock</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$new</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;locker-&gt;<span class="title function_ invoke__">unlock</span>();</span><br><span class="line">            <span class="keyword">throw</span> <span class="variable">$e</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;counterFile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试并发安全</span></span><br><span class="line"><span class="variable">$counter</span> = <span class="keyword">new</span> <span class="title class_">SafeCounter</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;当前计数：&quot;</span> . <span class="variable">$counter</span>-&gt;<span class="title function_ invoke__">get</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;递增后：&quot;</span> . <span class="variable">$counter</span>-&gt;<span class="title function_ invoke__">increment</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;再次递增：&quot;</span> . <span class="variable">$counter</span>-&gt;<span class="title function_ invoke__">increment</span>() . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清理</span></span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;counter.txt&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="常见错误和注意事项"><a href="#常见错误和注意事项" class="headerlink" title="常见错误和注意事项"></a>常见错误和注意事项</h2><h3 id="1-文件操作错误处理"><a href="#1-文件操作错误处理" class="headerlink" title="1. 文件操作错误处理"></a>1. 文件操作错误处理</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 常见错误和解决方案</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">demonstrateCommonErrors</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;=== 常见文件操作错误 ===\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 错误1：不检查文件是否存在</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="string">&#x27;nonexistent.txt&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 错误的做法</span></span><br><span class="line">    <span class="comment">// $content = file_get_contents($filename);  // 会产生警告</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 正确的做法</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;错误：文件 <span class="subst">$filename</span> 不存在\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 错误2：不检查目录权限</span></span><br><span class="line">    <span class="variable">$restrictedDir</span> = <span class="string">&#x27;/root/test.txt&#x27;</span>;  <span class="comment">// 假设没有权限</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 正确的做法：检查权限</span></span><br><span class="line">    <span class="variable">$dir</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$restrictedDir</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_writable</span>(<span class="variable">$dir</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;错误：目录 <span class="subst">$dir</span> 不可写\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 错误3：忘记关闭文件句柄</span></span><br><span class="line">    <span class="variable">$testFile</span> = <span class="string">&#x27;test_handle.txt&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$testFile</span>, <span class="string">&#x27;test content&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 错误的做法</span></span><br><span class="line">    <span class="comment">// $handle = fopen($testFile, &#x27;r&#x27;);</span></span><br><span class="line">    <span class="comment">// $content = fread($handle, filesize($testFile));</span></span><br><span class="line">    <span class="comment">// // 忘记 fclose($handle);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 正确的做法</span></span><br><span class="line">    <span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$testFile</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$handle</span>) &#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$handle</span>, <span class="title function_ invoke__">filesize</span>(<span class="variable">$testFile</span>));</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);  <span class="comment">// 记得关闭</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;正确读取文件内容\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 错误4：不处理文件操作返回值</span></span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;readonly.txt&#x27;</span>, <span class="string">&#x27;content&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$result</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;文件写入失败\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;成功写入 <span class="subst">$result</span> 字节\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清理</span></span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="variable">$testFile</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;readonly.txt&#x27;</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;readonly.txt&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">demonstrateCommonErrors</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-内存使用优化"><a href="#2-内存使用优化" class="headerlink" title="2. 内存使用优化"></a>2. 内存使用优化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 处理大文件时的内存优化</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processLargeFileEfficiently</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="comment">// 创建大文件用于测试</span></span><br><span class="line">        <span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">100000</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$handle</span>, <span class="string">&quot;这是第 <span class="subst">$i</span> 行数据，包含一些测试内容\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;文件大小：&quot;</span> . <span class="title function_ invoke__">number_format</span>(<span class="title function_ invoke__">filesize</span>(<span class="variable">$filename</span>)) . <span class="string">&quot; 字节\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 错误的做法：一次性读取整个文件</span></span><br><span class="line">    <span class="comment">// $content = file_get_contents($filename);  // 可能导致内存不足</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 正确的做法：分块处理</span></span><br><span class="line">    <span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$handle</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;无法打开文件\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$chunkSize</span> = <span class="number">8192</span>;  <span class="comment">// 8KB</span></span><br><span class="line">    <span class="variable">$lineCount</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$buffer</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$handle</span>)) &#123;</span><br><span class="line">        <span class="variable">$chunk</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$handle</span>, <span class="variable">$chunkSize</span>);</span><br><span class="line">        <span class="variable">$buffer</span> .= <span class="variable">$chunk</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理完整的行</span></span><br><span class="line">        <span class="keyword">while</span> ((<span class="variable">$pos</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$buffer</span>, <span class="string">&quot;\n&quot;</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$line</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$buffer</span>, <span class="number">0</span>, <span class="variable">$pos</span>);</span><br><span class="line">            <span class="variable">$buffer</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$buffer</span>, <span class="variable">$pos</span> + <span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 处理这一行</span></span><br><span class="line">            <span class="variable">$lineCount</span>++;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 每1000行显示一次进度</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$lineCount</span> % <span class="number">10000</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;已处理 <span class="subst">$lineCount</span> 行\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理最后的不完整行</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$buffer</span>)) &#123;</span><br><span class="line">        <span class="variable">$lineCount</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$handle</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;总共处理了 <span class="subst">$lineCount</span> 行\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清理测试文件</span></span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">processLargeFileEfficiently</span>(<span class="string">&#x27;large_test_file.txt&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>PHP文件操作的关键要点：</p>
<ol>
<li><p><strong>基本操作</strong>：</p>
<ul>
<li>熟练使用file_exists、is_file、is_dir等检查函数</li>
<li>掌握文件路径操作函数</li>
<li>理解文件权限和安全性</li>
</ul>
</li>
<li><p><strong>文件读写</strong>：</p>
<ul>
<li>小文件使用file_get_contents&#x2F;file_put_contents</li>
<li>大文件使用文件句柄逐行处理</li>
<li>合理选择读写模式</li>
</ul>
</li>
<li><p><strong>目录操作</strong>：</p>
<ul>
<li>掌握目录创建、删除和遍历</li>
<li>使用适当的迭代器处理目录结构</li>
<li>实现递归目录操作</li>
</ul>
</li>
<li><p><strong>安全考虑</strong>：</p>
<ul>
<li>验证文件名和路径</li>
<li>检查文件类型和大小</li>
<li>防止目录遍历攻击</li>
<li>使用文件锁处理并发</li>
</ul>
</li>
<li><p><strong>性能优化</strong>：</p>
<ul>
<li>分块处理大文件</li>
<li>避免一次性加载大量数据</li>
<li>合理使用缓冲区</li>
</ul>
</li>
<li><p><strong>错误处理</strong>：</p>
<ul>
<li>检查函数返回值</li>
<li>使用try-catch处理异常</li>
<li>提供有意义的错误信息</li>
</ul>
</li>
<li><p><strong>最佳实践</strong>：</p>
<ul>
<li>始终关闭文件句柄</li>
<li>使用适当的文件权限</li>
<li>实现日志轮转和配置管理</li>
<li>编写可重用的文件操作类</li>
</ul>
</li>
</ol>
<p>文件操作是Web开发的基础技能，正确掌握这些知识对于构建稳定、安全的应用程序至关重要。记住，好的文件操作代码应该是安全的、高效的、易于维护的。</p>
<p>希望这篇文章能帮助你更好地掌握PHP文件操作技巧！在实际开发中，要根据具体需求选择合适的方法，并始终考虑安全性和性能。</p>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/PHP%E5%9F%BA%E7%A1%80/">PHP基础</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/">文件操作</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/">文件读写</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C/">目录操作</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2023/php/php-error-handling-debugging/"
                                   title="PHP错误处理与调试技巧：从新手到专家的必备技能"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">PHP错误处理与调试技巧：从新手到专家的必备技能</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2023/python/python-type-hints-best-practices/"
                                   title="Python类型提示最佳实践：提高代码质量的完全指南"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Python类型提示最佳实践：提高代码质量的完全指南</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PHP%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="nav-text">PHP文件操作入门：读写文件的实用技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">文件基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95"><span class="nav-text">1. 检查文件和目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C"><span class="nav-text">2. 文件路径操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%93%8D%E4%BD%9C"><span class="nav-text">文件读取操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%80%E6%AC%A1%E6%80%A7%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-text">1. 一次性读取文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%80%90%E8%A1%8C%E8%AF%BB%E5%8F%96%E5%A4%A7%E6%96%87%E4%BB%B6"><span class="nav-text">2. 逐行读取大文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="nav-text">3. 二进制文件读取</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="nav-text">文件写入操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%AE%80%E5%8D%95%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="nav-text">1. 简单文件写入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8%E6%96%87%E4%BB%B6%E5%8F%A5%E6%9F%84%E5%86%99%E5%85%A5"><span class="nav-text">2. 使用文件句柄写入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-CSV%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-text">3. CSV文件操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C"><span class="nav-text">目录操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4%E7%9B%AE%E5%BD%95"><span class="nav-text">1. 创建和删除目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%81%8D%E5%8E%86%E7%9B%AE%E5%BD%95"><span class="nav-text">2. 遍历目录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%84%E7%90%86"><span class="nav-text">文件上传处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-text">1. 基本文件上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-text">日志文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%AE%80%E5%8D%95%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="nav-text">1. 简单日志记录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-text">配置文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-INI%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">1. INI配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-JSON%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">2. JSON配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%AE%89%E5%85%A8%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">文件安全和最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E5%92%8C%E5%AE%89%E5%85%A8"><span class="nav-text">1. 文件权限和安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%96%87%E4%BB%B6%E9%94%81%E5%AE%9A%E5%92%8C%E5%B9%B6%E5%8F%91%E5%A4%84%E7%90%86"><span class="nav-text">2. 文件锁定和并发处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%92%8C%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">常见错误和注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-text">1. 文件操作错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E4%BC%98%E5%8C%96"><span class="nav-text">2. 内存使用优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;2025
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Orion K</a>
        
    </div>


    
        
        <div class="deploy-info info-item">
            
            本站由 <span class="tooltip" data-tooltip-content="GitHub Pages"><img src="/images/brands/github.png"></span> 提供部署服务
            
        </div>
    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PHP%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E5%85%A5%E9%97%A8%EF%BC%9A%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="nav-text">PHP文件操作入门：读写文件的实用技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">文件基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95"><span class="nav-text">1. 检查文件和目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C"><span class="nav-text">2. 文件路径操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%93%8D%E4%BD%9C"><span class="nav-text">文件读取操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%80%E6%AC%A1%E6%80%A7%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="nav-text">1. 一次性读取文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%80%90%E8%A1%8C%E8%AF%BB%E5%8F%96%E5%A4%A7%E6%96%87%E4%BB%B6"><span class="nav-text">2. 逐行读取大文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="nav-text">3. 二进制文件读取</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="nav-text">文件写入操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%AE%80%E5%8D%95%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="nav-text">1. 简单文件写入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8%E6%96%87%E4%BB%B6%E5%8F%A5%E6%9F%84%E5%86%99%E5%85%A5"><span class="nav-text">2. 使用文件句柄写入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-CSV%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-text">3. CSV文件操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C"><span class="nav-text">目录操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4%E7%9B%AE%E5%BD%95"><span class="nav-text">1. 创建和删除目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%81%8D%E5%8E%86%E7%9B%AE%E5%BD%95"><span class="nav-text">2. 遍历目录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%84%E7%90%86"><span class="nav-text">文件上传处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-text">1. 基本文件上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-text">日志文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%AE%80%E5%8D%95%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="nav-text">1. 简单日志记录</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-text">配置文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-INI%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">1. INI配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-JSON%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">2. JSON配置文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%AE%89%E5%85%A8%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">文件安全和最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E5%92%8C%E5%AE%89%E5%85%A8"><span class="nav-text">1. 文件权限和安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%96%87%E4%BB%B6%E9%94%81%E5%AE%9A%E5%92%8C%E5%B9%B6%E5%8F%91%E5%A4%84%E7%90%86"><span class="nav-text">2. 文件锁定和并发处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E5%92%8C%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">常见错误和注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-text">1. 文件操作错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E4%BC%98%E5%8C%96"><span class="nav-text">2. 内存使用优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
