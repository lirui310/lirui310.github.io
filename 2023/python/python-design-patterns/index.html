<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Orion K">
    
    <title>
        
            Python设计模式实战：23种经典模式的Python实现 |
        
        Orion K Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"Orion K Blog","author":"Orion K","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/                        || fa-solid fa-home","archives":"/archives            || fa-solid fa-box-archive","tags":"/tags                    || fa-solid fa-tags","categories":"/categories        || fa-solid fa-layer-group","about":"/about                  || fa-solid fa-user-graduate"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":"欢迎来到 Orion K 的博客，这是一个分享互联网技术的博客。","category":true,"tag":true,"post_datetime":"created"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":null,"reaction":false,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2025,"word_count":false,"site_deploy":{"enable":true,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Orion K Blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                首页
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                归档
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                标签
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                
                                分类
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-user-graduate"></i>
                                
                                关于
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            首页
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            归档
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            标签
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                </span>
                            
                            分类
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-user-graduate"></i>
                                </span>
                            
                            关于
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        Python设计模式实战：23种经典模式的Python实现
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Orion K</span>
                                
                                    <span class="author-badge">Lv4</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2023-01-08 13:20:00</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/python/">python</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">面向对象</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E4%BB%A3%E7%A0%81%E6%9E%B6%E6%9E%84/">代码架构</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">软件工程</a></li>
                        
                    
                </ul>
            </span>
        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h1 id="Python设计模式实战：23种经典模式的Python实现"><a href="#Python设计模式实战：23种经典模式的Python实现" class="headerlink" title="Python设计模式实战：23种经典模式的Python实现"></a>Python设计模式实战：23种经典模式的Python实现</h1><p>作为一名Python开发者，掌握设计模式对于编写高质量、可维护的代码至关重要。设计模式是软件开发中常见问题的可重用解决方案，它们可以帮助我们创建更灵活、更易于维护的代码。在这篇文章中，我将分享如何在Python中实现23种经典的设计模式，并探讨它们的实际应用场景。</p>
<h2 id="设计模式简介"><a href="#设计模式简介" class="headerlink" title="设计模式简介"></a>设计模式简介</h2><p>设计模式通常分为三大类：</p>
<ol>
<li><strong>创建型模式</strong>：处理对象创建机制</li>
<li><strong>结构型模式</strong>：关注类和对象的组合</li>
<li><strong>行为型模式</strong>：关注对象之间的通信</li>
</ol>
<p>让我们逐一探讨这些模式在Python中的实现。</p>
<h2 id="创建型模式"><a href="#创建型模式" class="headerlink" title="创建型模式"></a>创建型模式</h2><h3 id="1-单例模式-Singleton"><a href="#1-单例模式-Singleton" class="headerlink" title="1. 单例模式 (Singleton)"></a>1. 单例模式 (Singleton)</h3><p>单例模式确保一个类只有一个实例，并提供一个全局访问点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用装饰器实现</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">singleton</span>(<span class="params">cls</span>):</span><br><span class="line">    instances = &#123;&#125;</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_instance</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instances:</span><br><span class="line">            instances[cls] = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> instances[cls]</span><br><span class="line">    <span class="keyword">return</span> get_instance</span><br><span class="line"></span><br><span class="line"><span class="meta">@singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.log_file = <span class="string">&quot;app.log&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.log_file, <span class="string">&quot;a&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">f&quot;<span class="subst">&#123;message&#125;</span>\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：数据库连接、日志记录器、配置管理器</p>
<h3 id="2-工厂方法模式-Factory-Method"><a href="#2-工厂方法模式-Factory-Method" class="headerlink" title="2. 工厂方法模式 (Factory Method)"></a>2. 工厂方法模式 (Factory Method)</h3><p>工厂方法模式定义了一个创建对象的接口，但让子类决定实例化哪个类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产品接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Woof!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Meow!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnimalFactory</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_animal</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        animal = <span class="variable language_">self</span>.create_animal()</span><br><span class="line">        <span class="keyword">return</span> animal.speak()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体创建者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DogFactory</span>(<span class="title class_ inherited__">AnimalFactory</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_animal</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> Dog()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CatFactory</span>(<span class="title class_ inherited__">AnimalFactory</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_animal</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> Cat()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pet</span>(<span class="params">factory</span>):</span><br><span class="line">    <span class="keyword">return</span> factory.make_sound()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="built_in">print</span>(get_pet(DogFactory()))  <span class="comment"># 输出: Woof!</span></span><br><span class="line"><span class="built_in">print</span>(get_pet(CatFactory()))  <span class="comment"># 输出: Meow!</span></span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：插件系统、框架扩展点、多平台应用</p>
<h3 id="3-抽象工厂模式-Abstract-Factory"><a href="#3-抽象工厂模式-Abstract-Factory" class="headerlink" title="3. 抽象工厂模式 (Abstract Factory)"></a>3. 抽象工厂模式 (Abstract Factory)</h3><p>抽象工厂模式提供一个接口来创建相关或依赖对象的家族，而不指定它们的具体类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Checkbox</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindowsButton</span>(<span class="title class_ inherited__">Button</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Rendering a Windows button&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacOSButton</span>(<span class="title class_ inherited__">Button</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Rendering a MacOS button&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindowsCheckbox</span>(<span class="title class_ inherited__">Checkbox</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Rendering a Windows checkbox&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacOSCheckbox</span>(<span class="title class_ inherited__">Checkbox</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Rendering a MacOS checkbox&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GUIFactory</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_button</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_checkbox</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindowsFactory</span>(<span class="title class_ inherited__">GUIFactory</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_button</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> WindowsButton()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_checkbox</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> WindowsCheckbox()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacOSFactory</span>(<span class="title class_ inherited__">GUIFactory</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_button</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> MacOSButton()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_checkbox</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> MacOSCheckbox()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, factory</span>):</span><br><span class="line">        <span class="variable language_">self</span>.factory = factory</span><br><span class="line">        <span class="variable language_">self</span>.button = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.checkbox = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_ui</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.button = <span class="variable language_">self</span>.factory.create_button()</span><br><span class="line">        <span class="variable language_">self</span>.checkbox = <span class="variable language_">self</span>.factory.create_checkbox()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.button.paint()&#125;</span> and <span class="subst">&#123;self.checkbox.paint()&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据操作系统选择工厂</span></span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">if</span> platform.system() == <span class="string">&quot;Windows&quot;</span>:</span><br><span class="line">    factory = WindowsFactory()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    factory = MacOSFactory()</span><br><span class="line"></span><br><span class="line">app = Application(factory)</span><br><span class="line">app.create_ui()</span><br><span class="line"><span class="built_in">print</span>(app.paint())</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：跨平台UI库、多数据库支持的ORM、不同风格的UI主题</p>
<h3 id="4-建造者模式-Builder"><a href="#4-建造者模式-Builder" class="headerlink" title="4. 建造者模式 (Builder)"></a>4. 建造者模式 (Builder)</h3><p>建造者模式将复杂对象的构建与其表示分离，使同样的构建过程可以创建不同的表示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.cpu = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.ram = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.storage = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.gpu = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Computer [CPU: <span class="subst">&#123;self.cpu&#125;</span>, RAM: <span class="subst">&#123;self.ram&#125;</span>GB, Storage: <span class="subst">&#123;self.storage&#125;</span>GB, GPU: <span class="subst">&#123;self.gpu&#125;</span>]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerBuilder</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer = Computer()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_cpu</span>(<span class="params">self, cpu</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer.cpu = cpu</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_ram</span>(<span class="params">self, ram</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer.ram = ram</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_storage</span>(<span class="params">self, storage</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer.storage = storage</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_gpu</span>(<span class="params">self, gpu</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer.gpu = gpu</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.computer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Director</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, builder</span>):</span><br><span class="line">        <span class="variable language_">self</span>.builder = builder</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_gaming_pc</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.builder.configure_cpu(<span class="string">&quot;Intel i9&quot;</span>) \</span><br><span class="line">                          .configure_ram(<span class="number">32</span>) \</span><br><span class="line">                          .configure_storage(<span class="number">1000</span>) \</span><br><span class="line">                          .configure_gpu(<span class="string">&quot;NVIDIA RTX 3080&quot;</span>) \</span><br><span class="line">                          .build()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_office_pc</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.builder.configure_cpu(<span class="string">&quot;Intel i5&quot;</span>) \</span><br><span class="line">                          .configure_ram(<span class="number">16</span>) \</span><br><span class="line">                          .configure_storage(<span class="number">512</span>) \</span><br><span class="line">                          .configure_gpu(<span class="string">&quot;Integrated&quot;</span>) \</span><br><span class="line">                          .build()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">builder = ComputerBuilder()</span><br><span class="line">director = Director(builder)</span><br><span class="line"></span><br><span class="line">gaming_pc = director.build_gaming_pc()</span><br><span class="line"><span class="built_in">print</span>(gaming_pc)</span><br><span class="line"></span><br><span class="line">office_pc = director.build_office_pc()</span><br><span class="line"><span class="built_in">print</span>(office_pc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接使用建造者（不使用指导者）</span></span><br><span class="line">custom_pc = ComputerBuilder() \</span><br><span class="line">    .configure_cpu(<span class="string">&quot;AMD Ryzen 7&quot;</span>) \</span><br><span class="line">    .configure_ram(<span class="number">64</span>) \</span><br><span class="line">    .configure_storage(<span class="number">2000</span>) \</span><br><span class="line">    .configure_gpu(<span class="string">&quot;AMD Radeon&quot;</span>) \</span><br><span class="line">    .build()</span><br><span class="line"><span class="built_in">print</span>(custom_pc)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：复杂对象创建、配置对象、对象有多种表示形式</p>
<h3 id="5-原型模式-Prototype"><a href="#5-原型模式-Prototype" class="headerlink" title="5. 原型模式 (Prototype)"></a>5. 原型模式 (Prototype)</h3><p>原型模式通过复制现有对象来创建新对象，而不是通过实例化类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Prototype</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clone</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> copy.deepcopy(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Document</span>(<span class="title class_ inherited__">Prototype</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, content, styles</span>):</span><br><span class="line">        <span class="variable language_">self</span>.content = content</span><br><span class="line">        <span class="variable language_">self</span>.styles = styles</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Document [Content: <span class="subst">&#123;self.content&#125;</span>, Styles: <span class="subst">&#123;self.styles&#125;</span>]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">original = Document(<span class="string">&quot;Hello, World!&quot;</span>, &#123;<span class="string">&quot;font&quot;</span>: <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;size&quot;</span>: <span class="number">12</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Original: <span class="subst">&#123;original&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆并修改</span></span><br><span class="line">clone = original.clone()</span><br><span class="line">clone.content = <span class="string">&quot;Hello, Python!&quot;</span></span><br><span class="line">clone.styles[<span class="string">&quot;size&quot;</span>] = <span class="number">14</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Clone: <span class="subst">&#123;clone&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Original after cloning: <span class="subst">&#123;original&#125;</span>&quot;</span>)  <span class="comment"># 原对象不受影响</span></span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：对象初始化成本高、需要保存对象状态作为历史记录、复制复杂对象</p>
<h2 id="结构型模式"><a href="#结构型模式" class="headerlink" title="结构型模式"></a>结构型模式</h2><h3 id="6-适配器模式-Adapter"><a href="#6-适配器模式-Adapter" class="headerlink" title="6. 适配器模式 (Adapter)"></a>6. 适配器模式 (Adapter)</h3><p>适配器模式允许接口不兼容的类一起工作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 目标接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Target</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Target: The default target&#x27;s behavior.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要适配的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adaptee</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">specific_request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Adaptee: Special behavior.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span>(<span class="title class_ inherited__">Target</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, adaptee</span>):</span><br><span class="line">        <span class="variable language_">self</span>.adaptee = adaptee</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Adapter: (TRANSLATED) <span class="subst">&#123;self.adaptee.specific_request()&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">target</span>):</span><br><span class="line">    <span class="keyword">return</span> target.request()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">adaptee = Adaptee()</span><br><span class="line">adapter = Adapter(adaptee)</span><br><span class="line"><span class="built_in">print</span>(client_code(adapter))</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：集成第三方库、兼容旧API、数据格式转换</p>
<h3 id="7-桥接模式-Bridge"><a href="#7-桥接模式-Bridge" class="headerlink" title="7. 桥接模式 (Bridge)"></a>7. 桥接模式 (Bridge)</h3><p>桥接模式将抽象部分与其实现部分分离，使它们可以独立变化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实现部分接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Device</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_enabled</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_volume</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_volume</span>(<span class="params">self, volume</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TV</span>(<span class="title class_ inherited__">Device</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.volume = <span class="number">30</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_enabled</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.enabled</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_volume</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.volume</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_volume</span>(<span class="params">self, volume</span>):</span><br><span class="line">        <span class="keyword">if</span> volume &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = <span class="number">100</span></span><br><span class="line">        <span class="keyword">elif</span> volume &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = volume</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Radio</span>(<span class="title class_ inherited__">Device</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.volume = <span class="number">20</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_enabled</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.enabled</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_volume</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.volume</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_volume</span>(<span class="params">self, volume</span>):</span><br><span class="line">        <span class="keyword">if</span> volume &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = <span class="number">100</span></span><br><span class="line">        <span class="keyword">elif</span> volume &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = volume</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象部分</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteControl</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, device</span>):</span><br><span class="line">        <span class="variable language_">self</span>.device = device</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toggle_power</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.device.is_enabled():</span><br><span class="line">            <span class="variable language_">self</span>.device.disable()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.device.enable()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">volume_up</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.device.set_volume(<span class="variable language_">self</span>.device.get_volume() + <span class="number">10</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">volume_down</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.device.set_volume(<span class="variable language_">self</span>.device.get_volume() - <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展抽象部分</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdvancedRemoteControl</span>(<span class="title class_ inherited__">RemoteControl</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.device.set_volume(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">tv = TV()</span><br><span class="line">remote = RemoteControl(tv)</span><br><span class="line">remote.toggle_power()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;TV is <span class="subst">&#123;<span class="string">&#x27;on&#x27;</span> <span class="keyword">if</span> tv.is_enabled() <span class="keyword">else</span> <span class="string">&#x27;off&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">remote.volume_up()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;TV volume: <span class="subst">&#123;tv.get_volume()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">radio = Radio()</span><br><span class="line">advanced_remote = AdvancedRemoteControl(radio)</span><br><span class="line">advanced_remote.toggle_power()</span><br><span class="line">advanced_remote.volume_up()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Radio is <span class="subst">&#123;<span class="string">&#x27;on&#x27;</span> <span class="keyword">if</span> radio.is_enabled() <span class="keyword">else</span> <span class="string">&#x27;off&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Radio volume: <span class="subst">&#123;radio.get_volume()&#125;</span>&quot;</span>)</span><br><span class="line">advanced_remote.mute()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Radio volume after mute: <span class="subst">&#123;radio.get_volume()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：跨平台应用、支持多种数据库的应用、多种渲染引擎的图形应用</p>
<h3 id="8-组合模式-Composite"><a href="#8-组合模式-Composite" class="headerlink" title="8. 组合模式 (Composite)"></a>8. 组合模式 (Composite)</h3><p>组合模式将对象组合成树形结构以表示”部分-整体”的层次结构。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组件接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">self, indent=<span class="number">0</span></span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 叶节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">File</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, size</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        <span class="variable language_">self</span>.size = size</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">self, indent=<span class="number">0</span></span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot; &quot;</span> * indent + <span class="string">f&quot;- File: <span class="subst">&#123;self.name&#125;</span> (<span class="subst">&#123;self.size&#125;</span> KB)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复合节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Directory</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        <span class="variable language_">self</span>.children = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, component</span>):</span><br><span class="line">        <span class="variable language_">self</span>.children.append(component)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">self, component</span>):</span><br><span class="line">        <span class="variable language_">self</span>.children.remove(component)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">self, indent=<span class="number">0</span></span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot; &quot;</span> * indent + <span class="string">f&quot;+ Directory: <span class="subst">&#123;self.name&#125;</span> (<span class="subst">&#123;self.get_size()&#125;</span> KB)&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> child <span class="keyword">in</span> <span class="variable language_">self</span>.children:</span><br><span class="line">            child.display(indent + <span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(child.get_size() <span class="keyword">for</span> child <span class="keyword">in</span> <span class="variable language_">self</span>.children)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">root = Directory(<span class="string">&quot;root&quot;</span>)</span><br><span class="line"></span><br><span class="line">documents = Directory(<span class="string">&quot;documents&quot;</span>)</span><br><span class="line">documents.add(File(<span class="string">&quot;resume.pdf&quot;</span>, <span class="number">1024</span>))</span><br><span class="line">documents.add(File(<span class="string">&quot;cover_letter.docx&quot;</span>, <span class="number">512</span>))</span><br><span class="line"></span><br><span class="line">pictures = Directory(<span class="string">&quot;pictures&quot;</span>)</span><br><span class="line">pictures.add(File(<span class="string">&quot;vacation.jpg&quot;</span>, <span class="number">2048</span>))</span><br><span class="line">pictures.add(File(<span class="string">&quot;family.jpg&quot;</span>, <span class="number">1536</span>))</span><br><span class="line"></span><br><span class="line">root.add(documents).add(pictures).add(File(<span class="string">&quot;notes.txt&quot;</span>, <span class="number">128</span>))</span><br><span class="line"></span><br><span class="line">root.display()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Total size: <span class="subst">&#123;root.get_size()&#125;</span> KB&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：文件系统、图形界面组件、组织结构</p>
<h3 id="9-装饰器模式-Decorator"><a href="#9-装饰器模式-Decorator" class="headerlink" title="9. 装饰器模式 (Decorator)"></a>9. 装饰器模式 (Decorator)</h3><p>装饰器模式动态地给对象添加额外的职责，是子类化的灵活替代方案。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组件接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Coffee</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCoffee</span>(<span class="title class_ inherited__">Coffee</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Simple coffee&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CoffeeDecorator</span>(<span class="title class_ inherited__">Coffee</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, coffee</span>):</span><br><span class="line">        <span class="variable language_">self</span>.coffee = coffee</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.cost()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.description()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MilkDecorator</span>(<span class="title class_ inherited__">CoffeeDecorator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.cost() + <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.description() + <span class="string">&quot;, with milk&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SugarDecorator</span>(<span class="title class_ inherited__">CoffeeDecorator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.cost() + <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.description() + <span class="string">&quot;, with sugar&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WhippedCreamDecorator</span>(<span class="title class_ inherited__">CoffeeDecorator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.cost() + <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.description() + <span class="string">&quot;, with whipped cream&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">coffee = SimpleCoffee()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;coffee.description()&#125;</span>: $<span class="subst">&#123;coffee.cost()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">coffee_with_milk = MilkDecorator(coffee)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;coffee_with_milk.description()&#125;</span>: $<span class="subst">&#123;coffee_with_milk.cost()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">coffee_with_milk_and_sugar = SugarDecorator(coffee_with_milk)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;coffee_with_milk_and_sugar.description()&#125;</span>: $<span class="subst">&#123;coffee_with_milk_and_sugar.cost()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">deluxe_coffee = WhippedCreamDecorator(SugarDecorator(MilkDecorator(SimpleCoffee())))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;deluxe_coffee.description()&#125;</span>: $<span class="subst">&#123;deluxe_coffee.cost()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：添加功能到对象而不修改其代码、动态组合功能、Python的装饰器语法</p>
<h3 id="10-外观模式-Facade"><a href="#10-外观模式-Facade" class="headerlink" title="10. 外观模式 (Facade)"></a>10. 外观模式 (Facade)</h3><p>外观模式为子系统中的一组接口提供一个统一的高层接口，使子系统更容易使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复杂子系统</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CPU</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">freeze</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CPU: Freezing processor.&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">jump</span>(<span class="params">self, address</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;CPU: Jumping to <span class="subst">&#123;address&#125;</span>.&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CPU: Executing commands.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memory</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">self, address, data</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Memory: Loading data &#x27;<span class="subst">&#123;data&#125;</span>&#x27; to address <span class="subst">&#123;address&#125;</span>.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HardDrive</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">self, sector, size</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;HardDrive: Reading <span class="subst">&#123;size&#125;</span> bytes from sector <span class="subst">&#123;sector&#125;</span>.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 外观</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerFacade</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.cpu = CPU()</span><br><span class="line">        <span class="variable language_">self</span>.memory = Memory()</span><br><span class="line">        <span class="variable language_">self</span>.hard_drive = HardDrive()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        steps = [</span><br><span class="line">            <span class="variable language_">self</span>.cpu.freeze(),</span><br><span class="line">            <span class="variable language_">self</span>.memory.load(<span class="number">0</span>, <span class="string">&quot;boot data&quot;</span>),</span><br><span class="line">            <span class="variable language_">self</span>.cpu.jump(<span class="number">0</span>),</span><br><span class="line">            <span class="variable language_">self</span>.cpu.execute()</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(steps) + <span class="string">&quot;\nComputer started successfully.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">computer = ComputerFacade()</span><br><span class="line"><span class="built_in">print</span>(computer.start())</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：简化复杂库的使用、提供统一接口、封装遗留系统</p>
<h3 id="11-享元模式-Flyweight"><a href="#11-享元模式-Flyweight" class="headerlink" title="11. 享元模式 (Flyweight)"></a>11. 享元模式 (Flyweight)</h3><p>享元模式通过共享尽可能多的相似对象来最小化内存使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 享元工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeFactory</span>:</span><br><span class="line">    _tree_types = &#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_tree_type</span>(<span class="params">cls, name, color, texture</span>):</span><br><span class="line">        key = <span class="string">f&quot;<span class="subst">&#123;name&#125;</span>_<span class="subst">&#123;color&#125;</span>_<span class="subst">&#123;texture&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> cls._tree_types:</span><br><span class="line">            cls._tree_types[key] = TreeType(name, color, texture)</span><br><span class="line">        <span class="keyword">return</span> cls._tree_types[key]</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tree_types_count</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(cls._tree_types)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 享元（内在状态）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeType</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, color, texture</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.color = color</span><br><span class="line">        <span class="variable language_">self</span>.texture = texture</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Rendering <span class="subst">&#123;self.color&#125;</span> <span class="subst">&#123;self.name&#125;</span> tree with <span class="subst">&#123;self.texture&#125;</span> texture at (<span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上下文（外在状态）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tree</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y, tree_type</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line">        <span class="variable language_">self</span>.tree_type = tree_type</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.tree_type.render(<span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Forest</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.trees = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">plant_tree</span>(<span class="params">self, x, y, name, color, texture</span>):</span><br><span class="line">        tree_type = TreeFactory.get_tree_type(name, color, texture)</span><br><span class="line">        tree = Tree(x, y, tree_type)</span><br><span class="line">        <span class="variable language_">self</span>.trees.append(tree)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self</span>):</span><br><span class="line">        results = [tree.render() <span class="keyword">for</span> tree <span class="keyword">in</span> <span class="variable language_">self</span>.trees]</span><br><span class="line">        results.append(<span class="string">f&quot;Forest rendered with <span class="subst">&#123;<span class="built_in">len</span>(self.trees)&#125;</span> trees using <span class="subst">&#123;TreeFactory.tree_types_count()&#125;</span> tree types.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(results)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">forest = Forest()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 植树</span></span><br><span class="line">tree_types = [</span><br><span class="line">    (<span class="string">&quot;Pine&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;smooth&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;Maple&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;rough&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;Oak&quot;</span>, <span class="string">&quot;brown&quot;</span>, <span class="string">&quot;rough&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;Pine&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;smooth&quot;</span>),  <span class="comment"># 重复的类型</span></span><br><span class="line">    (<span class="string">&quot;Maple&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;rough&quot;</span>)     <span class="comment"># 重复的类型</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    tree_type = random.choice(tree_types)</span><br><span class="line">    forest.plant_tree(</span><br><span class="line">        random.randint(<span class="number">0</span>, <span class="number">100</span>),</span><br><span class="line">        random.randint(<span class="number">0</span>, <span class="number">100</span>),</span><br><span class="line">        tree_type[<span class="number">0</span>],</span><br><span class="line">        tree_type[<span class="number">1</span>],</span><br><span class="line">        tree_type[<span class="number">2</span>]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(forest.render())</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：大量相似对象、内存受限、游戏中的粒子系统</p>
<h3 id="12-代理模式-Proxy"><a href="#12-代理模式-Proxy" class="headerlink" title="12. 代理模式 (Proxy)"></a>12. 代理模式 (Proxy)</h3><p>代理模式为其他对象提供一个替代品或占位符，以控制对这个对象的访问。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主题接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际主题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RealSubject</span>(<span class="title class_ inherited__">Subject</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RealSubject: Handling request.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Proxy</span>(<span class="title class_ inherited__">Subject</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, real_subject</span>):</span><br><span class="line">        <span class="variable language_">self</span>.real_subject = real_subject</span><br><span class="line">        <span class="variable language_">self</span>.access_count = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_access</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Proxy: Checking access prior to firing a real request.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_access</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.access_count += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Proxy: Request to RealSubject (<span class="subst">&#123;self.access_count&#125;</span> times).&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.check_access():</span><br><span class="line">            result = <span class="variable language_">self</span>.real_subject.request()</span><br><span class="line">            <span class="variable language_">self</span>.log_access()</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Proxy: Access denied.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">subject</span>):</span><br><span class="line">    <span class="keyword">return</span> subject.request()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">real_subject = RealSubject()</span><br><span class="line">proxy = Proxy(real_subject)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(client_code(proxy))</span><br><span class="line"><span class="built_in">print</span>(client_code(proxy))</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：延迟初始化、访问控制、日志记录、缓存、远程代理</p>
<h2 id="行为型模式"><a href="#行为型模式" class="headerlink" title="行为型模式"></a>行为型模式</h2><h3 id="13-责任链模式-Chain-of-Responsibility"><a href="#13-责任链模式-Chain-of-Responsibility" class="headerlink" title="13. 责任链模式 (Chain of Responsibility)"></a>13. 责任链模式 (Chain of Responsibility)</h3><p>责任链模式使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.next_handler = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_next</span>(<span class="params">self, handler</span>):</span><br><span class="line">        <span class="variable language_">self</span>.next_handler = handler</span><br><span class="line">        <span class="keyword">return</span> handler</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体处理者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AuthenticationHandler</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;authenticated&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> request:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;AuthenticationHandler: Authentication required.&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;AuthenticationHandler: User is authenticated.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.next_handler:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.next_handler.handle(request)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AuthorizationHandler</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;authenticated&quot;</span> <span class="keyword">in</span> request <span class="keyword">and</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> request:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;AuthorizationHandler: Admin rights required.&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;AuthorizationHandler: User has admin rights.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.next_handler:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.next_handler.handle(request)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ValidationHandler</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;data&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> request:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ValidationHandler: Invalid request data.&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ValidationHandler: Request data is valid.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.next_handler:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.next_handler.handle(request)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Request processed successfully.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">handler, request</span>):</span><br><span class="line">    result = handler.handle(request)</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Request was handled successfully.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建处理链</span></span><br><span class="line">authentication = AuthenticationHandler()</span><br><span class="line">authorization = AuthorizationHandler()</span><br><span class="line">validation = ValidationHandler()</span><br><span class="line"></span><br><span class="line">authentication.set_next(authorization).set_next(validation)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试不同请求</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Scenario 1: Unauthenticated request&quot;</span>)</span><br><span class="line">client_code(authentication, &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nScenario 2: Authenticated but unauthorized request&quot;</span>)</span><br><span class="line">client_code(authentication, &#123;<span class="string">&quot;authenticated&quot;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nScenario 3: Authenticated and authorized but invalid request&quot;</span>)</span><br><span class="line">client_code(authentication, &#123;<span class="string">&quot;authenticated&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;admin&quot;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nScenario 4: Valid request&quot;</span>)</span><br><span class="line">client_code(authentication, &#123;<span class="string">&quot;authenticated&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;admin&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;data&quot;</span>: <span class="string">&quot;Some data&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：请求处理管道、中间件、事件处理系统</p>
<h3 id="14-命令模式-Command"><a href="#14-命令模式-Command" class="headerlink" title="14. 命令模式 (Command)"></a>14. 命令模式 (Command)</h3><p>命令模式将请求封装为对象，从而允许参数化客户端、队列或记录请求，以及支持可撤销操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Editor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.text = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.clipboard = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.selection = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_selection</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.selection</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_selection</span>(<span class="params">self</span>):</span><br><span class="line">        old_selection = <span class="variable language_">self</span>.selection</span><br><span class="line">        <span class="variable language_">self</span>.text = <span class="variable language_">self</span>.text.replace(<span class="variable language_">self</span>.selection, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.selection = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> old_selection</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">replace_selection</span>(<span class="params">self, text</span>):</span><br><span class="line">        old_selection = <span class="variable language_">self</span>.selection</span><br><span class="line">        <span class="variable language_">self</span>.text = <span class="variable language_">self</span>.text.replace(<span class="variable language_">self</span>.selection, text)</span><br><span class="line">        <span class="variable language_">self</span>.selection = text</span><br><span class="line">        <span class="keyword">return</span> old_selection</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">copy_selection_to_clipboard</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.clipboard = <span class="variable language_">self</span>.selection</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paste_clipboard</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.selection:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.replace_selection(<span class="variable language_">self</span>.clipboard)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.text += <span class="variable language_">self</span>.clipboard</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CopyCommand</span>(<span class="title class_ inherited__">Command</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, editor</span>):</span><br><span class="line">        <span class="variable language_">self</span>.editor = editor</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.editor.copy_selection_to_clipboard()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 复制操作不需要撤销</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PasteCommand</span>(<span class="title class_ inherited__">Command</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, editor</span>):</span><br><span class="line">        <span class="variable language_">self</span>.editor = editor</span><br><span class="line">        <span class="variable language_">self</span>.backup = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.backup = <span class="variable language_">self</span>.editor.paste_clipboard()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.editor.selection:</span><br><span class="line">            <span class="variable language_">self</span>.editor.replace_selection(<span class="variable language_">self</span>.backup)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 简化：假设粘贴总是在末尾</span></span><br><span class="line">            <span class="variable language_">self</span>.editor.text = <span class="variable language_">self</span>.editor.text[:-<span class="built_in">len</span>(<span class="variable language_">self</span>.editor.clipboard)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CutCommand</span>(<span class="title class_ inherited__">Command</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, editor</span>):</span><br><span class="line">        <span class="variable language_">self</span>.editor = editor</span><br><span class="line">        <span class="variable language_">self</span>.backup = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.editor.copy_selection_to_clipboard()</span><br><span class="line">        <span class="variable language_">self</span>.backup = <span class="variable language_">self</span>.editor.delete_selection()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.editor.selection = <span class="variable language_">self</span>.backup</span><br><span class="line">        <span class="variable language_">self</span>.editor.text += <span class="variable language_">self</span>.backup</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommandHistory</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.history = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, command</span>):</span><br><span class="line">        <span class="variable language_">self</span>.history.append(command)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.history:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.history.pop()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.editor = Editor()</span><br><span class="line">        <span class="variable language_">self</span>.history = CommandHistory()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute_command</span>(<span class="params">self, command</span>):</span><br><span class="line">        command.execute()</span><br><span class="line">        <span class="variable language_">self</span>.history.push(command)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo</span>(<span class="params">self</span>):</span><br><span class="line">        command = <span class="variable language_">self</span>.history.pop()</span><br><span class="line">        <span class="keyword">if</span> command:</span><br><span class="line">            command.undo()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">app = Application()</span><br><span class="line">editor = app.editor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置初始文本和选择</span></span><br><span class="line">editor.text = <span class="string">&quot;Hello, world!&quot;</span></span><br><span class="line">editor.selection = <span class="string">&quot;world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行命令</span></span><br><span class="line">copy_command = CopyCommand(editor)</span><br><span class="line">app.execute_command(copy_command)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;After copy: Text=&#x27;<span class="subst">&#123;editor.text&#125;</span>&#x27;, Clipboard=&#x27;<span class="subst">&#123;editor.clipboard&#125;</span>&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">cut_command = CutCommand(editor)</span><br><span class="line">app.execute_command(cut_command)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;After cut: Text=&#x27;<span class="subst">&#123;editor.text&#125;</span>&#x27;, Clipboard=&#x27;<span class="subst">&#123;editor.clipboard&#125;</span>&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">paste_command = PasteCommand(editor)</span><br><span class="line">app.execute_command(paste_command)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;After paste: Text=&#x27;<span class="subst">&#123;editor.text&#125;</span>&#x27;, Clipboard=&#x27;<span class="subst">&#123;editor.clipboard&#125;</span>&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 撤销操作</span></span><br><span class="line">app.undo()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;After undo paste: Text=&#x27;<span class="subst">&#123;editor.text&#125;</span>&#x27;, Clipboard=&#x27;<span class="subst">&#123;editor.clipboard&#125;</span>&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.undo()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;After undo cut: Text=&#x27;<span class="subst">&#123;editor.text&#125;</span>&#x27;, Clipboard=&#x27;<span class="subst">&#123;editor.clipboard&#125;</span>&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：撤销&#x2F;重做功能、任务队列、宏记录、事务处理</p>
<h3 id="15-解释器模式-Interpreter"><a href="#15-解释器模式-Interpreter" class="headerlink" title="15. 解释器模式 (Interpreter)"></a>15. 解释器模式 (Interpreter)</h3><p>解释器模式定义一个语言的语法，并提供解释器来处理这个语法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象表达式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Expression</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">interpret</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 终结符表达式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NumberExpression</span>(<span class="title class_ inherited__">Expression</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, number</span>):</span><br><span class="line">        <span class="variable language_">self</span>.number = number</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">interpret</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.number</span><br><span class="line"></span><br><span class="line"><span class="comment"># 非终结符表达式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddExpression</span>(<span class="title class_ inherited__">Expression</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, left, right</span>):</span><br><span class="line">        <span class="variable language_">self</span>.left = left</span><br><span class="line">        <span class="variable language_">self</span>.right = right</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">interpret</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.left.interpret(context) + <span class="variable language_">self</span>.right.interpret(context)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubtractExpression</span>(<span class="title class_ inherited__">Expression</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, left, right</span>):</span><br><span class="line">        <span class="variable language_">self</span>.left = left</span><br><span class="line">        <span class="variable language_">self</span>.right = right</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">interpret</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.left.interpret(context) - <span class="variable language_">self</span>.right.interpret(context)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VariableExpression</span>(<span class="title class_ inherited__">Expression</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">interpret</span>(<span class="params">self, context</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.name <span class="keyword">in</span> context:</span><br><span class="line">            <span class="keyword">return</span> context[<span class="variable language_">self</span>.name]</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_expression_tree</span>():</span><br><span class="line">    <span class="comment"># 表达式: (x + 5) - (y + 2)</span></span><br><span class="line">    <span class="keyword">return</span> SubtractExpression(</span><br><span class="line">        AddExpression(</span><br><span class="line">            VariableExpression(<span class="string">&quot;x&quot;</span>),</span><br><span class="line">            NumberExpression(<span class="number">5</span>)</span><br><span class="line">        ),</span><br><span class="line">        AddExpression(</span><br><span class="line">            VariableExpression(<span class="string">&quot;y&quot;</span>),</span><br><span class="line">            NumberExpression(<span class="number">2</span>)</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">expression = create_expression_tree()</span><br><span class="line">context = &#123;<span class="string">&quot;x&quot;</span>: <span class="number">10</span>, <span class="string">&quot;y&quot;</span>: <span class="number">5</span>&#125;</span><br><span class="line">result = expression.interpret(context)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Result: <span class="subst">&#123;result&#125;</span>&quot;</span>)  <span class="comment"># 输出: Result: 8 (因为 (10 + 5) - (5 + 2) = 8)</span></span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：编译器、正则表达式、SQL解析器、配置解析器</p>
<h3 id="16-迭代器模式-Iterator"><a href="#16-迭代器模式-Iterator" class="headerlink" title="16. 迭代器模式 (Iterator)"></a>16. 迭代器模式 (Iterator)</h3><p>迭代器模式提供一种方法顺序访问一个聚合对象中的各个元素，而不暴露其内部表示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 迭代器接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Iterator</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 集合接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Collection</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_iterator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体迭代器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookIterator</span>(<span class="title class_ inherited__">Iterator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, books</span>):</span><br><span class="line">        <span class="variable language_">self</span>.books = books</span><br><span class="line">        <span class="variable language_">self</span>.position = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.position &lt; <span class="built_in">len</span>(<span class="variable language_">self</span>.books)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.has_next():</span><br><span class="line">            <span class="keyword">raise</span> StopIteration(<span class="string">&quot;No more books&quot;</span>)</span><br><span class="line">        book = <span class="variable language_">self</span>.books[<span class="variable language_">self</span>.position]</span><br><span class="line">        <span class="variable language_">self</span>.position += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> book</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体集合</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Library</span>(<span class="title class_ inherited__">Collection</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.books = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_book</span>(<span class="params">self, book</span>):</span><br><span class="line">        <span class="variable language_">self</span>.books.append(book)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_iterator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> BookIterator(<span class="variable language_">self</span>.books)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Python内置的迭代器协议</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PythonLibrary</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.books = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_book</span>(<span class="params">self, book</span>):</span><br><span class="line">        <span class="variable language_">self</span>.books.append(book)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>(<span class="variable language_">self</span>.books)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">library = Library()</span><br><span class="line">library.add_book(<span class="string">&quot;Design Patterns&quot;</span>)</span><br><span class="line">library.add_book(<span class="string">&quot;Clean Code&quot;</span>)</span><br><span class="line">library.add_book(<span class="string">&quot;Refactoring&quot;</span>)</span><br><span class="line"></span><br><span class="line">iterator = library.create_iterator()</span><br><span class="line"><span class="keyword">while</span> iterator.has_next():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Book: <span class="subst">&#123;iterator.<span class="built_in">next</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Python内置迭代器</span></span><br><span class="line">py_library = PythonLibrary()</span><br><span class="line">py_library.add_book(<span class="string">&quot;Python Cookbook&quot;</span>)</span><br><span class="line">py_library.add_book(<span class="string">&quot;Fluent Python&quot;</span>)</span><br><span class="line">py_library.add_book(<span class="string">&quot;Effective Python&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> book <span class="keyword">in</span> py_library:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Python Book: <span class="subst">&#123;book&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：遍历集合、提供统一访问接口、支持多种遍历方式</p>
<h3 id="17-中介者模式-Mediator"><a href="#17-中介者模式-Mediator" class="headerlink" title="17. 中介者模式 (Mediator)"></a>17. 中介者模式 (Mediator)</h3><p>中介者模式定义一个对象来封装一组对象的交互方式，使这些对象不需要显式地相互引用，从而使其耦合松散。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中介者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mediator</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self, sender, event</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体中介者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatRoom</span>(<span class="title class_ inherited__">Mediator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.users = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register_user</span>(<span class="params">self, user</span>):</span><br><span class="line">        <span class="variable language_">self</span>.users[user.name] = user</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self, sender, event</span>):</span><br><span class="line">        <span class="keyword">if</span> event == <span class="string">&quot;join&quot;</span>:</span><br><span class="line">            <span class="variable language_">self</span>.broadcast(<span class="string">f&quot;<span class="subst">&#123;sender.name&#125;</span> has joined the chat room.&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> event == <span class="string">&quot;leave&quot;</span>:</span><br><span class="line">            <span class="variable language_">self</span>.broadcast(<span class="string">f&quot;<span class="subst">&#123;sender.name&#125;</span> has left the chat room.&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> event.startswith(<span class="string">&quot;message:&quot;</span>):</span><br><span class="line">            message = event[<span class="built_in">len</span>(<span class="string">&quot;message:&quot;</span>):]</span><br><span class="line">            <span class="variable language_">self</span>.broadcast(<span class="string">f&quot;<span class="subst">&#123;sender.name&#125;</span>: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> event.startswith(<span class="string">&quot;private:&quot;</span>):</span><br><span class="line">            parts = event[<span class="built_in">len</span>(<span class="string">&quot;private:&quot;</span>):].split(<span class="string">&quot;:&quot;</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) == <span class="number">2</span>:</span><br><span class="line">                recipient_name, message = parts</span><br><span class="line">                <span class="keyword">if</span> recipient_name <span class="keyword">in</span> <span class="variable language_">self</span>.users:</span><br><span class="line">                    <span class="variable language_">self</span>.users[recipient_name].receive(<span class="string">f&quot;[Private from <span class="subst">&#123;sender.name&#125;</span>]: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">broadcast</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="keyword">for</span> user <span class="keyword">in</span> <span class="variable language_">self</span>.users.values():</span><br><span class="line">            user.receive(message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同事类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, mediator</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.mediator = mediator</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">join</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.mediator.register_user(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="variable language_">self</span>.mediator.notify(<span class="variable language_">self</span>, <span class="string">&quot;join&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">leave</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.mediator.notify(<span class="variable language_">self</span>, <span class="string">&quot;leave&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="variable language_">self</span>.mediator.notify(<span class="variable language_">self</span>, <span class="string">f&quot;message:<span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_private</span>(<span class="params">self, recipient, message</span>):</span><br><span class="line">        <span class="variable language_">self</span>.mediator.notify(<span class="variable language_">self</span>, <span class="string">f&quot;private:<span class="subst">&#123;recipient&#125;</span>:<span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">receive</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;self.name&#125;</span>&#x27;s chat] <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">chat_room = ChatRoom()</span><br><span class="line"></span><br><span class="line">alice = User(<span class="string">&quot;Alice&quot;</span>, chat_room)</span><br><span class="line">bob = User(<span class="string">&quot;Bob&quot;</span>, chat_room)</span><br><span class="line">charlie = User(<span class="string">&quot;Charlie&quot;</span>, chat_room)</span><br><span class="line"></span><br><span class="line">alice.join()</span><br><span class="line">bob.join()</span><br><span class="line">charlie.join()</span><br><span class="line"></span><br><span class="line">alice.send(<span class="string">&quot;Hi everyone!&quot;</span>)</span><br><span class="line">bob.send(<span class="string">&quot;Hey Alice!&quot;</span>)</span><br><span class="line">charlie.send_private(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Can we talk privately?&quot;</span>)</span><br><span class="line">bob.leave()</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：UI组件通信、航空交通管制、聊天应用、多人游戏</p>
<h3 id="18-备忘录模式-Memento"><a href="#18-备忘录模式-Memento" class="headerlink" title="18. 备忘录模式 (Memento)"></a>18. 备忘录模式 (Memento)</h3><p>备忘录模式在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便以后恢复对象到这个状态。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备忘录</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EditorMemento</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, content, selection, cursor_position</span>):</span><br><span class="line">        <span class="variable language_">self</span>.content = content</span><br><span class="line">        <span class="variable language_">self</span>.selection = selection</span><br><span class="line">        <span class="variable language_">self</span>.cursor_position = cursor_position</span><br><span class="line">        <span class="variable language_">self</span>.created_at = time.time()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_saved_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="variable language_">self</span>.content,</span><br><span class="line">            <span class="string">&quot;selection&quot;</span>: <span class="variable language_">self</span>.selection,</span><br><span class="line">            <span class="string">&quot;cursor_position&quot;</span>: <span class="variable language_">self</span>.cursor_position,</span><br><span class="line">            <span class="string">&quot;saved_at&quot;</span>: <span class="variable language_">self</span>.created_at</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 原发器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Editor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.content = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.selection = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.cursor_position = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">type</span>(<span class="params">self, text</span>):</span><br><span class="line">        <span class="comment"># 在光标位置插入文本</span></span><br><span class="line">        <span class="variable language_">self</span>.content = (</span><br><span class="line">            <span class="variable language_">self</span>.content[:<span class="variable language_">self</span>.cursor_position] + </span><br><span class="line">            text + </span><br><span class="line">            <span class="variable language_">self</span>.content[<span class="variable language_">self</span>.cursor_position:]</span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">self</span>.cursor_position += <span class="built_in">len</span>(text)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete_selection</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.selection:</span><br><span class="line">            <span class="variable language_">self</span>.content = <span class="variable language_">self</span>.content.replace(<span class="variable language_">self</span>.selection, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.selection = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">select</span>(<span class="params">self, start, end</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= start &lt; end &lt;= <span class="built_in">len</span>(<span class="variable language_">self</span>.content):</span><br><span class="line">            <span class="variable language_">self</span>.selection = <span class="variable language_">self</span>.content[start:end]</span><br><span class="line">            <span class="variable language_">self</span>.cursor_position = end</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">move_cursor</span>(<span class="params">self, position</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= position &lt;= <span class="built_in">len</span>(<span class="variable language_">self</span>.content):</span><br><span class="line">            <span class="variable language_">self</span>.cursor_position = position</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_memento</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> EditorMemento(</span><br><span class="line">            deepcopy(<span class="variable language_">self</span>.content),</span><br><span class="line">            deepcopy(<span class="variable language_">self</span>.selection),</span><br><span class="line">            <span class="variable language_">self</span>.cursor_position</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">restore_from_memento</span>(<span class="params">self, memento</span>):</span><br><span class="line">        state = memento.get_saved_state()</span><br><span class="line">        <span class="variable language_">self</span>.content = state[<span class="string">&quot;content&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.selection = state[<span class="string">&quot;selection&quot;</span>]</span><br><span class="line">        <span class="variable language_">self</span>.cursor_position = state[<span class="string">&quot;cursor_position&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="variable language_">self</span>.content,</span><br><span class="line">            <span class="string">&quot;selection&quot;</span>: <span class="variable language_">self</span>.selection,</span><br><span class="line">            <span class="string">&quot;cursor_position&quot;</span>: <span class="variable language_">self</span>.cursor_position</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 负责人</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">History</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.mementos = []</span><br><span class="line">        <span class="variable language_">self</span>.current_index = -<span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, memento</span>):</span><br><span class="line">        <span class="comment"># 如果在历史中间进行了修改，清除后面的历史</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.current_index &lt; <span class="built_in">len</span>(<span class="variable language_">self</span>.mementos) - <span class="number">1</span>:</span><br><span class="line">            <span class="variable language_">self</span>.mementos = <span class="variable language_">self</span>.mementos[:<span class="variable language_">self</span>.current_index + <span class="number">1</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.mementos.append(memento)</span><br><span class="line">        <span class="variable language_">self</span>.current_index = <span class="built_in">len</span>(<span class="variable language_">self</span>.mementos) - <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">undo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.current_index &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.current_index -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.mementos[<span class="variable language_">self</span>.current_index]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">redo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.current_index &lt; <span class="built_in">len</span>(<span class="variable language_">self</span>.mementos) - <span class="number">1</span>:</span><br><span class="line">            <span class="variable language_">self</span>.current_index += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.mementos[<span class="variable language_">self</span>.current_index]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">editor = Editor()</span><br><span class="line">history = History()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始状态</span></span><br><span class="line">editor.<span class="built_in">type</span>(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">history.save(editor.create_memento())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Initial: <span class="subst">&#123;editor.get_state()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改1</span></span><br><span class="line">editor.<span class="built_in">type</span>(<span class="string">&quot; World&quot;</span>)</span><br><span class="line">history.save(editor.create_memento())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;After typing: <span class="subst">&#123;editor.get_state()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改2</span></span><br><span class="line">editor.select(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">editor.delete_selection()</span><br><span class="line">editor.<span class="built_in">type</span>(<span class="string">&quot;Hi&quot;</span>)</span><br><span class="line">history.save(editor.create_memento())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;After replace: <span class="subst">&#123;editor.get_state()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 撤销</span></span><br><span class="line">memento = history.undo()</span><br><span class="line"><span class="keyword">if</span> memento:</span><br><span class="line">    editor.restore_from_memento(memento)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;After undo: <span class="subst">&#123;editor.get_state()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次撤销</span></span><br><span class="line">memento = history.undo()</span><br><span class="line"><span class="keyword">if</span> memento:</span><br><span class="line">    editor.restore_from_memento(memento)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;After another undo: <span class="subst">&#123;editor.get_state()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重做</span></span><br><span class="line">memento = history.redo()</span><br><span class="line"><span class="keyword">if</span> memento:</span><br><span class="line">    editor.restore_from_memento(memento)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;After redo: <span class="subst">&#123;editor.get_state()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：撤销&#x2F;重做功能、快照、事务回滚、状态恢复</p>
<h3 id="19-观察者模式-Observer"><a href="#19-观察者模式-Observer" class="headerlink" title="19. 观察者模式 (Observer)"></a>19. 观察者模式 (Observer)</h3><p>观察者模式定义了对象之间的一对多依赖关系，当一个对象状态改变时，它的所有依赖者都会收到通知并自动更新。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主题接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 观察者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, subject</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体主题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherStation</span>(<span class="title class_ inherited__">Subject</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.observers = []</span><br><span class="line">        <span class="variable language_">self</span>._temperature = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>._humidity = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>._pressure = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="keyword">if</span> observer <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.observers:</span><br><span class="line">            <span class="variable language_">self</span>.observers.append(observer)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach</span>(<span class="params">self, observer</span>):</span><br><span class="line">        <span class="keyword">if</span> observer <span class="keyword">in</span> <span class="variable language_">self</span>.observers:</span><br><span class="line">            <span class="variable language_">self</span>.observers.remove(observer)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">notify</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> <span class="variable language_">self</span>.observers:</span><br><span class="line">            observer.update(<span class="variable language_">self</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_measurements</span>(<span class="params">self, temperature, humidity, pressure</span>):</span><br><span class="line">        <span class="variable language_">self</span>._temperature = temperature</span><br><span class="line">        <span class="variable language_">self</span>._humidity = humidity</span><br><span class="line">        <span class="variable language_">self</span>._pressure = pressure</span><br><span class="line">        <span class="variable language_">self</span>.notify()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">temperature</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._temperature</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">humidity</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._humidity</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pressure</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._pressure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体观察者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CurrentConditionsDisplay</span>(<span class="title class_ inherited__">Observer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, subject</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(subject, WeatherStation):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Current conditions: <span class="subst">&#123;subject.temperature&#125;</span>°C, <span class="subst">&#123;subject.humidity&#125;</span>% humidity&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StatisticsDisplay</span>(<span class="title class_ inherited__">Observer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.temperatures = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, subject</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(subject, WeatherStation):</span><br><span class="line">            <span class="variable language_">self</span>.temperatures.append(subject.temperature)</span><br><span class="line">            avg_temp = <span class="built_in">sum</span>(<span class="variable language_">self</span>.temperatures) / <span class="built_in">len</span>(<span class="variable language_">self</span>.temperatures)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Avg/Max/Min temperature: <span class="subst">&#123;avg_temp:<span class="number">.1</span>f&#125;</span>/<span class="subst">&#123;<span class="built_in">max</span>(self.temperatures)&#125;</span>/<span class="subst">&#123;<span class="built_in">min</span>(self.temperatures)&#125;</span>°C&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ForecastDisplay</span>(<span class="title class_ inherited__">Observer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.last_pressure = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, subject</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(subject, WeatherStation):</span><br><span class="line">            current_pressure = subject.pressure</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.last_pressure:</span><br><span class="line">                <span class="keyword">if</span> current_pressure &gt; <span class="variable language_">self</span>.last_pressure:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Forecast: Improving weather on the way!&quot;</span>)</span><br><span class="line">                <span class="keyword">elif</span> current_pressure == <span class="variable language_">self</span>.last_pressure:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Forecast: More of the same&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Forecast: Watch out for cooler, rainy weather&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.last_pressure = current_pressure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">weather_station = WeatherStation()</span><br><span class="line"></span><br><span class="line">current_display = CurrentConditionsDisplay()</span><br><span class="line">statistics_display = StatisticsDisplay()</span><br><span class="line">forecast_display = ForecastDisplay()</span><br><span class="line"></span><br><span class="line">weather_station.attach(current_display)</span><br><span class="line">weather_station.attach(statistics_display)</span><br><span class="line">weather_station.attach(forecast_display)</span><br><span class="line"></span><br><span class="line">weather_station.set_measurements(<span class="number">25</span>, <span class="number">65</span>, <span class="number">1013</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">weather_station.set_measurements(<span class="number">27</span>, <span class="number">70</span>, <span class="number">1014</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">weather_station.set_measurements(<span class="number">23</span>, <span class="number">90</span>, <span class="number">1010</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：事件处理系统、MVC架构、发布-订阅系统、消息队列</p>
<h3 id="20-状态模式-State"><a href="#20-状态模式-State" class="headerlink" title="20. 状态模式 (State)"></a>20. 状态模式 (State)</h3><p>状态模式允许对象在内部状态改变时改变它的行为，对象看起来好像修改了它的类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 状态接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eject_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">turn_crank</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispense</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GumballMachine</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, count</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sold_out_state = SoldOutState(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="variable language_">self</span>.no_coin_state = NoCoinState(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="variable language_">self</span>.has_coin_state = HasCoinState(<span class="variable language_">self</span>)</span><br><span class="line">        <span class="variable language_">self</span>.sold_state = SoldState(<span class="variable language_">self</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.count = count</span><br><span class="line">        <span class="variable language_">self</span>.state = <span class="variable language_">self</span>.sold_out_state <span class="keyword">if</span> count == <span class="number">0</span> <span class="keyword">else</span> <span class="variable language_">self</span>.no_coin_state</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.state.insert_coin()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eject_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.state.eject_coin()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">turn_crank</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.state.turn_crank()</span><br><span class="line">        <span class="variable language_">self</span>.state.dispense()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">release_ball</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.count &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;A gumball comes rolling out...&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.count -= <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_state</span>(<span class="params">self, state</span>):</span><br><span class="line">        <span class="variable language_">self</span>.state = state</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_count</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.count</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_sold_out_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.sold_out_state</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_no_coin_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.no_coin_state</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_has_coin_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.has_coin_state</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_sold_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.sold_state</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SoldOutState</span>(<span class="title class_ inherited__">State</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, gumball_machine</span>):</span><br><span class="line">        <span class="variable language_">self</span>.gumball_machine = gumball_machine</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You can&#x27;t insert a coin, the machine is sold out&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eject_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You can&#x27;t eject, you haven&#x27;t inserted a coin yet&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">turn_crank</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You turned, but there are no gumballs&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispense</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No gumball dispensed&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoCoinState</span>(<span class="title class_ inherited__">State</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, gumball_machine</span>):</span><br><span class="line">        <span class="variable language_">self</span>.gumball_machine = gumball_machine</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You inserted a coin&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.gumball_machine.set_state(<span class="variable language_">self</span>.gumball_machine.get_has_coin_state())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eject_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You haven&#x27;t inserted a coin&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">turn_crank</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You turned, but there&#x27;s no coin&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispense</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You need to pay first&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HasCoinState</span>(<span class="title class_ inherited__">State</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, gumball_machine</span>):</span><br><span class="line">        <span class="variable language_">self</span>.gumball_machine = gumball_machine</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You can&#x27;t insert another coin&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eject_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Coin returned&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.gumball_machine.set_state(<span class="variable language_">self</span>.gumball_machine.get_no_coin_state())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">turn_crank</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You turned...&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.gumball_machine.set_state(<span class="variable language_">self</span>.gumball_machine.get_sold_state())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispense</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;No gumball dispensed&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SoldState</span>(<span class="title class_ inherited__">State</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, gumball_machine</span>):</span><br><span class="line">        <span class="variable language_">self</span>.gumball_machine = gumball_machine</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please wait, we&#x27;re already giving you a gumball&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">eject_coin</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Sorry, you already turned the crank&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">turn_crank</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Turning twice doesn&#x27;t get you another gumball!&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispense</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.gumball_machine.release_ball()</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.gumball_machine.get_count() &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.gumball_machine.set_state(<span class="variable language_">self</span>.gumball_machine.get_no_coin_state())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Oops, out of gumballs!&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.gumball_machine.set_state(<span class="variable language_">self</span>.gumball_machine.get_sold_out_state())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">gumball_machine = GumballMachine(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Gumball machine has <span class="subst">&#123;gumball_machine.get_count()&#125;</span> gumballs&quot;</span>)</span><br><span class="line"></span><br><span class="line">gumball_machine.insert_coin()</span><br><span class="line">gumball_machine.turn_crank()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Gumball machine has <span class="subst">&#123;gumball_machine.get_count()&#125;</span> gumballs&quot;</span>)</span><br><span class="line"></span><br><span class="line">gumball_machine.insert_coin()</span><br><span class="line">gumball_machine.eject_coin()</span><br><span class="line">gumball_machine.turn_crank()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Gumball machine has <span class="subst">&#123;gumball_machine.get_count()&#125;</span> gumballs&quot;</span>)</span><br><span class="line"></span><br><span class="line">gumball_machine.insert_coin()</span><br><span class="line">gumball_machine.turn_crank()</span><br><span class="line">gumball_machine.insert_coin()</span><br><span class="line">gumball_machine.turn_crank()</span><br><span class="line">gumball_machine.eject_coin()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Gumball machine has <span class="subst">&#123;gumball_machine.get_count()&#125;</span> gumballs&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：工作流、游戏状态、UI状态管理、订单处理</p>
<h3 id="21-策略模式-Strategy"><a href="#21-策略模式-Strategy" class="headerlink" title="21. 策略模式 (Strategy)"></a>21. 策略模式 (Strategy)</h3><p>策略模式定义了一系列算法，并将每个算法封装起来，使它们可以互换使用，算法的变化不会影响使用算法的客户。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 策略接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentStrategy</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pay</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体策略</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCardPayment</span>(<span class="title class_ inherited__">PaymentStrategy</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, card_number, name, expiry, cvv</span>):</span><br><span class="line">        <span class="variable language_">self</span>.card_number = card_number</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.expiry = expiry</span><br><span class="line">        <span class="variable language_">self</span>.cvv = cvv</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pay</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Paying $<span class="subst">&#123;amount&#125;</span> using Credit Card <span class="subst">&#123;self.card_number[-<span class="number">4</span>:]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PayPalPayment</span>(<span class="title class_ inherited__">PaymentStrategy</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, email, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.email = email</span><br><span class="line">        <span class="variable language_">self</span>.password = password</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pay</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Paying $<span class="subst">&#123;amount&#125;</span> using PayPal account <span class="subst">&#123;self.email&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BankTransferPayment</span>(<span class="title class_ inherited__">PaymentStrategy</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, account_number, bank_code</span>):</span><br><span class="line">        <span class="variable language_">self</span>.account_number = account_number</span><br><span class="line">        <span class="variable language_">self</span>.bank_code = bank_code</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pay</span>(<span class="params">self, amount</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Paying $<span class="subst">&#123;amount&#125;</span> using Bank Transfer from account <span class="subst">&#123;self.account_number&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCart</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.items = []</span><br><span class="line">        <span class="variable language_">self</span>.payment_strategy = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_item</span>(<span class="params">self, item, price, quantity</span>):</span><br><span class="line">        <span class="variable language_">self</span>.items.append(&#123;<span class="string">&quot;item&quot;</span>: item, <span class="string">&quot;price&quot;</span>: price, <span class="string">&quot;quantity&quot;</span>: quantity&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_total</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(item[<span class="string">&quot;price&quot;</span>] * item[<span class="string">&quot;quantity&quot;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> <span class="variable language_">self</span>.items)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_payment_strategy</span>(<span class="params">self, payment_strategy</span>):</span><br><span class="line">        <span class="variable language_">self</span>.payment_strategy = payment_strategy</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkout</span>(<span class="params">self</span>):</span><br><span class="line">        total = <span class="variable language_">self</span>.calculate_total()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.payment_strategy:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;No payment strategy set&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.payment_strategy.pay(total):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Payment of $<span class="subst">&#123;total&#125;</span> successful&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.items = []  <span class="comment"># Clear cart after successful payment</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Payment failed&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">cart = ShoppingCart()</span><br><span class="line">cart.add_item(<span class="string">&quot;Laptop&quot;</span>, <span class="number">1200</span>, <span class="number">1</span>)</span><br><span class="line">cart.add_item(<span class="string">&quot;Mouse&quot;</span>, <span class="number">25</span>, <span class="number">2</span>)</span><br><span class="line">cart.add_item(<span class="string">&quot;Keyboard&quot;</span>, <span class="number">45</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Items in cart:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cart.items:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;item[<span class="string">&#x27;item&#x27;</span>]&#125;</span> - $<span class="subst">&#123;item[<span class="string">&#x27;price&#x27;</span>]&#125;</span> x <span class="subst">&#123;item[<span class="string">&#x27;quantity&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Total: $<span class="subst">&#123;cart.calculate_total()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用信用卡支付</span></span><br><span class="line">credit_card = CreditCardPayment(<span class="string">&quot;1234567890123456&quot;</span>, <span class="string">&quot;John Doe&quot;</span>, <span class="string">&quot;12/25&quot;</span>, <span class="string">&quot;123&quot;</span>)</span><br><span class="line">cart.set_payment_strategy(credit_card)</span><br><span class="line">cart.checkout()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加新商品并使用PayPal支付</span></span><br><span class="line">cart.add_item(<span class="string">&quot;Headphones&quot;</span>, <span class="number">75</span>, <span class="number">1</span>)</span><br><span class="line">paypal = PayPalPayment(<span class="string">&quot;john.doe@example.com&quot;</span>, <span class="string">&quot;password&quot;</span>)</span><br><span class="line">cart.set_payment_strategy(paypal)</span><br><span class="line">cart.checkout()</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：支付方式选择、排序算法选择、压缩算法选择、验证策略</p>
<h3 id="22-模板方法模式-Template-Method"><a href="#22-模板方法模式-Template-Method" class="headerlink" title="22. 模板方法模式 (Template Method)"></a>22. 模板方法模式 (Template Method)</h3><p>模板方法模式定义了一个算法的骨架，将一些步骤延迟到子类中实现。模板方法使得子类可以在不改变算法结构的情况下，重新定义算法中的某些步骤。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataProcessor</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;模板方法&quot;&quot;&quot;</span></span><br><span class="line">        data = <span class="variable language_">self</span>.read_data(file_path)</span><br><span class="line">        processed_data = <span class="variable language_">self</span>.process_data(data)</span><br><span class="line">        <span class="variable language_">self</span>.save_data(processed_data)</span><br><span class="line">        <span class="variable language_">self</span>.send_notification()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_data</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;读取数据 - 由子类实现&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_data</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;处理数据 - 由子类实现&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_data</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;保存数据 - 可选重写&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Saving processed data: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_notification</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;发送通知 - 钩子方法&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CSVProcessor</span>(<span class="title class_ inherited__">DataProcessor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_data</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Reading CSV data from <span class="subst">&#123;file_path&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 实际应用中会读取CSV文件</span></span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">25</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_data</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Processing CSV data&quot;</span>)</span><br><span class="line">        <span class="comment"># 处理数据，例如计算平均年龄</span></span><br><span class="line">        avg_age = <span class="built_in">sum</span>(item[<span class="string">&quot;age&quot;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> data) / <span class="built_in">len</span>(data)</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;records&quot;</span>: <span class="built_in">len</span>(data), <span class="string">&quot;average_age&quot;</span>: avg_age&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_notification</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;CSV processing completed, sending email notification&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JSONProcessor</span>(<span class="title class_ inherited__">DataProcessor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_data</span>(<span class="params">self, file_path</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Reading JSON data from <span class="subst">&#123;file_path&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 实际应用中会读取JSON文件</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;users&quot;</span>: [</span><br><span class="line">                &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Charlie&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">35</span>&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Diana&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">28</span>&#125;,</span><br><span class="line">                &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Eve&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">22</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_data</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Processing JSON data&quot;</span>)</span><br><span class="line">        users = data[<span class="string">&quot;users&quot;</span>]</span><br><span class="line">        <span class="comment"># 处理数据，例如筛选年龄大于30的用户</span></span><br><span class="line">        older_users = [user <span class="keyword">for</span> user <span class="keyword">in</span> users <span class="keyword">if</span> user[<span class="string">&quot;age&quot;</span>] &gt; <span class="number">30</span>]</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;older_users&quot;</span>: older_users, <span class="string">&quot;count&quot;</span>: <span class="built_in">len</span>(older_users)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">csv_processor = CSVProcessor()</span><br><span class="line">csv_processor.process(<span class="string">&quot;data.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n---\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">json_processor = JSONProcessor()</span><br><span class="line">json_processor.process(<span class="string">&quot;data.json&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：框架设计、算法骨架定义、批处理流程</p>
<h3 id="23-访问者模式-Visitor"><a href="#23-访问者模式-Visitor" class="headerlink" title="23. 访问者模式 (Visitor)"></a>23. 访问者模式 (Visitor)</h3><p>访问者模式表示一个作用于某对象结构中的各元素的操作，它使你可以在不改变各元素类的前提下定义作用于这些元素的新操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Visitor</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_circle</span>(<span class="params">self, circle</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_rectangle</span>(<span class="params">self, rectangle</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_triangle</span>(<span class="params">self, triangle</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 元素接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">self, visitor</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体元素</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, radius</span>):</span><br><span class="line">        <span class="variable language_">self</span>.radius = radius</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">self, visitor</span>):</span><br><span class="line">        <span class="keyword">return</span> visitor.visit_circle(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, width, height</span>):</span><br><span class="line">        <span class="variable language_">self</span>.width = width</span><br><span class="line">        <span class="variable language_">self</span>.height = height</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">self, visitor</span>):</span><br><span class="line">        <span class="keyword">return</span> visitor.visit_rectangle(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Triangle</span>(<span class="title class_ inherited__">Shape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base, height</span>):</span><br><span class="line">        <span class="variable language_">self</span>.base = base</span><br><span class="line">        <span class="variable language_">self</span>.height = height</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">accept</span>(<span class="params">self, visitor</span>):</span><br><span class="line">        <span class="keyword">return</span> visitor.visit_triangle(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体访问者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AreaCalculator</span>(<span class="title class_ inherited__">Visitor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_circle</span>(<span class="params">self, circle</span>):</span><br><span class="line">        <span class="keyword">import</span> math</span><br><span class="line">        <span class="keyword">return</span> math.pi * circle.radius ** <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_rectangle</span>(<span class="params">self, rectangle</span>):</span><br><span class="line">        <span class="keyword">return</span> rectangle.width * rectangle.height</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_triangle</span>(<span class="params">self, triangle</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.5</span> * triangle.base * triangle.height</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PerimeterCalculator</span>(<span class="title class_ inherited__">Visitor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_circle</span>(<span class="params">self, circle</span>):</span><br><span class="line">        <span class="keyword">import</span> math</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * math.pi * circle.radius</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_rectangle</span>(<span class="params">self, rectangle</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * (rectangle.width + rectangle.height)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_triangle</span>(<span class="params">self, triangle</span>):</span><br><span class="line">        <span class="comment"># 简化：假设是等腰三角形</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * triangle.height + triangle.base</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShapeRenderer</span>(<span class="title class_ inherited__">Visitor</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_circle</span>(<span class="params">self, circle</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Rendering circle with radius <span class="subst">&#123;circle.radius&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_rectangle</span>(<span class="params">self, rectangle</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Rendering rectangle with width <span class="subst">&#123;rectangle.width&#125;</span> and height <span class="subst">&#123;rectangle.height&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_triangle</span>(<span class="params">self, triangle</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Rendering triangle with base <span class="subst">&#123;triangle.base&#125;</span> and height <span class="subst">&#123;triangle.height&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">shapes = [</span><br><span class="line">    Circle(<span class="number">5</span>),</span><br><span class="line">    Rectangle(<span class="number">4</span>, <span class="number">6</span>),</span><br><span class="line">    Triangle(<span class="number">3</span>, <span class="number">8</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">area_calculator =</span><br><span class="line">---</span><br><span class="line">title: Python设计模式实战：<span class="number">23</span>种经典模式的Python实现</span><br><span class="line">date: <span class="number">2023</span>-01-08 <span class="number">13</span>:<span class="number">20</span>:<span class="number">00</span></span><br><span class="line">categories: python</span><br><span class="line">tags: [设计模式, 面向对象, 代码架构, 软件工程]</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python设计模式实战：23种经典模式的Python实现</span></span><br><span class="line"></span><br><span class="line">作为一名Python开发者，掌握设计模式对于编写高质量、可维护的代码至关重要。设计模式是软件开发中常见问题的可重用解决方案，它们可以帮助我们创建更灵活、更易于维护的代码。在这篇文章中，我将分享如何在Python中实现<span class="number">23</span>种经典的设计模式，并探讨它们的实际应用场景。</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设计模式简介</span></span><br><span class="line"></span><br><span class="line">设计模式通常分为三大类：</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> **创建型模式**：处理对象创建机制</span><br><span class="line"><span class="number">2.</span> **结构型模式**：关注类和对象的组合</span><br><span class="line"><span class="number">3.</span> **行为型模式**：关注对象之间的通信</span><br><span class="line"></span><br><span class="line">让我们逐一探讨这些模式在Python中的实现。</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建型模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 1. 单例模式 (Singleton)</span></span><br><span class="line"></span><br><span class="line">单例模式确保一个类只有一个实例，并提供一个全局访问点。</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用装饰器实现</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">singleton</span>(<span class="params">cls</span>):</span><br><span class="line">    instances = &#123;&#125;</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_instance</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instances:</span><br><span class="line">            instances[cls] = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> instances[cls]</span><br><span class="line">    <span class="keyword">return</span> get_instance</span><br><span class="line"></span><br><span class="line"><span class="meta">@singleton</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.log_file = <span class="string">&quot;app.log&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.log_file, <span class="string">&quot;a&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="string">f&quot;<span class="subst">&#123;message&#125;</span>\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：数据库连接、日志记录器、配置管理器</p>
<h3 id="2-工厂方法模式-Factory-Method-1"><a href="#2-工厂方法模式-Factory-Method-1" class="headerlink" title="2. 工厂方法模式 (Factory Method)"></a>2. 工厂方法模式 (Factory Method)</h3><p>工厂方法模式定义了一个创建对象的接口，但让子类决定实例化哪个类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产品接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Woof!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Meow!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnimalFactory</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_animal</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">make_sound</span>(<span class="params">self</span>):</span><br><span class="line">        animal = <span class="variable language_">self</span>.create_animal()</span><br><span class="line">        <span class="keyword">return</span> animal.speak()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体创建者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DogFactory</span>(<span class="title class_ inherited__">AnimalFactory</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_animal</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> Dog()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CatFactory</span>(<span class="title class_ inherited__">AnimalFactory</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_animal</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> Cat()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pet</span>(<span class="params">factory</span>):</span><br><span class="line">    <span class="keyword">return</span> factory.make_sound()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line"><span class="built_in">print</span>(get_pet(DogFactory()))  <span class="comment"># 输出: Woof!</span></span><br><span class="line"><span class="built_in">print</span>(get_pet(CatFactory()))  <span class="comment"># 输出: Meow!</span></span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：插件系统、框架扩展点、多平台应用</p>
<h3 id="3-抽象工厂模式-Abstract-Factory-1"><a href="#3-抽象工厂模式-Abstract-Factory-1" class="headerlink" title="3. 抽象工厂模式 (Abstract Factory)"></a>3. 抽象工厂模式 (Abstract Factory)</h3><p>抽象工厂模式提供一个接口来创建相关或依赖对象的家族，而不指定它们的具体类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Checkbox</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindowsButton</span>(<span class="title class_ inherited__">Button</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Rendering a Windows button&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacOSButton</span>(<span class="title class_ inherited__">Button</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Rendering a MacOS button&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindowsCheckbox</span>(<span class="title class_ inherited__">Checkbox</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Rendering a Windows checkbox&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacOSCheckbox</span>(<span class="title class_ inherited__">Checkbox</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Rendering a MacOS checkbox&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GUIFactory</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_button</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_checkbox</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WindowsFactory</span>(<span class="title class_ inherited__">GUIFactory</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_button</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> WindowsButton()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_checkbox</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> WindowsCheckbox()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MacOSFactory</span>(<span class="title class_ inherited__">GUIFactory</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_button</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> MacOSButton()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_checkbox</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> MacOSCheckbox()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Application</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, factory</span>):</span><br><span class="line">        <span class="variable language_">self</span>.factory = factory</span><br><span class="line">        <span class="variable language_">self</span>.button = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.checkbox = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_ui</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.button = <span class="variable language_">self</span>.factory.create_button()</span><br><span class="line">        <span class="variable language_">self</span>.checkbox = <span class="variable language_">self</span>.factory.create_checkbox()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">paint</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.button.paint()&#125;</span> and <span class="subst">&#123;self.checkbox.paint()&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据操作系统选择工厂</span></span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">if</span> platform.system() == <span class="string">&quot;Windows&quot;</span>:</span><br><span class="line">    factory = WindowsFactory()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    factory = MacOSFactory()</span><br><span class="line"></span><br><span class="line">app = Application(factory)</span><br><span class="line">app.create_ui()</span><br><span class="line"><span class="built_in">print</span>(app.paint())</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：跨平台UI库、多数据库支持的ORM、不同风格的UI主题</p>
<h3 id="4-建造者模式-Builder-1"><a href="#4-建造者模式-Builder-1" class="headerlink" title="4. 建造者模式 (Builder)"></a>4. 建造者模式 (Builder)</h3><p>建造者模式将复杂对象的构建与其表示分离，使同样的构建过程可以创建不同的表示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.cpu = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.ram = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.storage = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.gpu = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Computer [CPU: <span class="subst">&#123;self.cpu&#125;</span>, RAM: <span class="subst">&#123;self.ram&#125;</span>GB, Storage: <span class="subst">&#123;self.storage&#125;</span>GB, GPU: <span class="subst">&#123;self.gpu&#125;</span>]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerBuilder</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer = Computer()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_cpu</span>(<span class="params">self, cpu</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer.cpu = cpu</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_ram</span>(<span class="params">self, ram</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer.ram = ram</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_storage</span>(<span class="params">self, storage</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer.storage = storage</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_gpu</span>(<span class="params">self, gpu</span>):</span><br><span class="line">        <span class="variable language_">self</span>.computer.gpu = gpu</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.computer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Director</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, builder</span>):</span><br><span class="line">        <span class="variable language_">self</span>.builder = builder</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_gaming_pc</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.builder.configure_cpu(<span class="string">&quot;Intel i9&quot;</span>) \</span><br><span class="line">                          .configure_ram(<span class="number">32</span>) \</span><br><span class="line">                          .configure_storage(<span class="number">1000</span>) \</span><br><span class="line">                          .configure_gpu(<span class="string">&quot;NVIDIA RTX 3080&quot;</span>) \</span><br><span class="line">                          .build()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">build_office_pc</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.builder.configure_cpu(<span class="string">&quot;Intel i5&quot;</span>) \</span><br><span class="line">                          .configure_ram(<span class="number">16</span>) \</span><br><span class="line">                          .configure_storage(<span class="number">512</span>) \</span><br><span class="line">                          .configure_gpu(<span class="string">&quot;Integrated&quot;</span>) \</span><br><span class="line">                          .build()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">builder = ComputerBuilder()</span><br><span class="line">director = Director(builder)</span><br><span class="line"></span><br><span class="line">gaming_pc = director.build_gaming_pc()</span><br><span class="line"><span class="built_in">print</span>(gaming_pc)</span><br><span class="line"></span><br><span class="line">office_pc = director.build_office_pc()</span><br><span class="line"><span class="built_in">print</span>(office_pc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接使用建造者（不使用指导者）</span></span><br><span class="line">custom_pc = ComputerBuilder() \</span><br><span class="line">    .configure_cpu(<span class="string">&quot;AMD Ryzen 7&quot;</span>) \</span><br><span class="line">    .configure_ram(<span class="number">64</span>) \</span><br><span class="line">    .configure_storage(<span class="number">2000</span>) \</span><br><span class="line">    .configure_gpu(<span class="string">&quot;AMD Radeon&quot;</span>) \</span><br><span class="line">    .build()</span><br><span class="line"><span class="built_in">print</span>(custom_pc)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：复杂对象创建、配置对象、对象有多种表示形式</p>
<h3 id="5-原型模式-Prototype-1"><a href="#5-原型模式-Prototype-1" class="headerlink" title="5. 原型模式 (Prototype)"></a>5. 原型模式 (Prototype)</h3><p>原型模式通过复制现有对象来创建新对象，而不是通过实例化类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Prototype</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">clone</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> copy.deepcopy(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Document</span>(<span class="title class_ inherited__">Prototype</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, content, styles</span>):</span><br><span class="line">        <span class="variable language_">self</span>.content = content</span><br><span class="line">        <span class="variable language_">self</span>.styles = styles</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Document [Content: <span class="subst">&#123;self.content&#125;</span>, Styles: <span class="subst">&#123;self.styles&#125;</span>]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">original = Document(<span class="string">&quot;Hello, World!&quot;</span>, &#123;<span class="string">&quot;font&quot;</span>: <span class="string">&quot;Arial&quot;</span>, <span class="string">&quot;size&quot;</span>: <span class="number">12</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Original: <span class="subst">&#123;original&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 克隆并修改</span></span><br><span class="line">clone = original.clone()</span><br><span class="line">clone.content = <span class="string">&quot;Hello, Python!&quot;</span></span><br><span class="line">clone.styles[<span class="string">&quot;size&quot;</span>] = <span class="number">14</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Clone: <span class="subst">&#123;clone&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Original after cloning: <span class="subst">&#123;original&#125;</span>&quot;</span>)  <span class="comment"># 原对象不受影响</span></span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：对象初始化成本高、需要保存对象状态作为历史记录、复制复杂对象</p>
<h2 id="结构型模式-1"><a href="#结构型模式-1" class="headerlink" title="结构型模式"></a>结构型模式</h2><h3 id="6-适配器模式-Adapter-1"><a href="#6-适配器模式-Adapter-1" class="headerlink" title="6. 适配器模式 (Adapter)"></a>6. 适配器模式 (Adapter)</h3><p>适配器模式允许接口不兼容的类一起工作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 目标接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Target</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Target: The default target&#x27;s behavior.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要适配的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adaptee</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">specific_request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Adaptee: Special behavior.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象适配器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Adapter</span>(<span class="title class_ inherited__">Target</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, adaptee</span>):</span><br><span class="line">        <span class="variable language_">self</span>.adaptee = adaptee</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Adapter: (TRANSLATED) <span class="subst">&#123;self.adaptee.specific_request()&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">target</span>):</span><br><span class="line">    <span class="keyword">return</span> target.request()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">adaptee = Adaptee()</span><br><span class="line">adapter = Adapter(adaptee)</span><br><span class="line"><span class="built_in">print</span>(client_code(adapter))</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：集成第三方库、兼容旧API、数据格式转换</p>
<h3 id="7-桥接模式-Bridge-1"><a href="#7-桥接模式-Bridge-1" class="headerlink" title="7. 桥接模式 (Bridge)"></a>7. 桥接模式 (Bridge)</h3><p>桥接模式将抽象部分与其实现部分分离，使它们可以独立变化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实现部分接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Device</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_enabled</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_volume</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_volume</span>(<span class="params">self, volume</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TV</span>(<span class="title class_ inherited__">Device</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.volume = <span class="number">30</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_enabled</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.enabled</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_volume</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.volume</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_volume</span>(<span class="params">self, volume</span>):</span><br><span class="line">        <span class="keyword">if</span> volume &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = <span class="number">100</span></span><br><span class="line">        <span class="keyword">elif</span> volume &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = volume</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Radio</span>(<span class="title class_ inherited__">Device</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>.volume = <span class="number">20</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_enabled</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.enabled</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disable</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.enabled = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_volume</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.volume</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_volume</span>(<span class="params">self, volume</span>):</span><br><span class="line">        <span class="keyword">if</span> volume &gt; <span class="number">100</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = <span class="number">100</span></span><br><span class="line">        <span class="keyword">elif</span> volume &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.volume = volume</span><br><span class="line"></span><br><span class="line"><span class="comment"># 抽象部分</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteControl</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, device</span>):</span><br><span class="line">        <span class="variable language_">self</span>.device = device</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">toggle_power</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.device.is_enabled():</span><br><span class="line">            <span class="variable language_">self</span>.device.disable()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.device.enable()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">volume_up</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.device.set_volume(<span class="variable language_">self</span>.device.get_volume() + <span class="number">10</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">volume_down</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.device.set_volume(<span class="variable language_">self</span>.device.get_volume() - <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩展抽象部分</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdvancedRemoteControl</span>(<span class="title class_ inherited__">RemoteControl</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.device.set_volume(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">tv = TV()</span><br><span class="line">remote = RemoteControl(tv)</span><br><span class="line">remote.toggle_power()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;TV is <span class="subst">&#123;<span class="string">&#x27;on&#x27;</span> <span class="keyword">if</span> tv.is_enabled() <span class="keyword">else</span> <span class="string">&#x27;off&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line">remote.volume_up()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;TV volume: <span class="subst">&#123;tv.get_volume()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">radio = Radio()</span><br><span class="line">advanced_remote = AdvancedRemoteControl(radio)</span><br><span class="line">advanced_remote.toggle_power()</span><br><span class="line">advanced_remote.volume_up()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Radio is <span class="subst">&#123;<span class="string">&#x27;on&#x27;</span> <span class="keyword">if</span> radio.is_enabled() <span class="keyword">else</span> <span class="string">&#x27;off&#x27;</span>&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Radio volume: <span class="subst">&#123;radio.get_volume()&#125;</span>&quot;</span>)</span><br><span class="line">advanced_remote.mute()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Radio volume after mute: <span class="subst">&#123;radio.get_volume()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：跨平台应用、支持多种数据库的应用、多种渲染引擎的图形应用</p>
<h3 id="8-组合模式-Composite-1"><a href="#8-组合模式-Composite-1" class="headerlink" title="8. 组合模式 (Composite)"></a>8. 组合模式 (Composite)</h3><p>组合模式将对象组合成树形结构以表示”部分-整体”的层次结构。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组件接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Component</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">self, indent=<span class="number">0</span></span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 叶节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">File</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, size</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        <span class="variable language_">self</span>.size = size</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">self, indent=<span class="number">0</span></span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot; &quot;</span> * indent + <span class="string">f&quot;- File: <span class="subst">&#123;self.name&#125;</span> (<span class="subst">&#123;self.size&#125;</span> KB)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复合节点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Directory</span>(<span class="title class_ inherited__">Component</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        <span class="variable language_">self</span>.children = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, component</span>):</span><br><span class="line">        <span class="variable language_">self</span>.children.append(component)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">self, component</span>):</span><br><span class="line">        <span class="variable language_">self</span>.children.remove(component)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">self, indent=<span class="number">0</span></span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot; &quot;</span> * indent + <span class="string">f&quot;+ Directory: <span class="subst">&#123;self.name&#125;</span> (<span class="subst">&#123;self.get_size()&#125;</span> KB)&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> child <span class="keyword">in</span> <span class="variable language_">self</span>.children:</span><br><span class="line">            child.display(indent + <span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(child.get_size() <span class="keyword">for</span> child <span class="keyword">in</span> <span class="variable language_">self</span>.children)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">root = Directory(<span class="string">&quot;root&quot;</span>)</span><br><span class="line"></span><br><span class="line">documents = Directory(<span class="string">&quot;documents&quot;</span>)</span><br><span class="line">documents.add(File(<span class="string">&quot;resume.pdf&quot;</span>, <span class="number">1024</span>))</span><br><span class="line">documents.add(File(<span class="string">&quot;cover_letter.docx&quot;</span>, <span class="number">512</span>))</span><br><span class="line"></span><br><span class="line">pictures = Directory(<span class="string">&quot;pictures&quot;</span>)</span><br><span class="line">pictures.add(File(<span class="string">&quot;vacation.jpg&quot;</span>, <span class="number">2048</span>))</span><br><span class="line">pictures.add(File(<span class="string">&quot;family.jpg&quot;</span>, <span class="number">1536</span>))</span><br><span class="line"></span><br><span class="line">root.add(documents).add(pictures).add(File(<span class="string">&quot;notes.txt&quot;</span>, <span class="number">128</span>))</span><br><span class="line"></span><br><span class="line">root.display()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Total size: <span class="subst">&#123;root.get_size()&#125;</span> KB&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：文件系统、图形界面组件、组织结构</p>
<h3 id="9-装饰器模式-Decorator-1"><a href="#9-装饰器模式-Decorator-1" class="headerlink" title="9. 装饰器模式 (Decorator)"></a>9. 装饰器模式 (Decorator)</h3><p>装饰器模式动态地给对象添加额外的职责，是子类化的灵活替代方案。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组件接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Coffee</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleCoffee</span>(<span class="title class_ inherited__">Coffee</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Simple coffee&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CoffeeDecorator</span>(<span class="title class_ inherited__">Coffee</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, coffee</span>):</span><br><span class="line">        <span class="variable language_">self</span>.coffee = coffee</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.cost()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.description()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MilkDecorator</span>(<span class="title class_ inherited__">CoffeeDecorator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.cost() + <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.description() + <span class="string">&quot;, with milk&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SugarDecorator</span>(<span class="title class_ inherited__">CoffeeDecorator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.cost() + <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.description() + <span class="string">&quot;, with sugar&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WhippedCreamDecorator</span>(<span class="title class_ inherited__">CoffeeDecorator</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cost</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.cost() + <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">description</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.coffee.description() + <span class="string">&quot;, with whipped cream&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">coffee = SimpleCoffee()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;coffee.description()&#125;</span>: $<span class="subst">&#123;coffee.cost()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">coffee_with_milk = MilkDecorator(coffee)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;coffee_with_milk.description()&#125;</span>: $<span class="subst">&#123;coffee_with_milk.cost()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">coffee_with_milk_and_sugar = SugarDecorator(coffee_with_milk)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;coffee_with_milk_and_sugar.description()&#125;</span>: $<span class="subst">&#123;coffee_with_milk_and_sugar.cost()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">deluxe_coffee = WhippedCreamDecorator(SugarDecorator(MilkDecorator(SimpleCoffee())))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;deluxe_coffee.description()&#125;</span>: $<span class="subst">&#123;deluxe_coffee.cost()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：添加功能到对象而不修改其代码、动态组合功能、Python的装饰器语法</p>
<h3 id="10-外观模式-Facade-1"><a href="#10-外观模式-Facade-1" class="headerlink" title="10. 外观模式 (Facade)"></a>10. 外观模式 (Facade)</h3><p>外观模式为子系统中的一组接口提供一个统一的高层接口，使子系统更容易使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复杂子系统</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CPU</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">freeze</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CPU: Freezing processor.&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">jump</span>(<span class="params">self, address</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;CPU: Jumping to <span class="subst">&#123;address&#125;</span>.&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CPU: Executing commands.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Memory</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">self, address, data</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Memory: Loading data &#x27;<span class="subst">&#123;data&#125;</span>&#x27; to address <span class="subst">&#123;address&#125;</span>.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HardDrive</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">self, sector, size</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;HardDrive: Reading <span class="subst">&#123;size&#125;</span> bytes from sector <span class="subst">&#123;sector&#125;</span>.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 外观</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerFacade</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.cpu = CPU()</span><br><span class="line">        <span class="variable language_">self</span>.memory = Memory()</span><br><span class="line">        <span class="variable language_">self</span>.hard_drive = HardDrive()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        steps = [</span><br><span class="line">            <span class="variable language_">self</span>.cpu.freeze(),</span><br><span class="line">            <span class="variable language_">self</span>.memory.load(<span class="number">0</span>, <span class="string">&quot;boot data&quot;</span>),</span><br><span class="line">            <span class="variable language_">self</span>.cpu.jump(<span class="number">0</span>),</span><br><span class="line">            <span class="variable language_">self</span>.cpu.execute()</span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(steps) + <span class="string">&quot;\nComputer started successfully.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line">computer = ComputerFacade()</span><br><span class="line"><span class="built_in">print</span>(computer.start())</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：简化复杂库的使用、提供统一接口、封装遗留系统</p>
<h3 id="11-享元模式-Flyweight-1"><a href="#11-享元模式-Flyweight-1" class="headerlink" title="11. 享元模式 (Flyweight)"></a>11. 享元模式 (Flyweight)</h3><p>享元模式通过共享尽可能多的相似对象来最小化内存使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 享元工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeFactory</span>:</span><br><span class="line">    _tree_types = &#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_tree_type</span>(<span class="params">cls, name, color, texture</span>):</span><br><span class="line">        key = <span class="string">f&quot;<span class="subst">&#123;name&#125;</span>_<span class="subst">&#123;color&#125;</span>_<span class="subst">&#123;texture&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> cls._tree_types:</span><br><span class="line">            cls._tree_types[key] = TreeType(name, color, texture)</span><br><span class="line">        <span class="keyword">return</span> cls._tree_types[key]</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tree_types_count</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(cls._tree_types)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 享元（内在状态）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeType</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, color, texture</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.color = color</span><br><span class="line">        <span class="variable language_">self</span>.texture = texture</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Rendering <span class="subst">&#123;self.color&#125;</span> <span class="subst">&#123;self.name&#125;</span> tree with <span class="subst">&#123;self.texture&#125;</span> texture at (<span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上下文（外在状态）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tree</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, y, tree_type</span>):</span><br><span class="line">        <span class="variable language_">self</span>.x = x</span><br><span class="line">        <span class="variable language_">self</span>.y = y</span><br><span class="line">        <span class="variable language_">self</span>.tree_type = tree_type</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.tree_type.render(<span class="variable language_">self</span>.x, <span class="variable language_">self</span>.y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Forest</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.trees = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">plant_tree</span>(<span class="params">self, x, y, name, color, texture</span>):</span><br><span class="line">        tree_type = TreeFactory.get_tree_type(name, color, texture)</span><br><span class="line">        tree = Tree(x, y, tree_type)</span><br><span class="line">        <span class="variable language_">self</span>.trees.append(tree)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self</span>):</span><br><span class="line">        results = [tree.render() <span class="keyword">for</span> tree <span class="keyword">in</span> <span class="variable language_">self</span>.trees]</span><br><span class="line">        results.append(<span class="string">f&quot;Forest rendered with <span class="subst">&#123;<span class="built_in">len</span>(self.trees)&#125;</span> trees using <span class="subst">&#123;TreeFactory.tree_types_count()&#125;</span> tree types.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(results)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">forest = Forest()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 植树</span></span><br><span class="line">tree_types = [</span><br><span class="line">    (<span class="string">&quot;Pine&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;smooth&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;Maple&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;rough&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;Oak&quot;</span>, <span class="string">&quot;brown&quot;</span>, <span class="string">&quot;rough&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;Pine&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;smooth&quot;</span>),  <span class="comment"># 重复的类型</span></span><br><span class="line">    (<span class="string">&quot;Maple&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;rough&quot;</span>)     <span class="comment"># 重复的类型</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    tree_type = random.choice(tree_types)</span><br><span class="line">    forest.plant_tree(</span><br><span class="line">        random.randint(<span class="number">0</span>, <span class="number">100</span>),</span><br><span class="line">        random.randint(<span class="number">0</span>, <span class="number">100</span>),</span><br><span class="line">        tree_type[<span class="number">0</span>],</span><br><span class="line">        tree_type[<span class="number">1</span>],</span><br><span class="line">        tree_type[<span class="number">2</span>]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(forest.render())</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：大量相似对象、内存受限、游戏中的粒子系统</p>
<h3 id="12-代理模式-Proxy-1"><a href="#12-代理模式-Proxy-1" class="headerlink" title="12. 代理模式 (Proxy)"></a>12. 代理模式 (Proxy)</h3><p>代理模式为其他对象提供一个替代品或占位符，以控制对这个对象的访问。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主题接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际主题</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RealSubject</span>(<span class="title class_ inherited__">Subject</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RealSubject: Handling request.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Proxy</span>(<span class="title class_ inherited__">Subject</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, real_subject</span>):</span><br><span class="line">        <span class="variable language_">self</span>.real_subject = real_subject</span><br><span class="line">        <span class="variable language_">self</span>.access_count = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_access</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Proxy: Checking access prior to firing a real request.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_access</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.access_count += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Proxy: Request to RealSubject (<span class="subst">&#123;self.access_count&#125;</span> times).&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.check_access():</span><br><span class="line">            result = <span class="variable language_">self</span>.real_subject.request()</span><br><span class="line">            <span class="variable language_">self</span>.log_access()</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Proxy: Access denied.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">subject</span>):</span><br><span class="line">    <span class="keyword">return</span> subject.request()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">real_subject = RealSubject()</span><br><span class="line">proxy = Proxy(real_subject)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(client_code(proxy))</span><br><span class="line"><span class="built_in">print</span>(client_code(proxy))</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：延迟初始化、访问控制、日志记录、缓存、远程代理</p>
<h2 id="行为型模式-1"><a href="#行为型模式-1" class="headerlink" title="行为型模式"></a>行为型模式</h2><h3 id="13-责任链模式-Chain-of-Responsibility-1"><a href="#13-责任链模式-Chain-of-Responsibility-1" class="headerlink" title="13. 责任链模式 (Chain of Responsibility)"></a>13. 责任链模式 (Chain of Responsibility)</h3><p>责任链模式使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC, abstractmethod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.next_handler = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set_next</span>(<span class="params">self, handler</span>):</span><br><span class="line">        <span class="variable language_">self</span>.next_handler = handler</span><br><span class="line">        <span class="keyword">return</span> handler</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体处理者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AuthenticationHandler</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;authenticated&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> request:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;AuthenticationHandler: Authentication required.&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;AuthenticationHandler: User is authenticated.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.next_handler:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.next_handler.handle(request)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AuthorizationHandler</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;authenticated&quot;</span> <span class="keyword">in</span> request <span class="keyword">and</span> <span class="string">&quot;admin&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> request:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;AuthorizationHandler: Admin rights required.&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;AuthorizationHandler: User has admin rights.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.next_handler:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.next_handler.handle(request)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ValidationHandler</span>(<span class="title class_ inherited__">Handler</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;data&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> request:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ValidationHandler: Invalid request data.&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ValidationHandler: Request data is valid.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.next_handler:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.next_handler.handle(request)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Request processed successfully.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">client_code</span>(<span class="params">handler, request</span>):</span><br><span class="line">    result = handler.handle(request)</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Request was handled successfully.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建处理链</span></span><br><span class="line">authentication = AuthenticationHandler()</span><br><span class="line">authorization = AuthorizationHandler()</span><br><span class="line">validation = ValidationHandler()</span><br><span class="line"></span><br><span class="line">authentication.set_next(authorization).set_next(validation)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试不同请求</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Scenario 1: Unauthenticated request&quot;</span>)</span><br><span class="line">client_code(authentication, &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nScenario 2: Authenticated but unauthorized request&quot;</span>)</span><br><span class="line">client_code(authentication, &#123;<span class="string">&quot;authenticated&quot;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nScenario 3: Authenticated and authorized but invalid request&quot;</span>)</span><br><span class="line">client_code(authentication, &#123;<span class="string">&quot;authenticated&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;admin&quot;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nScenario 4: Valid request&quot;</span>)</span><br><span class="line">client_code(authentication, &#123;<span class="string">&quot;authenticated&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;admin&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;data&quot;</span>: <span class="string">&quot;Some data&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：请求处理管道、中间件、事件处理系统</p>
<h3 id="14-命令模式-Command-1"><a href="#14-命令模式-Command-1" class="headerlink" title="14. 命令模式 (Command)"></a>14. 命令模式 (Command)</h3><p>命令模式将请求封装为对象，从而允许参数化客户端、队列或记录请求，以及支持可撤销操作。</p>
<pre><code class="language-python">from abc import ABC, abstractmethod

# 命令接口
class Command(ABC):
    @abstractmethod
    def execute(self):
        pass
    
    @abstractmethod
    def undo(self):
        pass

# 接收者
class Editor:
    def __init__(self):
        self.text = &quot;&quot;
        self.clipboard = &quot;&quot;
        self.selection = &quot;&quot;
    
    def get_selection(self):
        return self.selection
    
    def delete_selection(self):
        old_selection = self.selection
        self.text = self.text.replace(self.selection, &quot;&quot;)
        self.selection = &quot;&quot;
        return old_selection
    
    def replace_selection(self, text):
        old_selection = self.selection
        self.text = self.text.replace(self.selection, text)
        self.selection = text
        return old_selection
    
    def copy_selection_to_clipboard(self):
        self.clipboard = self.selection
    
    def paste_clipboard(self):
        if self.selection:
            return self.replace_selection(self.clipboard)
        else:
            self.text += self.clipboard
            return &quot;&quot;

# 具体命令
class CopyCommand(Command):
    def __init__(self, editor):
        self.editor = editor
    
    def execute(self):
        self.editor.copy_selection_to_clipboard()
    
    def undo(self):
        # 复制操作不需要撤销
        pass

class PasteCommand(Command):
    def __init__(self, editor):
        self.editor = editor
        self.backup = &quot;&quot;
    
    def execute(self):
        self.backup = self.editor.paste_clipboard()
    
    def undo(self):
        if self.editor.selection:
            self.editor.replace_selection(self.backup)
        else:
            # 简化：假设粘贴总是在末尾
            self.editor.text = self.editor.text[:-len(self.editor.clipboard)]

class CutCommand(Command):
    def __init__(self, editor):
        self.editor = editor
        self.backup = &quot;&quot;
    
    def execute(self):
        self.editor.copy_selection_to_clipboard()
        self.backup = self.editor.delete_selection()
    
    def undo(self):
        self.editor.selection = self.backup
        self.editor.text += self.backup

# 调用者
class CommandHistory:
    def __init__(self):
        self.history = []
    
    def push(self, command):
        self.history.append(command)
    
    def pop(self):
        if self.history:
            return self.history.pop()
        return None

class Application:
    def __init__(self):
        self.editor = Editor()
        self.history = CommandHistory()
    
    def execute_command(self, command):
        command.execute()
        self.history.push(command)
    
    def undo(self):
        command = self.history.pop()
        if command:
            command.undo()

# 客户端代码
app = Application()
editor = app.editor

# 设置初始文本和选择
editor.text = &quot;Hello, world!&quot;
editor.selection = &quot;world&quot;

# 执行命令
copy_command = CopyCommand(editor)
app.execute_command(copy_command)
print(f&quot;After copy: Text=&#39;&#123;editor.text&#125;&#39;, Clipboard=&#39;&#123;editor.clipboard&#125;&#39;&quot;)

cut_command = CutCommand(editor)
app.execute_command(cut_command)
print(f&quot;After cut: Text=&#39;&#123;editor.text&#125;&#39;, Clipboard=&#39;&#123;editor.clipboard&#125;&#39;&quot;)

paste_command = PasteCommand(editor)
app.execute_command(paste_command)
print(f&quot;After paste: Text=&#39;&#123;editor.text&#125;&#39;, Clipboard=&#39;&#123;editor.clipboard&#125;&#39;&quot;)

# 撤销操作
app.undo()
print(f&quot;After undo paste: Text=&#39;&#123;editor.text&#125;&#39;, Clipboard=&#39;&#123;editor.clipboard&#125;&#39;&quot;)

app.undo()
print(f&quot;After undo cut: Text=&#39;&#123;editor.text&#125;&#39;, Clipboard=&#39;&#123;editor.clipboard&#125;&#39;&quot;)
</code></pre>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">面向对象</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E4%BB%A3%E7%A0%81%E6%9E%B6%E6%9E%84/">代码架构</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/">软件工程</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2023/python/python-web-scraping-techniques/"
                                   title="Python网络爬虫技术：从入门到精通"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Python网络爬虫技术：从入门到精通</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2022/python/python-context-managers-beyond-files/"
                                   title="Python上下文管理器：不只是用来打开文件"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Python上下文管理器：不只是用来打开文件</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Python%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%EF%BC%9A23%E7%A7%8D%E7%BB%8F%E5%85%B8%E6%A8%A1%E5%BC%8F%E7%9A%84Python%E5%AE%9E%E7%8E%B0"><span class="nav-text">Python设计模式实战：23种经典模式的Python实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AE%80%E4%BB%8B"><span class="nav-text">设计模式简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text">创建型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-Singleton"><span class="nav-text">1. 单例模式 (Singleton)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-Factory-Method"><span class="nav-text">2. 工厂方法模式 (Factory Method)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-Abstract-Factory"><span class="nav-text">3. 抽象工厂模式 (Abstract Factory)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F-Builder"><span class="nav-text">4. 建造者模式 (Builder)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F-Prototype"><span class="nav-text">5. 原型模式 (Prototype)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text">结构型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F-Adapter"><span class="nav-text">6. 适配器模式 (Adapter)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F-Bridge"><span class="nav-text">7. 桥接模式 (Bridge)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F-Composite"><span class="nav-text">8. 组合模式 (Composite)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F-Decorator"><span class="nav-text">9. 装饰器模式 (Decorator)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F-Facade"><span class="nav-text">10. 外观模式 (Facade)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F-Flyweight"><span class="nav-text">11. 享元模式 (Flyweight)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F-Proxy"><span class="nav-text">12. 代理模式 (Proxy)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text">行为型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F-Chain-of-Responsibility"><span class="nav-text">13. 责任链模式 (Chain of Responsibility)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F-Command"><span class="nav-text">14. 命令模式 (Command)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F-Interpreter"><span class="nav-text">15. 解释器模式 (Interpreter)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F-Iterator"><span class="nav-text">16. 迭代器模式 (Iterator)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F-Mediator"><span class="nav-text">17. 中介者模式 (Mediator)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F-Memento"><span class="nav-text">18. 备忘录模式 (Memento)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F-Observer"><span class="nav-text">19. 观察者模式 (Observer)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F-State"><span class="nav-text">20. 状态模式 (State)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F-Strategy"><span class="nav-text">21. 策略模式 (Strategy)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-Template-Method"><span class="nav-text">22. 模板方法模式 (Template Method)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F-Visitor"><span class="nav-text">23. 访问者模式 (Visitor)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-Factory-Method-1"><span class="nav-text">2. 工厂方法模式 (Factory Method)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-Abstract-Factory-1"><span class="nav-text">3. 抽象工厂模式 (Abstract Factory)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F-Builder-1"><span class="nav-text">4. 建造者模式 (Builder)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F-Prototype-1"><span class="nav-text">5. 原型模式 (Prototype)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F-1"><span class="nav-text">结构型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F-Adapter-1"><span class="nav-text">6. 适配器模式 (Adapter)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F-Bridge-1"><span class="nav-text">7. 桥接模式 (Bridge)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F-Composite-1"><span class="nav-text">8. 组合模式 (Composite)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F-Decorator-1"><span class="nav-text">9. 装饰器模式 (Decorator)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F-Facade-1"><span class="nav-text">10. 外观模式 (Facade)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F-Flyweight-1"><span class="nav-text">11. 享元模式 (Flyweight)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F-Proxy-1"><span class="nav-text">12. 代理模式 (Proxy)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-1"><span class="nav-text">行为型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F-Chain-of-Responsibility-1"><span class="nav-text">13. 责任链模式 (Chain of Responsibility)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F-Command-1"><span class="nav-text">14. 命令模式 (Command)</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;2025
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Orion K</a>
        
    </div>


    
        
        <div class="deploy-info info-item">
            
            本站由 <span class="tooltip" data-tooltip-content="GitHub Pages"><img src="/images/brands/github.png"></span> 提供部署服务
            
        </div>
    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Python%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%EF%BC%9A23%E7%A7%8D%E7%BB%8F%E5%85%B8%E6%A8%A1%E5%BC%8F%E7%9A%84Python%E5%AE%9E%E7%8E%B0"><span class="nav-text">Python设计模式实战：23种经典模式的Python实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AE%80%E4%BB%8B"><span class="nav-text">设计模式简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text">创建型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-Singleton"><span class="nav-text">1. 单例模式 (Singleton)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-Factory-Method"><span class="nav-text">2. 工厂方法模式 (Factory Method)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-Abstract-Factory"><span class="nav-text">3. 抽象工厂模式 (Abstract Factory)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F-Builder"><span class="nav-text">4. 建造者模式 (Builder)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F-Prototype"><span class="nav-text">5. 原型模式 (Prototype)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text">结构型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F-Adapter"><span class="nav-text">6. 适配器模式 (Adapter)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F-Bridge"><span class="nav-text">7. 桥接模式 (Bridge)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F-Composite"><span class="nav-text">8. 组合模式 (Composite)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F-Decorator"><span class="nav-text">9. 装饰器模式 (Decorator)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F-Facade"><span class="nav-text">10. 外观模式 (Facade)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F-Flyweight"><span class="nav-text">11. 享元模式 (Flyweight)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F-Proxy"><span class="nav-text">12. 代理模式 (Proxy)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-text">行为型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F-Chain-of-Responsibility"><span class="nav-text">13. 责任链模式 (Chain of Responsibility)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F-Command"><span class="nav-text">14. 命令模式 (Command)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F-Interpreter"><span class="nav-text">15. 解释器模式 (Interpreter)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F-Iterator"><span class="nav-text">16. 迭代器模式 (Iterator)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F-Mediator"><span class="nav-text">17. 中介者模式 (Mediator)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F-Memento"><span class="nav-text">18. 备忘录模式 (Memento)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F-Observer"><span class="nav-text">19. 观察者模式 (Observer)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F-State"><span class="nav-text">20. 状态模式 (State)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F-Strategy"><span class="nav-text">21. 策略模式 (Strategy)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-Template-Method"><span class="nav-text">22. 模板方法模式 (Template Method)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F-Visitor"><span class="nav-text">23. 访问者模式 (Visitor)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-Factory-Method-1"><span class="nav-text">2. 工厂方法模式 (Factory Method)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-Abstract-Factory-1"><span class="nav-text">3. 抽象工厂模式 (Abstract Factory)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F-Builder-1"><span class="nav-text">4. 建造者模式 (Builder)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F-Prototype-1"><span class="nav-text">5. 原型模式 (Prototype)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F-1"><span class="nav-text">结构型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F-Adapter-1"><span class="nav-text">6. 适配器模式 (Adapter)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F-Bridge-1"><span class="nav-text">7. 桥接模式 (Bridge)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F-Composite-1"><span class="nav-text">8. 组合模式 (Composite)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F-Decorator-1"><span class="nav-text">9. 装饰器模式 (Decorator)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F-Facade-1"><span class="nav-text">10. 外观模式 (Facade)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F-Flyweight-1"><span class="nav-text">11. 享元模式 (Flyweight)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F-Proxy-1"><span class="nav-text">12. 代理模式 (Proxy)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-1"><span class="nav-text">行为型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F-Chain-of-Responsibility-1"><span class="nav-text">13. 责任链模式 (Chain of Responsibility)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F-Command-1"><span class="nav-text">14. 命令模式 (Command)</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
