<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="全面解析MySQL数据库安全防护策略，包括用户权限管理、数据加密、审计日志和安全配置最佳实践">
    <meta name="author" content="Orion K">
    
    <title>
        
            MySQL数据库安全防护实战指南 |
        
        Orion K Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"Orion K Blog","author":"Orion K","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/                        || fa-solid fa-home","archives":"/archives            || fa-solid fa-box-archive","categories":"/categories        || fa-solid fa-layer-group"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":"欢迎来到 Orion K 的博客，这是一个分享互联网技术的博客。联系：wxmm686800@gmail.com","category":true,"tag":true,"post_datetime":"created"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":null,"reaction":false,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2025,"word_count":false,"site_deploy":{"enable":true,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Orion K Blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                首页
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                归档
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                
                                分类
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            首页
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            归档
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                </span>
                            
                            分类
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        MySQL数据库安全防护实战指南
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Orion K</span>
                                
                                    <span class="author-badge">Lv6</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2023-12-05 14:15:00</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/mysql/">mysql</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">最佳实践</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4/">安全防护</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/">权限管理</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/mysql/">mysql</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/">数据库安全</a></li>
                        
                    
                </ul>
            </span>
        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h1 id="MySQL数据库安全防护实战指南"><a href="#MySQL数据库安全防护实战指南" class="headerlink" title="MySQL数据库安全防护实战指南"></a>MySQL数据库安全防护实战指南</h1><p>数据库安全是企业信息安全的重要组成部分。本文将从多个维度详细介绍MySQL数据库的安全防护策略和最佳实践，帮助构建安全可靠的数据库环境。</p>
<h2 id="用户权限管理"><a href="#用户权限管理" class="headerlink" title="用户权限管理"></a>用户权限管理</h2><h3 id="1-用户账户安全"><a href="#1-用户账户安全" class="headerlink" title="1. 用户账户安全"></a>1. 用户账户安全</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看当前用户和权限</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>(), <span class="built_in">CURRENT_USER</span>();</span><br><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="built_in">CURRENT_USER</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有用户账户</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">User</span> <span class="keyword">as</span> <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    Host <span class="keyword">as</span> <span class="string">&#x27;主机&#x27;</span>,</span><br><span class="line">    authentication_string <span class="keyword">as</span> <span class="string">&#x27;密码哈希&#x27;</span>,</span><br><span class="line">    password_expired <span class="keyword">as</span> <span class="string">&#x27;密码过期&#x27;</span>,</span><br><span class="line">    password_last_changed <span class="keyword">as</span> <span class="string">&#x27;密码最后修改&#x27;</span>,</span><br><span class="line">    password_lifetime <span class="keyword">as</span> <span class="string">&#x27;密码有效期&#x27;</span>,</span><br><span class="line">    account_locked <span class="keyword">as</span> <span class="string">&#x27;账户锁定&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> mysql.user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建安全的用户账户</span></span><br><span class="line"><span class="comment">-- 1. 应用程序只读用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app_readonly&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;StrongP@ssw0rd123!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app_readonly&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 应用程序读写用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;app_readwrite&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;StrongP@ssw0rd456!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span> <span class="keyword">ON</span> myapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app_readwrite&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 数据库管理员用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;db_admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;AdminP@ssw0rd789!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;db_admin&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 备份专用用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;backup_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;BackupP@ssw0rd!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, LOCK TABLES, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, EVENT, <span class="keyword">TRIGGER</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;backup_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置密码策略</span></span><br><span class="line"><span class="comment">-- 查看密码验证插件状态</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;validate_password%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 安装密码验证插件（如果未安装）</span></span><br><span class="line"><span class="comment">-- INSTALL PLUGIN validate_password SONAME &#x27;validate_password.so&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 配置密码策略</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password.policy <span class="operator">=</span> <span class="string">&#x27;STRONG&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password.length <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password.mixed_case_count <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password.number_count <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> validate_password.special_char_count <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置密码过期策略</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;app_readonly&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span> PASSWORD EXPIRE <span class="type">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;app_readwrite&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span> PASSWORD EXPIRE <span class="type">INTERVAL</span> <span class="number">90</span> <span class="keyword">DAY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 账户锁定策略</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;test_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;TestP@ssw0rd!&#x27;</span> </span><br><span class="line">    FAILED_LOGIN_ATTEMPTS <span class="number">3</span> </span><br><span class="line">    PASSWORD_LOCK_TIME <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-权限最小化原则"><a href="#2-权限最小化原则" class="headerlink" title="2. 权限最小化原则"></a>2. 权限最小化原则</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建细粒度权限的用户</span></span><br><span class="line"><span class="comment">-- 1. 报表查询用户（只能查询特定表）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;report_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;ReportP@ssw0rd!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.orders <span class="keyword">TO</span> <span class="string">&#x27;report_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.users <span class="keyword">TO</span> <span class="string">&#x27;report_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.products <span class="keyword">TO</span> <span class="string">&#x27;report_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 数据分析用户（只能查询，不能修改）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;analyst&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;AnalystP@ssw0rd!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;analyst&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 排除敏感表</span></span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.user_passwords <span class="keyword">FROM</span> <span class="string">&#x27;analyst&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.payment_info <span class="keyword">FROM</span> <span class="string">&#x27;analyst&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 应用服务用户（特定操作权限）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;order_service&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;OrderServiceP@ssw0rd!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span> <span class="keyword">ON</span> myapp.orders <span class="keyword">TO</span> <span class="string">&#x27;order_service&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">UPDATE</span> <span class="keyword">ON</span> myapp.products <span class="keyword">TO</span> <span class="string">&#x27;order_service&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.users <span class="keyword">TO</span> <span class="string">&#x27;order_service&#x27;</span>@<span class="string">&#x27;192.168.1.%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 监控用户（只能查看状态信息）</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;monitor&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;MonitorP@ssw0rd!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> PROCESS, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;monitor&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> performance_schema.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;monitor&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> information_schema.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;monitor&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 权限审计查询</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    GRANTEE <span class="keyword">as</span> <span class="string">&#x27;用户&#x27;</span>,</span><br><span class="line">    TABLE_SCHEMA <span class="keyword">as</span> <span class="string">&#x27;数据库&#x27;</span>,</span><br><span class="line">    TABLE_NAME <span class="keyword">as</span> <span class="string">&#x27;表名&#x27;</span>,</span><br><span class="line">    PRIVILEGE_TYPE <span class="keyword">as</span> <span class="string">&#x27;权限类型&#x27;</span>,</span><br><span class="line">    IS_GRANTABLE <span class="keyword">as</span> <span class="string">&#x27;可授权&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> information_schema.TABLE_PRIVILEGES </span><br><span class="line"><span class="keyword">WHERE</span> GRANTEE <span class="keyword">LIKE</span> <span class="string">&#x27;%app_%&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GRANTEE, TABLE_SCHEMA, TABLE_NAME;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看用户的所有权限</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ShowUserPrivileges(<span class="keyword">IN</span> username <span class="type">VARCHAR</span>(<span class="number">100</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> user_host <span class="type">VARCHAR</span>(<span class="number">200</span>);</span><br><span class="line">    <span class="keyword">SET</span> user_host <span class="operator">=</span> CONCAT(&quot;&#x27;&quot;, username, &quot;&#x27;&quot;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 全局权限</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="string">&#x27;GLOBAL PRIVILEGES&#x27;</span> <span class="keyword">as</span> privilege_level, </span><br><span class="line">           PRIVILEGE_TYPE <span class="keyword">as</span> privilege_type,</span><br><span class="line">           <span class="string">&#x27;N/A&#x27;</span> <span class="keyword">as</span> object_schema,</span><br><span class="line">           <span class="string">&#x27;N/A&#x27;</span> <span class="keyword">as</span> object_name</span><br><span class="line">    <span class="keyword">FROM</span> information_schema.USER_PRIVILEGES </span><br><span class="line">    <span class="keyword">WHERE</span> GRANTEE <span class="operator">=</span> user_host</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 数据库级权限</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="string">&#x27;SCHEMA PRIVILEGES&#x27;</span> <span class="keyword">as</span> privilege_level,</span><br><span class="line">           PRIVILEGE_TYPE <span class="keyword">as</span> privilege_type,</span><br><span class="line">           SCHEMA_NAME <span class="keyword">as</span> object_schema,</span><br><span class="line">           <span class="string">&#x27;N/A&#x27;</span> <span class="keyword">as</span> object_name</span><br><span class="line">    <span class="keyword">FROM</span> information_schema.SCHEMA_PRIVILEGES </span><br><span class="line">    <span class="keyword">WHERE</span> GRANTEE <span class="operator">=</span> user_host</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 表级权限</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="string">&#x27;TABLE PRIVILEGES&#x27;</span> <span class="keyword">as</span> privilege_level,</span><br><span class="line">           PRIVILEGE_TYPE <span class="keyword">as</span> privilege_type,</span><br><span class="line">           TABLE_SCHEMA <span class="keyword">as</span> object_schema,</span><br><span class="line">           TABLE_NAME <span class="keyword">as</span> object_name</span><br><span class="line">    <span class="keyword">FROM</span> information_schema.TABLE_PRIVILEGES </span><br><span class="line">    <span class="keyword">WHERE</span> GRANTEE <span class="operator">=</span> user_host</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> privilege_level, object_schema, object_name;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用权限查询存储过程</span></span><br><span class="line"><span class="keyword">CALL</span> ShowUserPrivileges(<span class="string">&#x27;app_readonly@192.168.1.%&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-角色管理（MySQL-8-0-）"><a href="#3-角色管理（MySQL-8-0-）" class="headerlink" title="3. 角色管理（MySQL 8.0+）"></a>3. 角色管理（MySQL 8.0+）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建角色</span></span><br><span class="line"><span class="keyword">CREATE</span> ROLE <span class="string">&#x27;app_developer&#x27;</span>, <span class="string">&#x27;app_tester&#x27;</span>, <span class="string">&#x27;data_analyst&#x27;</span>, <span class="string">&#x27;db_monitor&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 为角色分配权限</span></span><br><span class="line"><span class="comment">-- 开发者角色</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span> <span class="keyword">ON</span> myapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app_developer&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span>, <span class="keyword">DROP</span>, <span class="keyword">ALTER</span> <span class="keyword">ON</span> myapp.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app_developer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试者角色</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span> <span class="keyword">ON</span> test_db.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app_tester&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据分析师角色</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.orders <span class="keyword">TO</span> <span class="string">&#x27;data_analyst&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.users <span class="keyword">TO</span> <span class="string">&#x27;data_analyst&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> myapp.products <span class="keyword">TO</span> <span class="string">&#x27;data_analyst&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 监控角色</span></span><br><span class="line"><span class="keyword">GRANT</span> PROCESS, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;db_monitor&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> performance_schema.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;db_monitor&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户并分配角色</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;john_dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;DevP@ssw0rd!&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;jane_analyst&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;AnalystP@ssw0rd!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="string">&#x27;app_developer&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;john_dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="string">&#x27;data_analyst&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;jane_analyst&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置默认角色</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">DEFAULT</span> ROLE <span class="string">&#x27;app_developer&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;john_dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">DEFAULT</span> ROLE <span class="string">&#x27;data_analyst&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;jane_analyst&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看角色信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.APPLICABLE_ROLES;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.ENABLED_ROLES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 角色权限查询</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    GRANTEE <span class="keyword">as</span> <span class="string">&#x27;角色/用户&#x27;</span>,</span><br><span class="line">    PRIVILEGE_TYPE <span class="keyword">as</span> <span class="string">&#x27;权限&#x27;</span>,</span><br><span class="line">    TABLE_SCHEMA <span class="keyword">as</span> <span class="string">&#x27;数据库&#x27;</span>,</span><br><span class="line">    TABLE_NAME <span class="keyword">as</span> <span class="string">&#x27;表名&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> information_schema.TABLE_PRIVILEGES </span><br><span class="line"><span class="keyword">WHERE</span> GRANTEE <span class="keyword">IN</span> (&quot;&#x27;app_developer&#x27;&quot;, &quot;&#x27;data_analyst&#x27;&quot;, &quot;&#x27;db_monitor&#x27;&quot;)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GRANTEE, TABLE_SCHEMA;</span><br></pre></td></tr></table></figure>

<h2 id="数据加密和保护"><a href="#数据加密和保护" class="headerlink" title="数据加密和保护"></a>数据加密和保护</h2><h3 id="1-传输加密（SSL-TLS）"><a href="#1-传输加密（SSL-TLS）" class="headerlink" title="1. 传输加密（SSL&#x2F;TLS）"></a>1. 传输加密（SSL&#x2F;TLS）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看SSL状态</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%ssl%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Ssl%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看SSL证书信息</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    VARIABLE_NAME <span class="keyword">as</span> <span class="string">&#x27;配置项&#x27;</span>,</span><br><span class="line">    VARIABLE_VALUE <span class="keyword">as</span> <span class="string">&#x27;值&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> performance_schema.global_variables </span><br><span class="line"><span class="keyword">WHERE</span> VARIABLE_NAME <span class="keyword">IN</span> (</span><br><span class="line">    <span class="string">&#x27;ssl_ca&#x27;</span>, <span class="string">&#x27;ssl_cert&#x27;</span>, <span class="string">&#x27;ssl_key&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;ssl_cipher&#x27;</span>, <span class="string">&#x27;ssl_crl&#x27;</span>, <span class="string">&#x27;ssl_crlpath&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建要求SSL连接的用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;secure_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;SecureP@ssw0rd!&#x27;</span> REQUIRE SSL;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建要求特定SSL证书的用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;cert_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;CertP@ssw0rd!&#x27;</span> </span><br><span class="line">    REQUIRE X509;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建要求特定SSL配置的用户</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;strict_ssl_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;StrictP@ssw0rd!&#x27;</span> </span><br><span class="line">    REQUIRE SSL </span><br><span class="line">    <span class="keyword">AND</span> CIPHER <span class="string">&#x27;AES256-SHA&#x27;</span> </span><br><span class="line">    <span class="keyword">AND</span> ISSUER <span class="string">&#x27;/C=US/ST=CA/L=San Francisco/O=MyCompany/CN=MyCA&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 检查当前连接的SSL状态</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    CONNECTION_ID() <span class="keyword">as</span> connection_id,</span><br><span class="line">    <span class="keyword">USER</span>() <span class="keyword">as</span> <span class="keyword">user</span>,</span><br><span class="line">    @<span class="variable">@ssl_cipher</span> <span class="keyword">as</span> ssl_cipher,</span><br><span class="line">    @<span class="variable">@ssl_version</span> <span class="keyword">as</span> ssl_version;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- SSL连接统计</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    VARIABLE_NAME <span class="keyword">as</span> <span class="string">&#x27;指标&#x27;</span>,</span><br><span class="line">    VARIABLE_VALUE <span class="keyword">as</span> <span class="string">&#x27;值&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> performance_schema.global_status </span><br><span class="line"><span class="keyword">WHERE</span> VARIABLE_NAME <span class="keyword">IN</span> (</span><br><span class="line">    <span class="string">&#x27;Ssl_accepts&#x27;</span>, <span class="string">&#x27;Ssl_finished_accepts&#x27;</span>, <span class="string">&#x27;Ssl_finished_connects&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Ssl_client_connects&#x27;</span>, <span class="string">&#x27;Ssl_connect_renegotiates&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="2-数据静态加密"><a href="#2-数据静态加密" class="headerlink" title="2. 数据静态加密"></a>2. 数据静态加密</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建加密表空间（MySQL 8.0+）</span></span><br><span class="line"><span class="keyword">CREATE</span> TABLESPACE encrypted_space </span><br><span class="line">    <span class="keyword">ADD</span> DATAFILE <span class="string">&#x27;encrypted_space.ibd&#x27;</span> </span><br><span class="line">    ENCRYPTION <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建加密表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> sensitive_data (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    user_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    credit_card_number <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    ssn <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">) TABLESPACE encrypted_space ENCRYPTION <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 为现有表启用加密</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> user_payments ENCRYPTION <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的加密状态</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    TABLE_SCHEMA <span class="keyword">as</span> <span class="string">&#x27;数据库&#x27;</span>,</span><br><span class="line">    TABLE_NAME <span class="keyword">as</span> <span class="string">&#x27;表名&#x27;</span>,</span><br><span class="line">    CREATE_OPTIONS <span class="keyword">as</span> <span class="string">&#x27;创建选项&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> information_schema.TABLES </span><br><span class="line"><span class="keyword">WHERE</span> CREATE_OPTIONS <span class="keyword">LIKE</span> <span class="string">&#x27;%ENCRYPTION%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 字段级加密示例</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> user_sensitive_info (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="comment">-- 使用AES加密存储敏感信息</span></span><br><span class="line">    encrypted_phone <span class="type">VARBINARY</span>(<span class="number">255</span>),</span><br><span class="line">    encrypted_address <span class="type">VARBINARY</span>(<span class="number">255</span>),</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入加密数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> user_sensitive_info (username, email, encrypted_phone, encrypted_address)</span><br><span class="line"><span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="string">&#x27;john_doe&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;john@example.com&#x27;</span>,</span><br><span class="line">    AES_ENCRYPT(<span class="string">&#x27;13800138000&#x27;</span>, <span class="string">&#x27;encryption_key_phone&#x27;</span>),</span><br><span class="line">    AES_ENCRYPT(<span class="string">&#x27;123 Main St, City, State&#x27;</span>, <span class="string">&#x27;encryption_key_address&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询解密数据</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    id,</span><br><span class="line">    username,</span><br><span class="line">    email,</span><br><span class="line">    AES_DECRYPT(encrypted_phone, <span class="string">&#x27;encryption_key_phone&#x27;</span>) <span class="keyword">as</span> phone,</span><br><span class="line">    AES_DECRYPT(encrypted_address, <span class="string">&#x27;encryption_key_address&#x27;</span>) <span class="keyword">as</span> address</span><br><span class="line"><span class="keyword">FROM</span> user_sensitive_info;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建加密函数</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> EncryptSensitiveData(data TEXT, key_name <span class="type">VARCHAR</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARBINARY</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">READS</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> encryption_key <span class="type">VARCHAR</span>(<span class="number">255</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 根据key_name获取对应的加密密钥</span></span><br><span class="line">    <span class="keyword">CASE</span> key_name</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;phone&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> encryption_key <span class="operator">=</span> <span class="string">&#x27;phone_encryption_key_2023&#x27;</span>;</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;address&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> encryption_key <span class="operator">=</span> <span class="string">&#x27;address_encryption_key_2023&#x27;</span>;</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;credit_card&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> encryption_key <span class="operator">=</span> <span class="string">&#x27;cc_encryption_key_2023&#x27;</span>;</span><br><span class="line">        <span class="keyword">ELSE</span> <span class="keyword">SET</span> encryption_key <span class="operator">=</span> <span class="string">&#x27;default_encryption_key_2023&#x27;</span>;</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">RETURN</span> AES_ENCRYPT(data, encryption_key);</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> DecryptSensitiveData(encrypted_data <span class="type">VARBINARY</span>(<span class="number">255</span>), key_name <span class="type">VARCHAR</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> TEXT</span><br><span class="line"><span class="keyword">READS</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> encryption_key <span class="type">VARCHAR</span>(<span class="number">255</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 根据key_name获取对应的加密密钥</span></span><br><span class="line">    <span class="keyword">CASE</span> key_name</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;phone&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> encryption_key <span class="operator">=</span> <span class="string">&#x27;phone_encryption_key_2023&#x27;</span>;</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;address&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> encryption_key <span class="operator">=</span> <span class="string">&#x27;address_encryption_key_2023&#x27;</span>;</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;credit_card&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> encryption_key <span class="operator">=</span> <span class="string">&#x27;cc_encryption_key_2023&#x27;</span>;</span><br><span class="line">        <span class="keyword">ELSE</span> <span class="keyword">SET</span> encryption_key <span class="operator">=</span> <span class="string">&#x27;default_encryption_key_2023&#x27;</span>;</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">RETURN</span> AES_DECRYPT(encrypted_data, encryption_key);</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用加密函数</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> user_sensitive_info (username, email, encrypted_phone, encrypted_address)</span><br><span class="line"><span class="keyword">VALUES</span> (</span><br><span class="line">    <span class="string">&#x27;jane_doe&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;jane@example.com&#x27;</span>,</span><br><span class="line">    EncryptSensitiveData(<span class="string">&#x27;13900139000&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>),</span><br><span class="line">    EncryptSensitiveData(<span class="string">&#x27;456 Oak Ave, Town, State&#x27;</span>, <span class="string">&#x27;address&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询时解密</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    id,</span><br><span class="line">    username,</span><br><span class="line">    email,</span><br><span class="line">    DecryptSensitiveData(encrypted_phone, <span class="string">&#x27;phone&#x27;</span>) <span class="keyword">as</span> phone,</span><br><span class="line">    DecryptSensitiveData(encrypted_address, <span class="string">&#x27;address&#x27;</span>) <span class="keyword">as</span> address</span><br><span class="line"><span class="keyword">FROM</span> user_sensitive_info;</span><br></pre></td></tr></table></figure>

<h3 id="3-数据脱敏"><a href="#3-数据脱敏" class="headerlink" title="3. 数据脱敏"></a>3. 数据脱敏</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据脱敏函数</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> MaskCreditCard(card_number <span class="type">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">READS</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    IF card_number <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">OR</span> LENGTH(card_number) <span class="operator">&lt;</span> <span class="number">8</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">RETURN</span> card_number;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">RETURN</span> CONCAT(</span><br><span class="line">        <span class="keyword">LEFT</span>(card_number, <span class="number">4</span>),</span><br><span class="line">        REPEAT(<span class="string">&#x27;*&#x27;</span>, LENGTH(card_number) <span class="operator">-</span> <span class="number">8</span>),</span><br><span class="line">        <span class="keyword">RIGHT</span>(card_number, <span class="number">4</span>)</span><br><span class="line">    );</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> MaskPhone(phone <span class="type">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">READS</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    IF phone <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">OR</span> LENGTH(phone) <span class="operator">&lt;</span> <span class="number">7</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">RETURN</span> phone;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 中国手机号脱敏</span></span><br><span class="line">    IF LENGTH(phone) <span class="operator">=</span> <span class="number">11</span> <span class="keyword">AND</span> phone REGEXP <span class="string">&#x27;^1[3-9][0-9]&#123;9&#125;$&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">RETURN</span> CONCAT(<span class="keyword">LEFT</span>(phone, <span class="number">3</span>), <span class="string">&#x27;****&#x27;</span>, <span class="keyword">RIGHT</span>(phone, <span class="number">4</span>));</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        <span class="keyword">RETURN</span> CONCAT(<span class="keyword">LEFT</span>(phone, <span class="number">3</span>), REPEAT(<span class="string">&#x27;*&#x27;</span>, LENGTH(phone) <span class="operator">-</span> <span class="number">5</span>), <span class="keyword">RIGHT</span>(phone, <span class="number">2</span>));</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> MaskEmail(email <span class="type">VARCHAR</span>(<span class="number">100</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line"><span class="keyword">READS</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> at_pos <span class="type">INT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> username_part <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> domain_part <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">    </span><br><span class="line">    IF email <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">OR</span> email <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%@%&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">RETURN</span> email;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SET</span> at_pos <span class="operator">=</span> LOCATE(<span class="string">&#x27;@&#x27;</span>, email);</span><br><span class="line">    <span class="keyword">SET</span> username_part <span class="operator">=</span> <span class="keyword">LEFT</span>(email, at_pos <span class="operator">-</span> <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">SET</span> domain_part <span class="operator">=</span> <span class="built_in">SUBSTRING</span>(email, at_pos);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 用户名部分脱敏</span></span><br><span class="line">    IF LENGTH(username_part) <span class="operator">&lt;=</span> <span class="number">2</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">SET</span> username_part <span class="operator">=</span> CONCAT(<span class="keyword">LEFT</span>(username_part, <span class="number">1</span>), <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        <span class="keyword">SET</span> username_part <span class="operator">=</span> CONCAT(</span><br><span class="line">            <span class="keyword">LEFT</span>(username_part, <span class="number">1</span>),</span><br><span class="line">            REPEAT(<span class="string">&#x27;*&#x27;</span>, LENGTH(username_part) <span class="operator">-</span> <span class="number">2</span>),</span><br><span class="line">            <span class="keyword">RIGHT</span>(username_part, <span class="number">1</span>)</span><br><span class="line">        );</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">RETURN</span> CONCAT(username_part, domain_part);</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建脱敏视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> users_masked <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    id,</span><br><span class="line">    username,</span><br><span class="line">    MaskEmail(email) <span class="keyword">as</span> email,</span><br><span class="line">    MaskPhone(phone) <span class="keyword">as</span> phone,</span><br><span class="line">    region,</span><br><span class="line">    created_at</span><br><span class="line"><span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建敏感数据访问日志</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> sensitive_data_access_log (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    user_name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    table_name <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    operation ENUM(<span class="string">&#x27;SELECT&#x27;</span>, <span class="string">&#x27;INSERT&#x27;</span>, <span class="string">&#x27;UPDATE&#x27;</span>, <span class="string">&#x27;DELETE&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    sensitive_fields JSON,</span><br><span class="line">    access_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    ip_address <span class="type">VARCHAR</span>(<span class="number">45</span>),</span><br><span class="line">    INDEX idx_user_time (user_name, access_time),</span><br><span class="line">    INDEX idx_table_time (table_name, access_time)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建敏感数据访问触发器</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> tr_log_sensitive_access</span><br><span class="line">AFTER <span class="keyword">SELECT</span> <span class="keyword">ON</span> users</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> sensitive_data_access_log (</span><br><span class="line">        user_name, table_name, operation, sensitive_fields, ip_address</span><br><span class="line">    ) <span class="keyword">VALUES</span> (</span><br><span class="line">        <span class="keyword">USER</span>(), <span class="string">&#x27;users&#x27;</span>, <span class="string">&#x27;SELECT&#x27;</span>,</span><br><span class="line">        <span class="built_in">JSON_ARRAY</span>(<span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;phone&#x27;</span>),</span><br><span class="line">        <span class="built_in">COALESCE</span>(<span class="variable">@client_ip</span>, <span class="string">&#x27;unknown&#x27;</span>)</span><br><span class="line">    );</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h2 id="审计和监控"><a href="#审计和监控" class="headerlink" title="审计和监控"></a>审计和监控</h2><h3 id="1-审计日志配置"><a href="#1-审计日志配置" class="headerlink" title="1. 审计日志配置"></a>1. 审计日志配置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看审计插件状态</span></span><br><span class="line"><span class="keyword">SHOW</span> PLUGINS;</span><br><span class="line"><span class="keyword">SELECT</span> PLUGIN_NAME, PLUGIN_STATUS </span><br><span class="line"><span class="keyword">FROM</span> information_schema.PLUGINS </span><br><span class="line"><span class="keyword">WHERE</span> PLUGIN_NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%audit%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 审计配置变量</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%audit%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建审计日志表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> mysql_audit_log (</span><br><span class="line">    id <span class="type">BIGINT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    <span class="type">timestamp</span> <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    connection_id <span class="type">INT</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    host <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    command_type <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    sql_text TEXT,</span><br><span class="line">    affected_rows <span class="type">INT</span>,</span><br><span class="line">    execution_time <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">6</span>),</span><br><span class="line">    error_code <span class="type">INT</span>,</span><br><span class="line">    error_message TEXT,</span><br><span class="line">    INDEX idx_timestamp (<span class="type">timestamp</span>),</span><br><span class="line">    INDEX idx_username (username),</span><br><span class="line">    INDEX idx_command_type (command_type)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建审计触发器（简化版本）</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> LogDatabaseActivity(</span><br><span class="line">    <span class="keyword">IN</span> p_username <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="keyword">IN</span> p_command_type <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">IN</span> p_sql_text TEXT,</span><br><span class="line">    <span class="keyword">IN</span> p_affected_rows <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">IN</span> p_execution_time <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">6</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> mysql_audit_log (</span><br><span class="line">        connection_id, username, host, command_type, </span><br><span class="line">        sql_text, affected_rows, execution_time</span><br><span class="line">    ) <span class="keyword">VALUES</span> (</span><br><span class="line">        CONNECTION_ID(), p_username, </span><br><span class="line">        SUBSTRING_INDEX(<span class="keyword">USER</span>(), <span class="string">&#x27;@&#x27;</span>, <span class="number">-1</span>),</span><br><span class="line">        p_command_type, p_sql_text, p_affected_rows, p_execution_time</span><br><span class="line">    );</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询审计日志</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="type">timestamp</span> <span class="keyword">as</span> <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">    username <span class="keyword">as</span> <span class="string">&#x27;用户&#x27;</span>,</span><br><span class="line">    host <span class="keyword">as</span> <span class="string">&#x27;主机&#x27;</span>,</span><br><span class="line">    command_type <span class="keyword">as</span> <span class="string">&#x27;操作类型&#x27;</span>,</span><br><span class="line">    <span class="keyword">LEFT</span>(sql_text, <span class="number">100</span>) <span class="keyword">as</span> <span class="string">&#x27;SQL语句&#x27;</span>,</span><br><span class="line">    affected_rows <span class="keyword">as</span> <span class="string">&#x27;影响行数&#x27;</span>,</span><br><span class="line">    execution_time <span class="keyword">as</span> <span class="string">&#x27;执行时间&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> mysql_audit_log </span><br><span class="line"><span class="keyword">WHERE</span> <span class="type">timestamp</span> <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">timestamp</span> <span class="keyword">DESC</span> </span><br><span class="line">LIMIT <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 敏感操作审计</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="type">DATE</span>(<span class="type">timestamp</span>) <span class="keyword">as</span> <span class="string">&#x27;日期&#x27;</span>,</span><br><span class="line">    username <span class="keyword">as</span> <span class="string">&#x27;用户&#x27;</span>,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> <span class="string">&#x27;操作次数&#x27;</span>,</span><br><span class="line">    GROUP_CONCAT(<span class="keyword">DISTINCT</span> command_type) <span class="keyword">as</span> <span class="string">&#x27;操作类型&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> mysql_audit_log </span><br><span class="line"><span class="keyword">WHERE</span> command_type <span class="keyword">IN</span> (<span class="string">&#x27;DELETE&#x27;</span>, <span class="string">&#x27;DROP&#x27;</span>, <span class="string">&#x27;ALTER&#x27;</span>, <span class="string">&#x27;GRANT&#x27;</span>, <span class="string">&#x27;REVOKE&#x27;</span>)</span><br><span class="line">    <span class="keyword">AND</span> <span class="type">timestamp</span> <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="type">DATE</span>(<span class="type">timestamp</span>), username</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">DATE</span>(<span class="type">timestamp</span>) <span class="keyword">DESC</span>, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-安全监控"><a href="#2-安全监控" class="headerlink" title="2. 安全监控"></a>2. 安全监控</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建安全事件监控表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> security_events (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    event_type ENUM(<span class="string">&#x27;LOGIN_FAILURE&#x27;</span>, <span class="string">&#x27;PRIVILEGE_ESCALATION&#x27;</span>, <span class="string">&#x27;SUSPICIOUS_QUERY&#x27;</span>, <span class="string">&#x27;DATA_EXPORT&#x27;</span>, <span class="string">&#x27;AFTER_HOURS_ACCESS&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    host <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    event_details JSON,</span><br><span class="line">    severity ENUM(<span class="string">&#x27;LOW&#x27;</span>, <span class="string">&#x27;MEDIUM&#x27;</span>, <span class="string">&#x27;HIGH&#x27;</span>, <span class="string">&#x27;CRITICAL&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    event_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    resolved TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    INDEX idx_event_type (event_type),</span><br><span class="line">    INDEX idx_severity (severity),</span><br><span class="line">    INDEX idx_event_time (event_time),</span><br><span class="line">    INDEX idx_resolved (resolved)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 登录失败监控</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> MonitorLoginFailures()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> failed_attempts <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> suspicious_user <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> suspicious_host <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查最近1小时内的登录失败</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>), username, host</span><br><span class="line">    <span class="keyword">INTO</span> failed_attempts, suspicious_user, suspicious_host</span><br><span class="line">    <span class="keyword">FROM</span> mysql_audit_log </span><br><span class="line">    <span class="keyword">WHERE</span> command_type <span class="operator">=</span> <span class="string">&#x27;Connect&#x27;</span> </span><br><span class="line">        <span class="keyword">AND</span> error_code <span class="operator">!=</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">AND</span> <span class="type">timestamp</span> <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>)</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> username, host</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">DESC</span></span><br><span class="line">    LIMIT <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 如果失败次数超过阈值，记录安全事件</span></span><br><span class="line">    IF failed_attempts <span class="operator">&gt;=</span> <span class="number">5</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">INSERT INTO</span> security_events (</span><br><span class="line">            event_type, username, host, event_details, severity</span><br><span class="line">        ) <span class="keyword">VALUES</span> (</span><br><span class="line">            <span class="string">&#x27;LOGIN_FAILURE&#x27;</span>, suspicious_user, suspicious_host,</span><br><span class="line">            <span class="built_in">JSON_OBJECT</span>(<span class="string">&#x27;failed_attempts&#x27;</span>, failed_attempts, <span class="string">&#x27;time_window&#x27;</span>, <span class="string">&#x27;1 hour&#x27;</span>),</span><br><span class="line">            <span class="keyword">CASE</span> </span><br><span class="line">                <span class="keyword">WHEN</span> failed_attempts <span class="operator">&gt;=</span> <span class="number">20</span> <span class="keyword">THEN</span> <span class="string">&#x27;CRITICAL&#x27;</span></span><br><span class="line">                <span class="keyword">WHEN</span> failed_attempts <span class="operator">&gt;=</span> <span class="number">10</span> <span class="keyword">THEN</span> <span class="string">&#x27;HIGH&#x27;</span></span><br><span class="line">                <span class="keyword">ELSE</span> <span class="string">&#x27;MEDIUM&#x27;</span></span><br><span class="line">            <span class="keyword">END</span></span><br><span class="line">        );</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可疑查询监控</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> MonitorSuspiciousQueries()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_username <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_sql_text TEXT;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_timestamp <span class="type">TIMESTAMP</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">DECLARE</span> suspicious_cursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">        <span class="keyword">SELECT</span> username, sql_text, <span class="type">timestamp</span></span><br><span class="line">        <span class="keyword">FROM</span> mysql_audit_log </span><br><span class="line">        <span class="keyword">WHERE</span> <span class="type">timestamp</span> <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>)</span><br><span class="line">            <span class="keyword">AND</span> (</span><br><span class="line">                sql_text <span class="keyword">LIKE</span> <span class="string">&#x27;%SELECT%*%FROM%&#x27;</span> <span class="keyword">OR</span>  <span class="comment">-- 可能的SQL注入</span></span><br><span class="line">                sql_text <span class="keyword">LIKE</span> <span class="string">&#x27;%UNION%SELECT%&#x27;</span> <span class="keyword">OR</span></span><br><span class="line">                sql_text <span class="keyword">LIKE</span> <span class="string">&#x27;%DROP%TABLE%&#x27;</span> <span class="keyword">OR</span></span><br><span class="line">                sql_text <span class="keyword">LIKE</span> <span class="string">&#x27;%DELETE%FROM%users%&#x27;</span> <span class="keyword">OR</span></span><br><span class="line">                sql_text REGEXP <span class="string">&#x27;.*;.*SELECT.*FROM.*information_schema&#x27;</span>  <span class="comment">-- 信息收集</span></span><br><span class="line">            );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done <span class="operator">=</span> <span class="literal">TRUE</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">OPEN</span> suspicious_cursor;</span><br><span class="line">    </span><br><span class="line">    monitor_loop: LOOP</span><br><span class="line">        <span class="keyword">FETCH</span> suspicious_cursor <span class="keyword">INTO</span> v_username, v_sql_text, v_timestamp;</span><br><span class="line">        </span><br><span class="line">        IF done <span class="keyword">THEN</span> LEAVE monitor_loop; <span class="keyword">END</span> IF;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">INSERT INTO</span> security_events (</span><br><span class="line">            event_type, username, event_details, severity</span><br><span class="line">        ) <span class="keyword">VALUES</span> (</span><br><span class="line">            <span class="string">&#x27;SUSPICIOUS_QUERY&#x27;</span>, v_username,</span><br><span class="line">            <span class="built_in">JSON_OBJECT</span>(<span class="string">&#x27;sql_text&#x27;</span>, <span class="keyword">LEFT</span>(v_sql_text, <span class="number">500</span>), <span class="string">&#x27;timestamp&#x27;</span>, v_timestamp),</span><br><span class="line">            <span class="string">&#x27;HIGH&#x27;</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">CLOSE</span> suspicious_cursor;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据导出监控</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> MonitorDataExport()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> large_export_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查大量数据导出</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">INTO</span> large_export_count</span><br><span class="line">    <span class="keyword">FROM</span> mysql_audit_log </span><br><span class="line">    <span class="keyword">WHERE</span> command_type <span class="operator">=</span> <span class="string">&#x27;SELECT&#x27;</span></span><br><span class="line">        <span class="keyword">AND</span> affected_rows <span class="operator">&gt;</span> <span class="number">10000</span></span><br><span class="line">        <span class="keyword">AND</span> <span class="type">timestamp</span> <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>);</span><br><span class="line">    </span><br><span class="line">    IF large_export_count <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">INSERT INTO</span> security_events (</span><br><span class="line">            event_type, event_details, severity</span><br><span class="line">        ) <span class="keyword">VALUES</span> (</span><br><span class="line">            <span class="string">&#x27;DATA_EXPORT&#x27;</span>,</span><br><span class="line">            <span class="built_in">JSON_OBJECT</span>(<span class="string">&#x27;large_exports&#x27;</span>, large_export_count, <span class="string">&#x27;threshold&#x27;</span>, <span class="number">10000</span>),</span><br><span class="line">            <span class="string">&#x27;MEDIUM&#x27;</span></span><br><span class="line">        );</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 非工作时间访问监控</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> MonitorAfterHoursAccess()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> after_hours_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> current_hour <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="keyword">HOUR</span>(NOW());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查非工作时间（晚上10点到早上6点）的访问</span></span><br><span class="line">    IF current_hour <span class="operator">&gt;=</span> <span class="number">22</span> <span class="keyword">OR</span> current_hour <span class="operator">&lt;=</span> <span class="number">6</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line">        <span class="keyword">INTO</span> after_hours_count</span><br><span class="line">        <span class="keyword">FROM</span> mysql_audit_log </span><br><span class="line">        <span class="keyword">WHERE</span> <span class="type">timestamp</span> <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>)</span><br><span class="line">            <span class="keyword">AND</span> command_type <span class="keyword">IN</span> (<span class="string">&#x27;SELECT&#x27;</span>, <span class="string">&#x27;INSERT&#x27;</span>, <span class="string">&#x27;UPDATE&#x27;</span>, <span class="string">&#x27;DELETE&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        IF after_hours_count <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">THEN</span></span><br><span class="line">            <span class="keyword">INSERT INTO</span> security_events (</span><br><span class="line">                event_type, event_details, severity</span><br><span class="line">            ) <span class="keyword">VALUES</span> (</span><br><span class="line">                <span class="string">&#x27;AFTER_HOURS_ACCESS&#x27;</span>,</span><br><span class="line">                <span class="built_in">JSON_OBJECT</span>(<span class="string">&#x27;activity_count&#x27;</span>, after_hours_count, <span class="string">&#x27;hour&#x27;</span>, current_hour),</span><br><span class="line">                <span class="string">&#x27;MEDIUM&#x27;</span></span><br><span class="line">            );</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 综合安全监控存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> RunSecurityMonitoring()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">CALL</span> MonitorLoginFailures();</span><br><span class="line">    <span class="keyword">CALL</span> MonitorSuspiciousQueries();</span><br><span class="line">    <span class="keyword">CALL</span> MonitorDataExport();</span><br><span class="line">    <span class="keyword">CALL</span> MonitorAfterHoursAccess();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 生成安全报告</span></span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        event_type <span class="keyword">as</span> <span class="string">&#x27;事件类型&#x27;</span>,</span><br><span class="line">        <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> <span class="string">&#x27;事件数量&#x27;</span>,</span><br><span class="line">        <span class="built_in">MAX</span>(severity) <span class="keyword">as</span> <span class="string">&#x27;最高严重级别&#x27;</span>,</span><br><span class="line">        <span class="built_in">MAX</span>(event_time) <span class="keyword">as</span> <span class="string">&#x27;最新事件时间&#x27;</span></span><br><span class="line">    <span class="keyword">FROM</span> security_events </span><br><span class="line">    <span class="keyword">WHERE</span> event_time <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">24</span> <span class="keyword">HOUR</span>)</span><br><span class="line">        <span class="keyword">AND</span> resolved <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> event_type</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> </span><br><span class="line">        <span class="keyword">CASE</span> <span class="built_in">MAX</span>(severity)</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;CRITICAL&#x27;</span> <span class="keyword">THEN</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;HIGH&#x27;</span> <span class="keyword">THEN</span> <span class="number">2</span></span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;MEDIUM&#x27;</span> <span class="keyword">THEN</span> <span class="number">3</span></span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;LOW&#x27;</span> <span class="keyword">THEN</span> <span class="number">4</span></span><br><span class="line">        <span class="keyword">END</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行安全监控</span></span><br><span class="line"><span class="keyword">CALL</span> RunSecurityMonitoring();</span><br></pre></td></tr></table></figure>

<h3 id="3-性能和安全指标监控"><a href="#3-性能和安全指标监控" class="headerlink" title="3. 性能和安全指标监控"></a>3. 性能和安全指标监控</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建安全指标监控视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> security_metrics <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;Active Connections&#x27;</span> <span class="keyword">as</span> metric_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> metric_value,</span><br><span class="line">    <span class="string">&#x27;connections&#x27;</span> <span class="keyword">as</span> unit,</span><br><span class="line">    NOW() <span class="keyword">as</span> measured_at</span><br><span class="line"><span class="keyword">FROM</span> information_schema.PROCESSLIST</span><br><span class="line"><span class="keyword">WHERE</span> COMMAND <span class="operator">!=</span> <span class="string">&#x27;Sleep&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;Failed Login Attempts (Last Hour)&#x27;</span> <span class="keyword">as</span> metric_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> metric_value,</span><br><span class="line">    <span class="string">&#x27;attempts&#x27;</span> <span class="keyword">as</span> unit,</span><br><span class="line">    NOW() <span class="keyword">as</span> measured_at</span><br><span class="line"><span class="keyword">FROM</span> mysql_audit_log </span><br><span class="line"><span class="keyword">WHERE</span> command_type <span class="operator">=</span> <span class="string">&#x27;Connect&#x27;</span> </span><br><span class="line">    <span class="keyword">AND</span> error_code <span class="operator">!=</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">AND</span> <span class="type">timestamp</span> <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;Privileged Operations (Last Hour)&#x27;</span> <span class="keyword">as</span> metric_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> metric_value,</span><br><span class="line">    <span class="string">&#x27;operations&#x27;</span> <span class="keyword">as</span> unit,</span><br><span class="line">    NOW() <span class="keyword">as</span> measured_at</span><br><span class="line"><span class="keyword">FROM</span> mysql_audit_log </span><br><span class="line"><span class="keyword">WHERE</span> command_type <span class="keyword">IN</span> (<span class="string">&#x27;GRANT&#x27;</span>, <span class="string">&#x27;REVOKE&#x27;</span>, <span class="string">&#x27;CREATE USER&#x27;</span>, <span class="string">&#x27;DROP USER&#x27;</span>)</span><br><span class="line">    <span class="keyword">AND</span> <span class="type">timestamp</span> <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;Large Data Exports (Last Hour)&#x27;</span> <span class="keyword">as</span> metric_name,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> metric_value,</span><br><span class="line">    <span class="string">&#x27;queries&#x27;</span> <span class="keyword">as</span> unit,</span><br><span class="line">    NOW() <span class="keyword">as</span> measured_at</span><br><span class="line"><span class="keyword">FROM</span> mysql_audit_log </span><br><span class="line"><span class="keyword">WHERE</span> command_type <span class="operator">=</span> <span class="string">&#x27;SELECT&#x27;</span></span><br><span class="line">    <span class="keyword">AND</span> affected_rows <span class="operator">&gt;</span> <span class="number">1000</span></span><br><span class="line">    <span class="keyword">AND</span> <span class="type">timestamp</span> <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">HOUR</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看安全指标</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> security_metrics;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建安全告警规则</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> security_alert_rules (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    rule_name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    metric_name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    threshold_value <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    comparison_operator ENUM(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&gt;=&#x27;</span>, <span class="string">&#x27;&lt;=&#x27;</span>, <span class="string">&#x27;=&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    severity ENUM(<span class="string">&#x27;LOW&#x27;</span>, <span class="string">&#x27;MEDIUM&#x27;</span>, <span class="string">&#x27;HIGH&#x27;</span>, <span class="string">&#x27;CRITICAL&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    is_active TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入告警规则</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> security_alert_rules (rule_name, metric_name, threshold_value, comparison_operator, severity) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;High Connection Count&#x27;</span>, <span class="string">&#x27;Active Connections&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;MEDIUM&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;Excessive Login Failures&#x27;</span>, <span class="string">&#x27;Failed Login Attempts (Last Hour)&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;HIGH&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;Suspicious Privilege Operations&#x27;</span>, <span class="string">&#x27;Privileged Operations (Last Hour)&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;HIGH&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;Large Data Export Alert&#x27;</span>, <span class="string">&#x27;Large Data Exports (Last Hour)&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;MEDIUM&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 告警检查存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> CheckSecurityAlerts()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_rule_name <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_metric_name <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_threshold <span class="type">INT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_operator <span class="type">VARCHAR</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_severity <span class="type">VARCHAR</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_current_value <span class="type">INT</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">DECLARE</span> alert_cursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">        <span class="keyword">SELECT</span> rule_name, metric_name, threshold_value, comparison_operator, severity</span><br><span class="line">        <span class="keyword">FROM</span> security_alert_rules </span><br><span class="line">        <span class="keyword">WHERE</span> is_active <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done <span class="operator">=</span> <span class="literal">TRUE</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">OPEN</span> alert_cursor;</span><br><span class="line">    </span><br><span class="line">    alert_loop: LOOP</span><br><span class="line">        <span class="keyword">FETCH</span> alert_cursor <span class="keyword">INTO</span> v_rule_name, v_metric_name, v_threshold, v_operator, v_severity;</span><br><span class="line">        </span><br><span class="line">        IF done <span class="keyword">THEN</span> LEAVE alert_loop; <span class="keyword">END</span> IF;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- 获取当前指标值</span></span><br><span class="line">        <span class="keyword">SELECT</span> metric_value <span class="keyword">INTO</span> v_current_value</span><br><span class="line">        <span class="keyword">FROM</span> security_metrics </span><br><span class="line">        <span class="keyword">WHERE</span> metric_name <span class="operator">=</span> v_metric_name;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- 检查是否触发告警</span></span><br><span class="line">        <span class="keyword">SET</span> <span class="variable">@check_sql</span> <span class="operator">=</span> CONCAT(<span class="string">&#x27;SELECT &#x27;</span>, v_current_value, <span class="string">&#x27; &#x27;</span>, v_operator, <span class="string">&#x27; &#x27;</span>, v_threshold);</span><br><span class="line">        <span class="keyword">PREPARE</span> stmt <span class="keyword">FROM</span> <span class="variable">@check_sql</span>;</span><br><span class="line">        <span class="keyword">EXECUTE</span> stmt;</span><br><span class="line">        <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> stmt;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- 如果触发告警，记录事件</span></span><br><span class="line">        IF <span class="variable">@check_sql</span> <span class="keyword">THEN</span></span><br><span class="line">            <span class="keyword">INSERT INTO</span> security_events (</span><br><span class="line">                event_type, event_details, severity</span><br><span class="line">            ) <span class="keyword">VALUES</span> (</span><br><span class="line">                <span class="string">&#x27;THRESHOLD_EXCEEDED&#x27;</span>,</span><br><span class="line">                <span class="built_in">JSON_OBJECT</span>(</span><br><span class="line">                    <span class="string">&#x27;rule_name&#x27;</span>, v_rule_name,</span><br><span class="line">                    <span class="string">&#x27;metric_name&#x27;</span>, v_metric_name,</span><br><span class="line">                    <span class="string">&#x27;current_value&#x27;</span>, v_current_value,</span><br><span class="line">                    <span class="string">&#x27;threshold&#x27;</span>, v_threshold</span><br><span class="line">                ),</span><br><span class="line">                v_severity</span><br><span class="line">            );</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">CLOSE</span> alert_cursor;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h2 id="网络安全配置"><a href="#网络安全配置" class="headerlink" title="网络安全配置"></a>网络安全配置</h2><h3 id="1-防火墙和网络访问控制"><a href="#1-防火墙和网络访问控制" class="headerlink" title="1. 防火墙和网络访问控制"></a>1. 防火墙和网络访问控制</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看当前连接信息</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    ID <span class="keyword">as</span> <span class="string">&#x27;连接ID&#x27;</span>,</span><br><span class="line">    <span class="keyword">USER</span> <span class="keyword">as</span> <span class="string">&#x27;用户&#x27;</span>,</span><br><span class="line">    HOST <span class="keyword">as</span> <span class="string">&#x27;主机&#x27;</span>,</span><br><span class="line">    DB <span class="keyword">as</span> <span class="string">&#x27;数据库&#x27;</span>,</span><br><span class="line">    COMMAND <span class="keyword">as</span> <span class="string">&#x27;命令&#x27;</span>,</span><br><span class="line">    <span class="type">TIME</span> <span class="keyword">as</span> <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">    STATE <span class="keyword">as</span> <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">    INFO <span class="keyword">as</span> <span class="string">&#x27;查询信息&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> information_schema.PROCESSLIST </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">TIME</span> <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建IP白名单表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> ip_whitelist (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    ip_address <span class="type">VARCHAR</span>(<span class="number">45</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    ip_range <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    description <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    is_active TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    updated_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> KEY uk_ip_address (ip_address)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入允许的IP地址</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> ip_whitelist (ip_address, ip_range, description) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;192.168.1.100&#x27;</span>, <span class="string">&#x27;192.168.1.0/24&#x27;</span>, <span class="string">&#x27;办公网络&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;10.0.0.50&#x27;</span>, <span class="string">&#x27;10.0.0.0/16&#x27;</span>, <span class="string">&#x27;内网服务器&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;172.16.1.10&#x27;</span>, <span class="string">&#x27;172.16.1.0/24&#x27;</span>, <span class="string">&#x27;开发环境&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;127.0.0.1/32&#x27;</span>, <span class="string">&#x27;本地连接&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- IP访问控制检查函数</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> IsIPAllowed(client_ip <span class="type">VARCHAR</span>(<span class="number">45</span>))</span><br><span class="line"><span class="keyword">RETURNS</span> TINYINT</span><br><span class="line"><span class="keyword">READS</span> <span class="keyword">SQL</span> DATA</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> ip_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查精确IP匹配</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> ip_count</span><br><span class="line">    <span class="keyword">FROM</span> ip_whitelist </span><br><span class="line">    <span class="keyword">WHERE</span> ip_address <span class="operator">=</span> client_ip <span class="keyword">AND</span> is_active <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    IF ip_count <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">RETURN</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查IP范围匹配（简化版本）</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> ip_count</span><br><span class="line">    <span class="keyword">FROM</span> ip_whitelist </span><br><span class="line">    <span class="keyword">WHERE</span> is_active <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">AND</span> (</span><br><span class="line">            (ip_range <span class="keyword">LIKE</span> <span class="string">&#x27;192.168.%&#x27;</span> <span class="keyword">AND</span> client_ip <span class="keyword">LIKE</span> <span class="string">&#x27;192.168.%&#x27;</span>) <span class="keyword">OR</span></span><br><span class="line">            (ip_range <span class="keyword">LIKE</span> <span class="string">&#x27;10.%&#x27;</span> <span class="keyword">AND</span> client_ip <span class="keyword">LIKE</span> <span class="string">&#x27;10.%&#x27;</span>) <span class="keyword">OR</span></span><br><span class="line">            (ip_range <span class="keyword">LIKE</span> <span class="string">&#x27;172.16.%&#x27;</span> <span class="keyword">AND</span> client_ip <span class="keyword">LIKE</span> <span class="string">&#x27;172.16.%&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">RETURN</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> ip_count <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 连接监控和限制</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> connection_limits (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    max_connections <span class="type">INT</span> <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="number">10</span>,</span><br><span class="line">    max_connections_per_hour <span class="type">INT</span> <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="number">100</span>,</span><br><span class="line">    max_queries_per_hour <span class="type">INT</span> <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1000</span>,</span><br><span class="line">    is_active TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> KEY uk_username (username)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置用户连接限制</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> connection_limits (username, max_connections, max_connections_per_hour, max_queries_per_hour) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;app_readonly&#x27;</span>, <span class="number">5</span>, <span class="number">50</span>, <span class="number">500</span>),</span><br><span class="line">(<span class="string">&#x27;app_readwrite&#x27;</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>),</span><br><span class="line">(<span class="string">&#x27;report_user&#x27;</span>, <span class="number">3</span>, <span class="number">20</span>, <span class="number">200</span>),</span><br><span class="line">(<span class="string">&#x27;analyst&#x27;</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 应用连接限制</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;app_readonly&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">WITH</span> MAX_CONNECTIONS_PER_HOUR <span class="number">50</span> MAX_QUERIES_PER_HOUR <span class="number">500</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;app_readwrite&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">WITH</span> MAX_CONNECTIONS_PER_HOUR <span class="number">100</span> MAX_QUERIES_PER_HOUR <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-数据库配置安全"><a href="#2-数据库配置安全" class="headerlink" title="2. 数据库配置安全"></a>2. 数据库配置安全</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 安全配置检查</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;配置项&#x27;</span> <span class="keyword">as</span> config_item,</span><br><span class="line">    <span class="string">&#x27;当前值&#x27;</span> <span class="keyword">as</span> current_value,</span><br><span class="line">    <span class="string">&#x27;建议值&#x27;</span> <span class="keyword">as</span> recommended_value,</span><br><span class="line">    <span class="string">&#x27;安全级别&#x27;</span> <span class="keyword">as</span> security_level</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;local_infile&#x27;</span>, @<span class="variable">@local_infile</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;HIGH&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;secure_file_priv&#x27;</span>, @<span class="variable">@secure_file_priv</span>, <span class="string">&#x27;指定目录&#x27;</span>, <span class="string">&#x27;HIGH&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;sql_mode&#x27;</span>, @<span class="variable">@sql_mode</span>, <span class="string">&#x27;包含STRICT_TRANS_TABLES&#x27;</span>, <span class="string">&#x27;MEDIUM&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;log_bin&#x27;</span>, @<span class="variable">@log_bin</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;MEDIUM&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;general_log&#x27;</span>, @<span class="variable">@general_log</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;MEDIUM&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;slow_query_log&#x27;</span>, @<span class="variable">@slow_query_log</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;LOW&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建安全配置检查存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> CheckSecurityConfiguration()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> security_config_check (</span><br><span class="line">        config_name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">        current_value <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">        is_secure TINYINT,</span><br><span class="line">        recommendation TEXT</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查local_infile</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> security_config_check <span class="keyword">VALUES</span> (</span><br><span class="line">        <span class="string">&#x27;local_infile&#x27;</span>,</span><br><span class="line">        @<span class="variable">@local_infile</span>,</span><br><span class="line">        <span class="keyword">CASE</span> <span class="keyword">WHEN</span> @<span class="variable">@local_infile</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>,</span><br><span class="line">        <span class="string">&#x27;应该禁用以防止本地文件读取攻击&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查secure_file_priv</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> security_config_check <span class="keyword">VALUES</span> (</span><br><span class="line">        <span class="string">&#x27;secure_file_priv&#x27;</span>,</span><br><span class="line">        @<span class="variable">@secure_file_priv</span>,</span><br><span class="line">        <span class="keyword">CASE</span> <span class="keyword">WHEN</span> @<span class="variable">@secure_file_priv</span> <span class="keyword">IS</span> <span class="keyword">NOT NULL</span> <span class="keyword">AND</span> @<span class="variable">@secure_file_priv</span> <span class="operator">!=</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>,</span><br><span class="line">        <span class="string">&#x27;应该设置为特定目录以限制文件操作&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查skip_networking</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> security_config_check <span class="keyword">VALUES</span> (</span><br><span class="line">        <span class="string">&#x27;skip_networking&#x27;</span>,</span><br><span class="line">        @<span class="variable">@skip_networking</span>,</span><br><span class="line">        @<span class="variable">@skip_networking</span>,</span><br><span class="line">        <span class="string">&#x27;如果只需要本地连接，建议启用&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 输出检查结果</span></span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        config_name <span class="keyword">as</span> <span class="string">&#x27;配置项&#x27;</span>,</span><br><span class="line">        current_value <span class="keyword">as</span> <span class="string">&#x27;当前值&#x27;</span>,</span><br><span class="line">        <span class="keyword">CASE</span> is_secure <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;安全&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;不安全&#x27;</span> <span class="keyword">END</span> <span class="keyword">as</span> <span class="string">&#x27;安全状态&#x27;</span>,</span><br><span class="line">        recommendation <span class="keyword">as</span> <span class="string">&#x27;建议&#x27;</span></span><br><span class="line">    <span class="keyword">FROM</span> security_config_check;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">DROP</span> TEMPORARY <span class="keyword">TABLE</span> security_config_check;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行安全配置检查</span></span><br><span class="line"><span class="keyword">CALL</span> CheckSecurityConfiguration();</span><br></pre></td></tr></table></figure>

<h2 id="备份和恢复安全"><a href="#备份和恢复安全" class="headerlink" title="备份和恢复安全"></a>备份和恢复安全</h2><h3 id="1-安全备份策略"><a href="#1-安全备份策略" class="headerlink" title="1. 安全备份策略"></a>1. 安全备份策略</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建备份任务表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> backup_tasks (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    task_name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    database_name <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    backup_type ENUM(<span class="string">&#x27;FULL&#x27;</span>, <span class="string">&#x27;INCREMENTAL&#x27;</span>, <span class="string">&#x27;DIFFERENTIAL&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    backup_path <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    encryption_enabled TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    compression_enabled TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    schedule_cron <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    retention_days <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">30</span>,</span><br><span class="line">    is_active TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    INDEX idx_database_name (database_name),</span><br><span class="line">    INDEX idx_schedule (schedule_cron, is_active)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入备份任务</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> backup_tasks (task_name, database_name, backup_type, backup_path, schedule_cron) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;Daily Full Backup&#x27;</span>, <span class="string">&#x27;myapp&#x27;</span>, <span class="string">&#x27;FULL&#x27;</span>, <span class="string">&#x27;/backup/mysql/daily/&#x27;</span>, <span class="string">&#x27;0 2 * * *&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;Hourly Incremental&#x27;</span>, <span class="string">&#x27;myapp&#x27;</span>, <span class="string">&#x27;INCREMENTAL&#x27;</span>, <span class="string">&#x27;/backup/mysql/incremental/&#x27;</span>, <span class="string">&#x27;0 * * * *&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;Weekly Archive&#x27;</span>, <span class="string">&#x27;myapp&#x27;</span>, <span class="string">&#x27;FULL&#x27;</span>, <span class="string">&#x27;/backup/mysql/archive/&#x27;</span>, <span class="string">&#x27;0 1 * * 0&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 备份执行日志</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> backup_execution_log (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    task_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    start_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    end_time <span class="type">TIMESTAMP</span> <span class="keyword">NULL</span>,</span><br><span class="line">    status ENUM(<span class="string">&#x27;RUNNING&#x27;</span>, <span class="string">&#x27;SUCCESS&#x27;</span>, <span class="string">&#x27;FAILED&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    backup_file_path <span class="type">VARCHAR</span>(<span class="number">500</span>),</span><br><span class="line">    backup_size_mb <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>),</span><br><span class="line">    error_message TEXT,</span><br><span class="line">    checksum <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (task_id) <span class="keyword">REFERENCES</span> backup_tasks(id),</span><br><span class="line">    INDEX idx_task_id (task_id),</span><br><span class="line">    INDEX idx_start_time (start_time),</span><br><span class="line">    INDEX idx_status (status)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 备份执行存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ExecuteBackup(<span class="keyword">IN</span> task_id <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> v_task_name <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_database_name <span class="type">VARCHAR</span>(<span class="number">64</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_backup_type <span class="type">VARCHAR</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_backup_path <span class="type">VARCHAR</span>(<span class="number">255</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_encryption_enabled TINYINT;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_backup_file <span class="type">VARCHAR</span>(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_log_id <span class="type">INT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_start_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> NOW();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 获取备份任务信息</span></span><br><span class="line">    <span class="keyword">SELECT</span> task_name, database_name, backup_type, backup_path, encryption_enabled</span><br><span class="line">    <span class="keyword">INTO</span> v_task_name, v_database_name, v_backup_type, v_backup_path, v_encryption_enabled</span><br><span class="line">    <span class="keyword">FROM</span> backup_tasks </span><br><span class="line">    <span class="keyword">WHERE</span> id <span class="operator">=</span> task_id <span class="keyword">AND</span> is_active <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 生成备份文件名</span></span><br><span class="line">    <span class="keyword">SET</span> v_backup_file <span class="operator">=</span> CONCAT(</span><br><span class="line">        v_backup_path,</span><br><span class="line">        v_database_name, <span class="string">&#x27;_&#x27;</span>,</span><br><span class="line">        v_backup_type, <span class="string">&#x27;_&#x27;</span>,</span><br><span class="line">        DATE_FORMAT(NOW(), <span class="string">&#x27;%Y%m%d_%H%i%s&#x27;</span>),</span><br><span class="line">        <span class="keyword">CASE</span> <span class="keyword">WHEN</span> v_encryption_enabled <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;.sql.enc&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;.sql&#x27;</span> <span class="keyword">END</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 记录备份开始</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> backup_execution_log (task_id, start_time, status, backup_file_path)</span><br><span class="line">    <span class="keyword">VALUES</span> (task_id, v_start_time, <span class="string">&#x27;RUNNING&#x27;</span>, v_backup_file);</span><br><span class="line">    <span class="keyword">SET</span> v_log_id <span class="operator">=</span> LAST_INSERT_ID();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 这里应该调用实际的备份命令</span></span><br><span class="line">    <span class="comment">-- 由于在SQL中无法直接执行系统命令，这里只是示例</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 模拟备份完成</span></span><br><span class="line">    <span class="keyword">UPDATE</span> backup_execution_log </span><br><span class="line">    <span class="keyword">SET</span> </span><br><span class="line">        end_time <span class="operator">=</span> NOW(),</span><br><span class="line">        status <span class="operator">=</span> <span class="string">&#x27;SUCCESS&#x27;</span>,</span><br><span class="line">        backup_size_mb <span class="operator">=</span> <span class="number">150.5</span>,</span><br><span class="line">        checksum <span class="operator">=</span> MD5(CONCAT(v_backup_file, NOW()))</span><br><span class="line">    <span class="keyword">WHERE</span> id <span class="operator">=</span> v_log_id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;备份任务 &#x27;</span>, v_task_name, <span class="string">&#x27; 执行完成&#x27;</span>) <span class="keyword">as</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 备份验证存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> VerifyBackup(<span class="keyword">IN</span> log_id <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> v_backup_file <span class="type">VARCHAR</span>(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_checksum <span class="type">VARCHAR</span>(<span class="number">64</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_verification_result TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> backup_file_path, checksum</span><br><span class="line">    <span class="keyword">INTO</span> v_backup_file, v_checksum</span><br><span class="line">    <span class="keyword">FROM</span> backup_execution_log </span><br><span class="line">    <span class="keyword">WHERE</span> id <span class="operator">=</span> log_id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 这里应该验证备份文件的完整性</span></span><br><span class="line">    <span class="comment">-- 实际实现中需要调用系统命令验证文件</span></span><br><span class="line">    <span class="keyword">SET</span> v_verification_result <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- 假设验证成功</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 记录验证结果</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> backup_verification_log (</span><br><span class="line">        backup_log_id, verification_time, is_valid, verification_details</span><br><span class="line">    ) <span class="keyword">VALUES</span> (</span><br><span class="line">        log_id, NOW(), v_verification_result,</span><br><span class="line">        <span class="built_in">JSON_OBJECT</span>(<span class="string">&#x27;file_path&#x27;</span>, v_backup_file, <span class="string">&#x27;checksum_match&#x27;</span>, v_verification_result)</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        <span class="keyword">CASE</span> v_verification_result </span><br><span class="line">            <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;备份验证成功&#x27;</span> </span><br><span class="line">            <span class="keyword">ELSE</span> <span class="string">&#x27;备份验证失败&#x27;</span> </span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">as</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建备份验证日志表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> backup_verification_log (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    backup_log_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    verification_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    is_valid TINYINT <span class="keyword">NOT NULL</span>,</span><br><span class="line">    verification_details JSON,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (backup_log_id) <span class="keyword">REFERENCES</span> backup_execution_log(id),</span><br><span class="line">    INDEX idx_backup_log_id (backup_log_id),</span><br><span class="line">    INDEX idx_verification_time (verification_time)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="2-恢复测试和验证"><a href="#2-恢复测试和验证" class="headerlink" title="2. 恢复测试和验证"></a>2. 恢复测试和验证</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建恢复测试表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> recovery_tests (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    test_name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    backup_log_id <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    test_database <span class="type">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    test_start_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    test_end_time <span class="type">TIMESTAMP</span> <span class="keyword">NULL</span>,</span><br><span class="line">    test_status ENUM(<span class="string">&#x27;RUNNING&#x27;</span>, <span class="string">&#x27;SUCCESS&#x27;</span>, <span class="string">&#x27;FAILED&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    recovery_time_seconds <span class="type">INT</span>,</span><br><span class="line">    data_integrity_check TINYINT,</span><br><span class="line">    error_details TEXT,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (backup_log_id) <span class="keyword">REFERENCES</span> backup_execution_log(id),</span><br><span class="line">    INDEX idx_backup_log_id (backup_log_id),</span><br><span class="line">    INDEX idx_test_start_time (test_start_time)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 恢复测试存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> TestBackupRecovery(</span><br><span class="line">    <span class="keyword">IN</span> backup_log_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">IN</span> test_db_name <span class="type">VARCHAR</span>(<span class="number">64</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> v_backup_file <span class="type">VARCHAR</span>(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_test_id <span class="type">INT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_start_time <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> NOW();</span><br><span class="line">    <span class="keyword">DECLARE</span> v_recovery_success TINYINT <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 获取备份文件信息</span></span><br><span class="line">    <span class="keyword">SELECT</span> backup_file_path <span class="keyword">INTO</span> v_backup_file</span><br><span class="line">    <span class="keyword">FROM</span> backup_execution_log </span><br><span class="line">    <span class="keyword">WHERE</span> id <span class="operator">=</span> backup_log_id <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;SUCCESS&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    IF v_backup_file <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">THEN</span></span><br><span class="line">        SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;45000&#x27;</span> <span class="keyword">SET</span> MESSAGE_TEXT <span class="operator">=</span> <span class="string">&#x27;备份文件不存在或备份未成功&#x27;</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 记录测试开始</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> recovery_tests (</span><br><span class="line">        test_name, backup_log_id, test_database, test_status</span><br><span class="line">    ) <span class="keyword">VALUES</span> (</span><br><span class="line">        CONCAT(<span class="string">&#x27;Recovery Test &#x27;</span>, DATE_FORMAT(NOW(), <span class="string">&#x27;%Y%m%d_%H%i%s&#x27;</span>)),</span><br><span class="line">        backup_log_id, test_db_name, <span class="string">&#x27;RUNNING&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">SET</span> v_test_id <span class="operator">=</span> LAST_INSERT_ID();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 这里应该执行实际的恢复操作</span></span><br><span class="line">    <span class="comment">-- 1. 创建测试数据库</span></span><br><span class="line">    <span class="comment">-- 2. 恢复备份数据</span></span><br><span class="line">    <span class="comment">-- 3. 验证数据完整性</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 模拟恢复成功</span></span><br><span class="line">    <span class="keyword">SET</span> v_recovery_success <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 更新测试结果</span></span><br><span class="line">    <span class="keyword">UPDATE</span> recovery_tests </span><br><span class="line">    <span class="keyword">SET</span> </span><br><span class="line">        test_end_time <span class="operator">=</span> NOW(),</span><br><span class="line">        test_status <span class="operator">=</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> v_recovery_success <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;SUCCESS&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;FAILED&#x27;</span> <span class="keyword">END</span>,</span><br><span class="line">        recovery_time_seconds <span class="operator">=</span> TIMESTAMPDIFF(<span class="keyword">SECOND</span>, v_start_time, NOW()),</span><br><span class="line">        data_integrity_check <span class="operator">=</span> v_recovery_success</span><br><span class="line">    <span class="keyword">WHERE</span> id <span class="operator">=</span> v_test_id;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        <span class="keyword">CASE</span> v_recovery_success </span><br><span class="line">            <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;恢复测试成功&#x27;</span> </span><br><span class="line">            <span class="keyword">ELSE</span> <span class="string">&#x27;恢复测试失败&#x27;</span> </span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">as</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h2 id="安全最佳实践总结"><a href="#安全最佳实践总结" class="headerlink" title="安全最佳实践总结"></a>安全最佳实践总结</h2><h3 id="1-安全检查清单"><a href="#1-安全检查清单" class="headerlink" title="1. 安全检查清单"></a>1. 安全检查清单</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建安全检查清单视图</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> security_checklist <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;用户管理&#x27;</span> <span class="keyword">as</span> category,</span><br><span class="line">    <span class="string">&#x27;删除默认用户账户&#x27;</span> <span class="keyword">as</span> check_item,</span><br><span class="line">    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> mysql.user <span class="keyword">WHERE</span> <span class="keyword">User</span> <span class="operator">=</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">OR</span> <span class="keyword">User</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span> <span class="keyword">AND</span> Host <span class="operator">!=</span> <span class="string">&#x27;localhost&#x27;</span>) <span class="operator">=</span> <span class="number">0</span> </span><br><span class="line">         <span class="keyword">THEN</span> <span class="string">&#x27;通过&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;失败&#x27;</span> <span class="keyword">END</span> <span class="keyword">as</span> status,</span><br><span class="line">    <span class="string">&#x27;删除匿名用户和远程root用户&#x27;</span> <span class="keyword">as</span> description</span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;用户管理&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;密码策略&#x27;</span>,</span><br><span class="line">    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> @<span class="variable">@validate_password</span>.policy <span class="operator">=</span> <span class="string">&#x27;STRONG&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;通过&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;需要改进&#x27;</span> <span class="keyword">END</span>,</span><br><span class="line">    <span class="string">&#x27;启用强密码策略&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;网络安全&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SSL/TLS加密&#x27;</span>,</span><br><span class="line">    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> @<span class="variable">@have_ssl</span> <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;通过&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;失败&#x27;</span> <span class="keyword">END</span>,</span><br><span class="line">    <span class="string">&#x27;启用SSL/TLS传输加密&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;配置安全&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;禁用local_infile&#x27;</span>,</span><br><span class="line">    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> @<span class="variable">@local_infile</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;通过&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;失败&#x27;</span> <span class="keyword">END</span>,</span><br><span class="line">    <span class="string">&#x27;防止本地文件读取攻击&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;配置安全&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;设置secure_file_priv&#x27;</span>,</span><br><span class="line">    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> @<span class="variable">@secure_file_priv</span> <span class="keyword">IS</span> <span class="keyword">NOT NULL</span> <span class="keyword">AND</span> @<span class="variable">@secure_file_priv</span> <span class="operator">!=</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;通过&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;失败&#x27;</span> <span class="keyword">END</span>,</span><br><span class="line">    <span class="string">&#x27;限制文件操作目录&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;审计监控&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;启用审计日志&#x27;</span>,</span><br><span class="line">    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> information_schema.PLUGINS <span class="keyword">WHERE</span> PLUGIN_NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%audit%&#x27;</span> <span class="keyword">AND</span> PLUGIN_STATUS <span class="operator">=</span> <span class="string">&#x27;ACTIVE&#x27;</span>) <span class="operator">&gt;</span> <span class="number">0</span> </span><br><span class="line">         <span class="keyword">THEN</span> <span class="string">&#x27;通过&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;需要配置&#x27;</span> <span class="keyword">END</span>,</span><br><span class="line">    <span class="string">&#x27;记录数据库操作日志&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="string">&#x27;备份安全&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;定期备份测试&#x27;</span>,</span><br><span class="line">    <span class="keyword">CASE</span> <span class="keyword">WHEN</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> recovery_tests <span class="keyword">WHERE</span> test_start_time <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>)) <span class="operator">&gt;</span> <span class="number">0</span> </span><br><span class="line">         <span class="keyword">THEN</span> <span class="string">&#x27;通过&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;需要执行&#x27;</span> <span class="keyword">END</span>,</span><br><span class="line">    <span class="string">&#x27;定期测试备份恢复功能&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看安全检查结果</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> security_checklist <span class="keyword">ORDER</span> <span class="keyword">BY</span> category, check_item;</span><br></pre></td></tr></table></figure>

<h3 id="2-安全维护计划"><a href="#2-安全维护计划" class="headerlink" title="2. 安全维护计划"></a>2. 安全维护计划</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建安全维护任务表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> security_maintenance_tasks (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    task_name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    task_type ENUM(<span class="string">&#x27;PASSWORD_ROTATION&#x27;</span>, <span class="string">&#x27;PRIVILEGE_REVIEW&#x27;</span>, <span class="string">&#x27;SECURITY_SCAN&#x27;</span>, <span class="string">&#x27;BACKUP_TEST&#x27;</span>, <span class="string">&#x27;LOG_CLEANUP&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    frequency_days <span class="type">INT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    last_executed <span class="type">TIMESTAMP</span> <span class="keyword">NULL</span>,</span><br><span class="line">    next_execution <span class="type">TIMESTAMP</span> <span class="keyword">NULL</span>,</span><br><span class="line">    is_active TINYINT <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    task_description TEXT,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入维护任务</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> security_maintenance_tasks (task_name, task_type, frequency_days, task_description) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;用户密码轮换&#x27;</span>, <span class="string">&#x27;PASSWORD_ROTATION&#x27;</span>, <span class="number">90</span>, <span class="string">&#x27;定期要求用户更换密码&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;权限审查&#x27;</span>, <span class="string">&#x27;PRIVILEGE_REVIEW&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;审查用户权限是否合理&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;安全扫描&#x27;</span>, <span class="string">&#x27;SECURITY_SCAN&#x27;</span>, <span class="number">7</span>, <span class="string">&#x27;扫描安全漏洞和配置问题&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;备份恢复测试&#x27;</span>, <span class="string">&#x27;BACKUP_TEST&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;测试备份文件的可恢复性&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;日志清理&#x27;</span>, <span class="string">&#x27;LOG_CLEANUP&#x27;</span>, <span class="number">7</span>, <span class="string">&#x27;清理过期的审计和安全日志&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 安全维护执行存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ExecuteSecurityMaintenance()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_task_id <span class="type">INT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> v_task_name <span class="type">VARCHAR</span>(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> v_task_type <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">DECLARE</span> maintenance_cursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">        <span class="keyword">SELECT</span> id, task_name, task_type</span><br><span class="line">        <span class="keyword">FROM</span> security_maintenance_tasks </span><br><span class="line">        <span class="keyword">WHERE</span> is_active <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">            <span class="keyword">AND</span> (next_execution <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">OR</span> next_execution <span class="operator">&lt;=</span> NOW());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done <span class="operator">=</span> <span class="literal">TRUE</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">OPEN</span> maintenance_cursor;</span><br><span class="line">    </span><br><span class="line">    maintenance_loop: LOOP</span><br><span class="line">        <span class="keyword">FETCH</span> maintenance_cursor <span class="keyword">INTO</span> v_task_id, v_task_name, v_task_type;</span><br><span class="line">        </span><br><span class="line">        IF done <span class="keyword">THEN</span> LEAVE maintenance_loop; <span class="keyword">END</span> IF;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- 根据任务类型执行相应操作</span></span><br><span class="line">        <span class="keyword">CASE</span> v_task_type</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;PRIVILEGE_REVIEW&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="keyword">CALL</span> ReviewUserPrivileges();</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;SECURITY_SCAN&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="keyword">CALL</span> RunSecurityScan();</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;LOG_CLEANUP&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="keyword">CALL</span> CleanupSecurityLogs();</span><br><span class="line">            <span class="keyword">WHEN</span> <span class="string">&#x27;BACKUP_TEST&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="comment">-- 执行备份测试</span></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="string">&#x27;执行备份测试&#x27;</span> <span class="keyword">as</span> task_result;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">-- 更新任务执行时间</span></span><br><span class="line">        <span class="keyword">UPDATE</span> security_maintenance_tasks </span><br><span class="line">        <span class="keyword">SET</span> </span><br><span class="line">            last_executed <span class="operator">=</span> NOW(),</span><br><span class="line">            next_execution <span class="operator">=</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> frequency_days <span class="keyword">DAY</span>)</span><br><span class="line">        <span class="keyword">WHERE</span> id <span class="operator">=</span> v_task_id;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">CLOSE</span> maintenance_cursor;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 权限审查存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ReviewUserPrivileges()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 查找可能的权限问题</span></span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        <span class="string">&#x27;权限审查结果&#x27;</span> <span class="keyword">as</span> review_type,</span><br><span class="line">        GRANTEE <span class="keyword">as</span> user_account,</span><br><span class="line">        PRIVILEGE_TYPE <span class="keyword">as</span> privilege,</span><br><span class="line">        TABLE_SCHEMA <span class="keyword">as</span> database_name,</span><br><span class="line">        <span class="string">&#x27;权限过高&#x27;</span> <span class="keyword">as</span> issue_type</span><br><span class="line">    <span class="keyword">FROM</span> information_schema.TABLE_PRIVILEGES </span><br><span class="line">    <span class="keyword">WHERE</span> PRIVILEGE_TYPE <span class="operator">=</span> <span class="string">&#x27;ALL PRIVILEGES&#x27;</span></span><br><span class="line">        <span class="keyword">AND</span> GRANTEE <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%root%&#x27;</span></span><br><span class="line">        <span class="keyword">AND</span> GRANTEE <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%admin%&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        <span class="string">&#x27;权限审查结果&#x27;</span>,</span><br><span class="line">        GRANTEE,</span><br><span class="line">        PRIVILEGE_TYPE,</span><br><span class="line">        <span class="string">&#x27;GLOBAL&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;全局权限&#x27;</span></span><br><span class="line">    <span class="keyword">FROM</span> information_schema.USER_PRIVILEGES </span><br><span class="line">    <span class="keyword">WHERE</span> PRIVILEGE_TYPE <span class="keyword">IN</span> (<span class="string">&#x27;CREATE USER&#x27;</span>, <span class="string">&#x27;GRANT OPTION&#x27;</span>, <span class="string">&#x27;SUPER&#x27;</span>)</span><br><span class="line">        <span class="keyword">AND</span> GRANTEE <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%root%&#x27;</span></span><br><span class="line">        <span class="keyword">AND</span> GRANTEE <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%admin%&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 安全扫描存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> RunSecurityScan()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 检查弱密码用户（这里只是示例）</span></span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        <span class="string">&#x27;安全扫描结果&#x27;</span> <span class="keyword">as</span> scan_type,</span><br><span class="line">        <span class="keyword">User</span> <span class="keyword">as</span> username,</span><br><span class="line">        Host <span class="keyword">as</span> host,</span><br><span class="line">        <span class="string">&#x27;可能使用弱密码&#x27;</span> <span class="keyword">as</span> issue</span><br><span class="line">    <span class="keyword">FROM</span> mysql.user </span><br><span class="line">    <span class="keyword">WHERE</span> authentication_string <span class="operator">=</span> <span class="string">&#x27;&#x27;</span> </span><br><span class="line">        <span class="keyword">OR</span> LENGTH(authentication_string) <span class="operator">&lt;</span> <span class="number">20</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查过期密码</span></span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        <span class="string">&#x27;安全扫描结果&#x27;</span>,</span><br><span class="line">        <span class="keyword">User</span>,</span><br><span class="line">        Host,</span><br><span class="line">        <span class="string">&#x27;密码已过期&#x27;</span></span><br><span class="line">    <span class="keyword">FROM</span> mysql.user </span><br><span class="line">    <span class="keyword">WHERE</span> password_expired <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 检查锁定账户</span></span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        <span class="string">&#x27;安全扫描结果&#x27;</span>,</span><br><span class="line">        <span class="keyword">User</span>,</span><br><span class="line">        Host,</span><br><span class="line">        <span class="string">&#x27;账户被锁定&#x27;</span></span><br><span class="line">    <span class="keyword">FROM</span> mysql.user </span><br><span class="line">    <span class="keyword">WHERE</span> account_locked <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h3 id="3-应急响应计划"><a href="#3-应急响应计划" class="headerlink" title="3. 应急响应计划"></a>3. 应急响应计划</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建安全事件响应表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> security_incident_response (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    incident_id <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    incident_type ENUM(<span class="string">&#x27;DATA_BREACH&#x27;</span>, <span class="string">&#x27;UNAUTHORIZED_ACCESS&#x27;</span>, <span class="string">&#x27;PRIVILEGE_ESCALATION&#x27;</span>, <span class="string">&#x27;MALWARE&#x27;</span>, <span class="string">&#x27;DDOS&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    severity ENUM(<span class="string">&#x27;LOW&#x27;</span>, <span class="string">&#x27;MEDIUM&#x27;</span>, <span class="string">&#x27;HIGH&#x27;</span>, <span class="string">&#x27;CRITICAL&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    status ENUM(<span class="string">&#x27;OPEN&#x27;</span>, <span class="string">&#x27;INVESTIGATING&#x27;</span>, <span class="string">&#x27;CONTAINED&#x27;</span>, <span class="string">&#x27;RESOLVED&#x27;</span>, <span class="string">&#x27;CLOSED&#x27;</span>) <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;OPEN&#x27;</span>,</span><br><span class="line">    detected_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    resolved_at <span class="type">TIMESTAMP</span> <span class="keyword">NULL</span>,</span><br><span class="line">    affected_systems TEXT,</span><br><span class="line">    incident_details JSON,</span><br><span class="line">    response_actions TEXT,</span><br><span class="line">    lessons_learned TEXT,</span><br><span class="line">    INDEX idx_incident_type (incident_type),</span><br><span class="line">    INDEX idx_severity (severity),</span><br><span class="line">    INDEX idx_status (status),</span><br><span class="line">    INDEX idx_detected_at (detected_at)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 应急响应存储过程</span></span><br><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> HandleSecurityIncident(</span><br><span class="line">    <span class="keyword">IN</span> incident_type <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">IN</span> severity <span class="type">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">    <span class="keyword">IN</span> incident_details JSON</span><br><span class="line">)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> incident_id <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> response_actions TEXT <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 生成事件ID</span></span><br><span class="line">    <span class="keyword">SET</span> incident_id <span class="operator">=</span> CONCAT(<span class="string">&#x27;INC-&#x27;</span>, DATE_FORMAT(NOW(), <span class="string">&#x27;%Y%m%d-%H%i%s&#x27;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 根据事件类型和严重程度确定响应措施</span></span><br><span class="line">    <span class="keyword">CASE</span> incident_type</span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;UNAUTHORIZED_ACCESS&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">            <span class="keyword">SET</span> response_actions <span class="operator">=</span> <span class="string">&#x27;1. 立即锁定相关账户\n2. 审查访问日志\n3. 检查数据完整性\n4. 通知安全团队&#x27;</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">-- 自动锁定可疑账户</span></span><br><span class="line">            <span class="keyword">UPDATE</span> mysql.user </span><br><span class="line">            <span class="keyword">SET</span> account_locked <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> </span><br><span class="line">            <span class="keyword">WHERE</span> <span class="keyword">User</span> <span class="operator">=</span> JSON_UNQUOTE(JSON_EXTRACT(incident_details, <span class="string">&#x27;$.username&#x27;</span>));</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;PRIVILEGE_ESCALATION&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">            <span class="keyword">SET</span> response_actions <span class="operator">=</span> <span class="string">&#x27;1. 撤销异常权限\n2. 审查权限变更日志\n3. 检查系统配置\n4. 加强权限监控&#x27;</span>;</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">WHEN</span> <span class="string">&#x27;DATA_BREACH&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">            <span class="keyword">SET</span> response_actions <span class="operator">=</span> <span class="string">&#x27;1. 隔离受影响系统\n2. 评估数据泄露范围\n3. 通知相关部门\n4. 准备公告&#x27;</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">-- 如果是严重数据泄露，可以考虑临时禁用某些功能</span></span><br><span class="line">            IF severity <span class="operator">=</span> <span class="string">&#x27;CRITICAL&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">                <span class="comment">-- 这里可以添加紧急措施</span></span><br><span class="line">                <span class="keyword">SET</span> response_actions <span class="operator">=</span> CONCAT(response_actions, <span class="string">&#x27;\n5. 执行紧急隔离措施&#x27;</span>);</span><br><span class="line">            <span class="keyword">END</span> IF;</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 记录安全事件</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> security_incident_response (</span><br><span class="line">        incident_id, incident_type, severity, affected_systems,</span><br><span class="line">        incident_details, response_actions</span><br><span class="line">    ) <span class="keyword">VALUES</span> (</span><br><span class="line">        incident_id, incident_type, severity, <span class="string">&#x27;MySQL Database&#x27;</span>,</span><br><span class="line">        incident_details, response_actions</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 发送告警通知（这里只是记录，实际应该发送邮件或短信）</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> security_events (</span><br><span class="line">        event_type, event_details, severity</span><br><span class="line">    ) <span class="keyword">VALUES</span> (</span><br><span class="line">        <span class="string">&#x27;SECURITY_INCIDENT&#x27;</span>,</span><br><span class="line">        <span class="built_in">JSON_OBJECT</span>(<span class="string">&#x27;incident_id&#x27;</span>, incident_id, <span class="string">&#x27;type&#x27;</span>, incident_type),</span><br><span class="line">        severity</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        incident_id <span class="keyword">as</span> <span class="string">&#x27;事件ID&#x27;</span>,</span><br><span class="line">        incident_type <span class="keyword">as</span> <span class="string">&#x27;事件类型&#x27;</span>,</span><br><span class="line">        severity <span class="keyword">as</span> <span class="string">&#x27;严重程度&#x27;</span>,</span><br><span class="line">        response_actions <span class="keyword">as</span> <span class="string">&#x27;响应措施&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试应急响应</span></span><br><span class="line"><span class="keyword">CALL</span> HandleSecurityIncident(</span><br><span class="line">    <span class="string">&#x27;UNAUTHORIZED_ACCESS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;HIGH&#x27;</span>,</span><br><span class="line">    <span class="built_in">JSON_OBJECT</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;suspicious_user&#x27;</span>, <span class="string">&#x27;ip_address&#x27;</span>, <span class="string">&#x27;192.168.1.999&#x27;</span>, <span class="string">&#x27;failed_attempts&#x27;</span>, <span class="number">20</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>通过以上全面的安全防护措施，可以构建一个安全可靠的MySQL数据库环境。安全是一个持续的过程，需要定期审查、更新和改进安全策略，确保数据库始终处于最佳的安全状态。</p>
<p>记住，数据库安全不仅仅是技术问题，还涉及管理制度、人员培训和应急响应等多个方面。只有综合考虑这些因素，才能真正保障数据库的安全。</p>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">最佳实践</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4/">安全防护</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/">权限管理</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/mysql/">mysql</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8/">数据库安全</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2024/laravel/laravel-artisan-command-line-tool-guide/"
                                   title="Laravel Artisan 命令行工具完全指南：自定义命令与任务调度"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Laravel Artisan 命令行工具完全指南：自定义命令与任务调度</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2023/mysql/mysql-replication-setup-guide/"
                                   title="MySQL主从复制配置实战：高可用架构搭建指南"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">MySQL主从复制配置实战：高可用架构搭建指南</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97"><span class="nav-text">MySQL数据库安全防护实战指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-text">用户权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E5%AE%89%E5%85%A8"><span class="nav-text">1. 用户账户安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%9D%83%E9%99%90%E6%9C%80%E5%B0%8F%E5%8C%96%E5%8E%9F%E5%88%99"><span class="nav-text">2. 权限最小化原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86%EF%BC%88MySQL-8-0-%EF%BC%89"><span class="nav-text">3. 角色管理（MySQL 8.0+）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E5%92%8C%E4%BF%9D%E6%8A%A4"><span class="nav-text">数据加密和保护</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BC%A0%E8%BE%93%E5%8A%A0%E5%AF%86%EF%BC%88SSL-TLS%EF%BC%89"><span class="nav-text">1. 传输加密（SSL&#x2F;TLS）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E9%9D%99%E6%80%81%E5%8A%A0%E5%AF%86"><span class="nav-text">2. 数据静态加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F"><span class="nav-text">3. 数据脱敏</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A1%E8%AE%A1%E5%92%8C%E7%9B%91%E6%8E%A7"><span class="nav-text">审计和监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="nav-text">1. 审计日志配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%89%E5%85%A8%E7%9B%91%E6%8E%A7"><span class="nav-text">2. 安全监控</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%80%A7%E8%83%BD%E5%92%8C%E5%AE%89%E5%85%A8%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="nav-text">3. 性能和安全指标监控</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">网络安全配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8C%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-text">1. 防火墙和网络访问控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8"><span class="nav-text">2. 数据库配置安全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D%E5%AE%89%E5%85%A8"><span class="nav-text">备份和恢复安全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E5%85%A8%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5"><span class="nav-text">1. 安全备份策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%81%A2%E5%A4%8D%E6%B5%8B%E8%AF%95%E5%92%8C%E9%AA%8C%E8%AF%81"><span class="nav-text">2. 恢复测试和验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93"><span class="nav-text">安全最佳实践总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-text">1. 安全检查清单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%89%E5%85%A8%E7%BB%B4%E6%8A%A4%E8%AE%A1%E5%88%92"><span class="nav-text">2. 安全维护计划</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E8%AE%A1%E5%88%92"><span class="nav-text">3. 应急响应计划</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;2025
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Orion K</a>
        
    </div>


    
        
        <div class="deploy-info info-item">
            
            本站由 <span class="tooltip" data-tooltip-content="GitHub Pages"><img src="/images/brands/github.png"></span> 提供部署服务
            
        </div>
    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97"><span class="nav-text">MySQL数据库安全防护实战指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-text">用户权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E5%AE%89%E5%85%A8"><span class="nav-text">1. 用户账户安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%9D%83%E9%99%90%E6%9C%80%E5%B0%8F%E5%8C%96%E5%8E%9F%E5%88%99"><span class="nav-text">2. 权限最小化原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86%EF%BC%88MySQL-8-0-%EF%BC%89"><span class="nav-text">3. 角色管理（MySQL 8.0+）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E5%92%8C%E4%BF%9D%E6%8A%A4"><span class="nav-text">数据加密和保护</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BC%A0%E8%BE%93%E5%8A%A0%E5%AF%86%EF%BC%88SSL-TLS%EF%BC%89"><span class="nav-text">1. 传输加密（SSL&#x2F;TLS）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E9%9D%99%E6%80%81%E5%8A%A0%E5%AF%86"><span class="nav-text">2. 数据静态加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F"><span class="nav-text">3. 数据脱敏</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A1%E8%AE%A1%E5%92%8C%E7%9B%91%E6%8E%A7"><span class="nav-text">审计和监控</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="nav-text">1. 审计日志配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%89%E5%85%A8%E7%9B%91%E6%8E%A7"><span class="nav-text">2. 安全监控</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%80%A7%E8%83%BD%E5%92%8C%E5%AE%89%E5%85%A8%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="nav-text">3. 性能和安全指标监控</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">网络安全配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8C%E7%BD%91%E7%BB%9C%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="nav-text">1. 防火墙和网络访问控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E5%AE%89%E5%85%A8"><span class="nav-text">2. 数据库配置安全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D%E5%AE%89%E5%85%A8"><span class="nav-text">备份和恢复安全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E5%85%A8%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5"><span class="nav-text">1. 安全备份策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%81%A2%E5%A4%8D%E6%B5%8B%E8%AF%95%E5%92%8C%E9%AA%8C%E8%AF%81"><span class="nav-text">2. 恢复测试和验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93"><span class="nav-text">安全最佳实践总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="nav-text">1. 安全检查清单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%89%E5%85%A8%E7%BB%B4%E6%8A%A4%E8%AE%A1%E5%88%92"><span class="nav-text">2. 安全维护计划</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E8%AE%A1%E5%88%92"><span class="nav-text">3. 应急响应计划</span></a></li></ol></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
